From 32561b8033f78c817d1b1d8bd656010160bfcb1d Mon Sep 17 00:00:00 2001
From: Sebastian Andrzej Siewior <bigeasy@linutronix.de>
Date: Fri, 25 Feb 2022 16:04:51 +0100
Subject: [PATCH] mm/memcg: Add a comment regarding the release `obj'.

References: SLE Realtime Extension
Patch-mainline: Queued in subsystem maintainer repository
Git-commit: 2c682fddd23709ec389de095ea6f7188d9f96a98
Git-repo: git://git.kernel.org/pub/scm/linux/kernel/git/rt/linux-rt-devel.git

Please fold into
    mm/memcg: Protect memcg_stock with a local_lock_t

Signed-off-by: Sebastian Andrzej Siewior <bigeasy@linutronix.de>
Signed-off-by: Mel Gorman <mgorman@suse.de>
---
 mm/memcontrol.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/mm/memcontrol.c b/mm/memcontrol.c
index c1cc2076b230..3408d16ce157 100644
--- a/mm/memcontrol.c
+++ b/mm/memcontrol.c
@@ -3242,6 +3242,10 @@ static struct obj_cgroup *drain_obj_stock(struct memcg_stock_pcp *stock)
 	}
 
 	stock->cached_objcg = NULL;
+	/*
+	 * The `old' objects needs to be released by the caller via
+	 * obj_cgroup_put() outside of memcg_stock_pcp::stock_lock.
+	 */
 	return old;
 }
 
