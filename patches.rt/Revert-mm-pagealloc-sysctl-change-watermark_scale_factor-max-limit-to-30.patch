From ca92e5f7fbf1665cc8cd7d67dbf809dde9d08113 Mon Sep 17 00:00:00 2001
From: Mel Gorman <mgorman@techsingularity.net>
Date: Tue, 22 Mar 2022 12:50:15 +0000
Subject: [PATCH] Revert mm/pagealloc: sysctl: change watermark_scale_factor
 max limit to 30%

References: SLE Realtime Extension
Patch-mainline: Never, SLERT specific

The commit 39c65a94cd96 ("mm/pagealloc: sysctl: change
watermark_scale_factor max limit to 30%") was added to allow the
sysctl shuffling patches required to make preempt-rt apply cleanly
but it is a user-visible change. Revert to SLE 15 SP4 behaviour.

Signed-off-by: Mel Gorman <mgorman@suse.de>
---
 Documentation/admin-guide/sysctl/vm.rst | 2 +-
 kernel/sysctl.c                         | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/Documentation/admin-guide/sysctl/vm.rst b/Documentation/admin-guide/sysctl/vm.rst
index ad31d3d2b092..003d5cc3751b 100644
--- a/Documentation/admin-guide/sysctl/vm.rst
+++ b/Documentation/admin-guide/sysctl/vm.rst
@@ -947,7 +947,7 @@ how much memory needs to be free before kswapd goes back to sleep.
 
 The unit is in fractions of 10,000. The default value of 10 means the
 distances between watermarks are 0.1% of the available memory in the
-node/system. The maximum value is 3000, or 30% of memory.
+node/system. The maximum value is 1000, or 10% of memory.
 
 A high rate of threads entering direct reclaim (allocstall) or kswapd
 going to sleep prematurely (kswapd_low_wmark_hit_quickly) can indicate
diff --git a/kernel/sysctl.c b/kernel/sysctl.c
index 05089ad847eb..1bfa00924181 100644
--- a/kernel/sysctl.c
+++ b/kernel/sysctl.c
@@ -2977,7 +2977,7 @@ static struct ctl_table vm_table[] = {
 		.mode		= 0644,
 		.proc_handler	= watermark_scale_factor_sysctl_handler,
 		.extra1		= SYSCTL_ONE,
-		.extra2		= SYSCTL_THREE_THOUSAND,
+		.extra2		= SYSCTL_ONE_THOUSAND,
 	},
 	{
 		.procname	= "percpu_pagelist_high_fraction",
