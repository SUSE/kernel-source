From: Andreas Gruenbacher <agruenba@redhat.com>
Date: Fri, 15 Mar 2024 16:56:09 +0100
Subject: [PATCH] gfs2: Get rid of gfs2_glock_queue_put in signal_our_withdraw
References: bsc#1218260
Patch-mainline: 6.6.64
Git-commit: f80d882edcf242d0256d9e51b09d5fb7a3a0d3b4

[ Upstream commit f80d882edcf242d0256d9e51b09d5fb7a3a0d3b4 ]

In function signal_our_withdraw(), we are calling gfs2_glock_queue_put()
in a context in which we are actually allowed to sleep, so replace that
with a simple call to gfs2_glock_put().

Signed-off-by: Andreas Gruenbacher <agruenba@redhat.com>
Stable-dep-of: 7c6f714d8847 ("gfs2: Fix unlinked inode cleanup")
Signed-off-by: Sasha Levin <sashal@kernel.org>
Signed-off-by: Robert Frohl <rfrohl@suse.com>
---
 fs/gfs2/util.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/fs/gfs2/util.c b/fs/gfs2/util.c
index b65261e0cae3..268ff47b0396 100644
--- a/fs/gfs2/util.c
+++ b/fs/gfs2/util.c
@@ -255,7 +255,7 @@ static void signal_our_withdraw(struct gfs2_sbd *sdp)
 		gfs2_glock_nq(&sdp->sd_live_gh);
 	}
 
-	gfs2_glock_queue_put(live_gl); /* drop extra reference we acquired */
+	gfs2_glock_put(live_gl); /* drop extra reference we acquired */
 	clear_bit(SDF_WITHDRAW_RECOVERY, &sdp->sd_flags);
 
 	/*
-- 
2.47.1

