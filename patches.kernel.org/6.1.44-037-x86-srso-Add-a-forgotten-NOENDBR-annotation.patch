From: "Borislav Petkov (AMD)" <bp@alien8.de>
Date: Fri, 28 Jul 2023 23:03:22 +0200
Subject: [PATCH] x86/srso: Add a forgotten NOENDBR annotation
References: bsc#1012628
Patch-mainline: 6.1.44
Git-commit: 77cf32d0dbfbf575fe66561e069228c532dc1da9

Upstream commit: 3bbbe97ad83db8d9df06daf027b0840188de625d

Fix:

  vmlinux.o: warning: objtool: .export_symbol+0x29e40: data relocation to !ENDBR: srso_untrain_ret_alias+0x0

Reported-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Borislav Petkov (AMD) <bp@alien8.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Robert Frohl <rfrohl@suse.com>
---
 arch/x86/lib/retpoline.S | 1 +
 1 file changed, 1 insertion(+)

diff --git a/arch/x86/lib/retpoline.S b/arch/x86/lib/retpoline.S
index 764c7ed079f2..30e76fab678a 100644
--- a/arch/x86/lib/retpoline.S
+++ b/arch/x86/lib/retpoline.S
@@ -94,6 +94,7 @@ SYM_CODE_END(__x86_indirect_thunk_array)
 	.section .text.__x86.rethunk_untrain
 
 SYM_START(srso_untrain_ret_alias, SYM_L_GLOBAL, SYM_A_NONE)
+	ANNOTATE_NOENDBR
 	ASM_NOP2
 	lfence
 	jmp __x86_return_thunk
-- 
2.42.0

