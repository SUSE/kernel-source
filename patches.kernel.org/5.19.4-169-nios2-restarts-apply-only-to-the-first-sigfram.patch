From: Al Viro <viro@zeniv.linux.org.uk>
Date: Mon, 8 Aug 2022 16:09:16 +0100
Subject: [PATCH] nios2: restarts apply only to the first sigframe we build...
References: bsc#1012628
Patch-mainline: 5.19.4
Git-commit: 411a76b7219555c55867466c82d70ce928d6c9e1

commit 411a76b7219555c55867466c82d70ce928d6c9e1 upstream.

Fixes: b53e906d255d ("nios2: Signal handling support")
Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
Signed-off-by: Dinh Nguyen <dinguyen@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Jiri Slaby <jslaby@suse.cz>
---
 arch/nios2/kernel/signal.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/arch/nios2/kernel/signal.c b/arch/nios2/kernel/signal.c
index 15e672d7150e..a5b93a30c6eb 100644
--- a/arch/nios2/kernel/signal.c
+++ b/arch/nios2/kernel/signal.c
@@ -264,6 +264,7 @@ static int do_signal(struct pt_regs *regs)
 			regs->ea = restart_addr;
 			break;
 		}
+		regs->orig_r2 = -1;
 	}
 
 	if (get_signal(&ksig)) {
-- 
2.37.2

