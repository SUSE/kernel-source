From: Takashi Iwai <tiwai@suse.de>
Date: Thu, 1 Aug 2024 08:42:01 +0200
Subject: [PATCH] ALSA: control: Fix leftover snd_power_unref()
References: bsc#1012628
Patch-mainline: 6.11.3
Git-commit: fef1ac950c600ba50ef4d65ca03c8dae9be7f9ea

commit fef1ac950c600ba50ef4d65ca03c8dae9be7f9ea upstream.

One snd_power_unref() was forgotten and left at __snd_ctl_elem_info()
in the previous change for reorganizing the locking order.

Fixes: fcc62b19104a ("ALSA: control: Take power_ref lock primarily")
Link: https://github.com/thesofproject/linux/pull/5127
Link: https://patch.msgid.link/20240801064203.30284-1-tiwai@suse.de
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Jiri Slaby <jslaby@suse.cz>
---
 sound/core/control.c | 1 -
 1 file changed, 1 deletion(-)

diff --git a/sound/core/control.c b/sound/core/control.c
index 96a2c088a460..63b35c1fbdac 100644
--- a/sound/core/control.c
+++ b/sound/core/control.c
@@ -1168,7 +1168,6 @@ static int __snd_ctl_elem_info(struct snd_card *card,
 	info->access = 0;
 #endif
 	result = kctl->info(kctl, info);
-	snd_power_unref(card);
 	if (result >= 0) {
 		snd_BUG_ON(info->access);
 		index_offset = snd_ctl_get_ioff(kctl, &info->id);
-- 
2.46.1

