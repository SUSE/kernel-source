From: Petr Pavlu <petr.pavlu@suse.com>
Date: Tue Apr 9 13:52:50 2024 +0200
Subject: kABI: Adjust trace_iterator.wait_index
Patch-mainline: Never, kABI fix
References: git-fixes

Commit 2aa043a55b9a ("tracing/ring-buffer: Fix wait_on_pipe() race")
changed the type of trace_iterator.wait_index from long to atomic_t and
added a new bool member trace_iterator.closed.

The variable trace_iterator.wait_index is internal to the tracing
subsystem. Reuse its original 8-byte space for both new wait_index and
closed members.

Signed-off-by: Petr Pavlu <petr.pavlu@suse.com>
---
 include/linux/trace_events.h |   13 +++++++++----
 1 file changed, 9 insertions(+), 4 deletions(-)

--- a/include/linux/trace_events.h
+++ b/include/linux/trace_events.h
@@ -92,16 +92,21 @@ struct trace_iterator {
 	unsigned int		temp_size;
 	char			*fmt;	/* modified format holder */
 	unsigned int		fmt_size;
-	atomic_t		wait_index;
+
+#if !defined(__GENKSYMS__) || !defined(CONFIG_64BIT)
+	atomic_t		wait_index __aligned(__alignof__(long));
+
+	/* Set when the file is closed to prevent new waiters */
+	bool			closed;
+#else
+	long			wait_index;
+#endif
 
 	/* trace_seq for __print_flags() and __print_symbolic() etc. */
 	struct trace_seq	tmp_seq;
 
 	cpumask_var_t		started;
 
-	/* Set when the file is closed to prevent new waiters */
-	bool			closed;
-
 	/* it's true when current open file is snapshot */
 	bool			snapshot;
 
