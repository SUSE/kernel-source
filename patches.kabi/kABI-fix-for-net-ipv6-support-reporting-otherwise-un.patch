From: Steffen Jaeckel <sjaeckel@suse.de>
Subject: kABI fix for net: ipv6: support reporting otherwise unknown prefix
 flags in RTM_NEWPREFIX
Patch-mainline: Never, kABI workaround
References: git-fixes

Upstream commit bd4a816752ba ("net: ipv6: support reporting
otherwise unknown prefix flags in RTM_NEWPREFIX") introduced a packed
union around a bitfield in order to be able to read all values of the
bitfield at once. This broke the kABI but should be fine to do, therefore
hide the change from the kABI checker.

Signed-off-by: Steffen Jaeckel <sjaeckel@suse.de>

---
 include/net/addrconf.h | 4 ++++
 include/net/if_inet6.h | 4 ++++
 2 files changed, 8 insertions(+)

diff --git a/include/net/addrconf.h b/include/net/addrconf.h
index facb7a469efad..90bc9dbb0026b 100644
--- a/include/net/addrconf.h
+++ b/include/net/addrconf.h
@@ -31,9 +31,11 @@ struct prefix_info {
 	__u8			length;
 	__u8			prefix_len;
 
+#ifndef __GENKSYMS__
 	union __packed {
 		__u8		flags;
 		struct __packed {
+#endif
 #if defined(__BIG_ENDIAN_BITFIELD)
 			__u8	onlink : 1,
 			 	autoconf : 1,
@@ -45,8 +47,10 @@ struct prefix_info {
 #else
 #error "Please fix <asm/byteorder.h>"
 #endif
+#ifndef __GENKSYMS__
 		};
 	};
+#endif
 	__be32			valid;
 	__be32			prefered;
 	__be32			reserved2;
diff --git a/include/net/if_inet6.h b/include/net/if_inet6.h
index 31bf475eca762..c8490729b4aea 100644
--- a/include/net/if_inet6.h
+++ b/include/net/if_inet6.h
@@ -22,6 +22,10 @@
 #define IF_RS_SENT	0x10
 #define IF_READY	0x80000000
 
+/* prefix flags */
+#define IF_PREFIX_ONLINK	0x01
+#define IF_PREFIX_AUTOCONF	0x02
+
 enum {
 	INET6_IFADDR_STATE_PREDAD,
 	INET6_IFADDR_STATE_DAD,
-- 
2.47.1

