From: Torsten Duwe <duwe@suse.de>
Subject: dmaengine: idxd: move safety flag to struct ends
Patch-mainline: Never, kabi
References: bsc#1223625 CVE-2024-21823

Move the user_submission_safe flag introduced by the CVE-2024-21823
fix to the end of idxd_driver_data and hide it there and in struct
idxd_device from the kABI checker. This works because structs
idxd_device are only handed around as pointers and always allocated from
drivers/dma/idxd/init.c idxd_alloc(...); idxd_driver_data is held
in a static array, in the same file.

Signed-off-by: Torsten Duwe <duwe@suse.de>


--- a/drivers/dma/idxd/idxd.h
+++ b/drivers/dma/idxd/idxd.h
@@ -288,8 +288,10 @@ struct idxd_driver_data {
 	int evl_cr_off;
 	int cr_status_off;
 	int cr_result_off;
-	bool user_submission_safe;
 	load_device_defaults_fn_t load_device_defaults;
+#ifndef __GENKSYMS__
+	bool user_submission_safe;
+#endif
 };
 
 struct idxd_evl {
@@ -376,8 +378,9 @@ struct idxd_device {
 
 	struct dentry *dbgfs_dir;
 	struct dentry *dbgfs_evl_file;
-
+#ifndef __GENKSYMS__
 	bool user_submission_safe;
+#endif
 };
 
 static inline unsigned int evl_ent_size(struct idxd_device *idxd)
