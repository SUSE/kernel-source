Patch-mainline: never, kABI fix
References: git-fixes
From: Juergen Gross <jgross@suse.com>
Subject: [PATCH] kABI fix of: virtio-crypto: handle config changed by work queue

Move virtio_crypto->config_work to the end of the structure and hide it
from kABI check. This is fine as allocation of the struct is done at a
central place and the new struct member is used only in
virtio_crypto_core.c.

Signed-off-by: Juergen Gross <jgross@suse.com>
---
diff --git a/drivers/crypto/virtio/virtio_crypto_common.h b/drivers/crypto/virtio/virtio_crypto_common.h
index 59a4c0259456..154590e1f764 100644
--- a/drivers/crypto/virtio/virtio_crypto_common.h
+++ b/drivers/crypto/virtio/virtio_crypto_common.h
@@ -35,9 +35,6 @@ struct virtio_crypto {
 	struct virtqueue *ctrl_vq;
 	struct data_queue *data_vq;
 
-	/* Work struct for config space updates */
-	struct work_struct config_work;
-
 	/* To protect the vq operations for the controlq */
 	spinlock_t ctrl_lock;
 
@@ -79,6 +76,11 @@ struct virtio_crypto {
 
 	/* Does the affinity hint is set for virtqueues? */
 	bool affinity_hint_set;
+
+#ifndef __GENKSYMS__
+	/* Work struct for config space updates */
+	struct work_struct config_work;
+#endif
 };
 
 struct virtio_crypto_sym_session_info {
-- 
2.35.3

