From: "Ivan T. Ivanov" <iivanov@suse.de>
Date: Fri, 6 Dec 2024 09:06:06 +0200
Subject: kABI: Restore exported __arm_smccc_sve_check
Patch-mainline: Never, kABI workaround
References: git-fixes

Commit (8c462d56487e3 "arm64: smccc: Remove broken support for SMCCCv1.3
SVE discard hint") removed exported function. Restored it as empty function.

Signed-off-by: Ivan T. Ivanov <iivanov@suse.de>
---
 arch/arm64/kernel/smccc-call.S | 8 ++++++++
 include/linux/arm-smccc.h      | 3 +++
 2 files changed, 11 insertions(+)

diff --git a/arch/arm64/kernel/smccc-call.S b/arch/arm64/kernel/smccc-call.S
index 2def9d0dd3ddb..36924be6d5c7a 100644
--- a/arch/arm64/kernel/smccc-call.S
+++ b/arch/arm64/kernel/smccc-call.S
@@ -8,6 +8,14 @@
 #include <asm/asm-offsets.h>
 #include <asm/assembler.h>
 
+/*
+ * Unused, but exported. Keep because of kABI.
+ */
+SYM_FUNC_START(__arm_smccc_sve_check)
+    ret
+SYM_FUNC_END(__arm_smccc_sve_check)
+EXPORT_SYMBOL(__arm_smccc_sve_check)
+
 	.macro SMCCC instr
 	\instr	#0
 	ldr	x4, [sp]
diff --git a/include/linux/arm-smccc.h b/include/linux/arm-smccc.h
index 67f6fdf2e7cd8..98a598f417764 100644
--- a/include/linux/arm-smccc.h
+++ b/include/linux/arm-smccc.h
@@ -412,6 +412,9 @@ struct arm_smccc_quirk {
 	} state;
 };
 
+/* This is empty. Keep it because of kABI */
+asmlinkage unsigned long __arm_smccc_sve_check(unsigned long x0);
+
 /**
  * __arm_smccc_smc() - make SMC calls
  * @a0-a7: arguments passed in registers 0 to 7
-- 
2.43.0

