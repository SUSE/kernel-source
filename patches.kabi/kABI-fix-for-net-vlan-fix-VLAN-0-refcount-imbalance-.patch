From: Steffen Jaeckel <sjaeckel@suse.de>
Subject: kABI fix for net: vlan: fix VLAN 0 refcount imbalance of toggling
Patch-mainline: Never, kABI workaround
References: CVE-2025-38470 bsc#1247288
 filtering during runtime

Upstream commit 579d4f9ca9a9 ("net: vlan: fix VLAN 0 refcount
imbalance of toggling filtering during runtime") added a new field to
`struct vlan_info`. It is luckily placed in a hole, so we can simply
hide it from the kABI checker.

```
        unsigned int               nr_vids;              /*   176     4 */

        /* XXX 4 bytes hole, try to pack */

        struct callback_head       rcu __attribute__((__aligned__(8))); /*   184    16 */
```

Signed-off-by: Steffen Jaeckel <sjaeckel@suse.de>
Acked-by: Steffen Jaeckel <sjaeckel@suse.de>

---
 net/8021q/vlan.h | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/net/8021q/vlan.h b/net/8021q/vlan.h
index c7ffe591d5936..07c3f21bdbd7f 100644
--- a/net/8021q/vlan.h
+++ b/net/8021q/vlan.h
@@ -33,7 +33,9 @@ struct vlan_info {
 	struct vlan_group	grp;
 	struct list_head	vid_list;
 	unsigned int		nr_vids;
+#ifndef __GENKSYMS__
 	bool			auto_vid0;
+#endif
 	struct rcu_head		rcu;
 };
 
-- 
2.50.1

