From: Juergen Gross <jgross@suse.com>
Patch-mainline: never, kabi
References: git-fixes
Subject: kabi fix of perf/x86/intel: Expose existence of callback support to KVM

Move the new has_callstack struct member into the highest bit of nr, which
value is limited to much lower values than 32-bits.

Signed-off-by: Juergen Gross <jgross@suse.com>
---
diff --git a/arch/x86/include/asm/perf_event.h b/arch/x86/include/asm/perf_event.h
index 3736b8a46c04..7f1e17250546 100644
--- a/arch/x86/include/asm/perf_event.h
+++ b/arch/x86/include/asm/perf_event.h
@@ -555,11 +555,15 @@ struct x86_pmu_lbr {
 };
 
 struct x86_pmu_lbr {
+#ifdef __GENKSYMS__
 	unsigned int	nr;
+#else
+	unsigned int	nr:31;
+	unsigned int	has_callstack:1;
+#endif
 	unsigned int	from;
 	unsigned int	to;
 	unsigned int	info;
-	bool		has_callstack;
 };
 
 extern void perf_get_x86_pmu_capability(struct x86_pmu_capability *cap);
-- 
2.35.3

