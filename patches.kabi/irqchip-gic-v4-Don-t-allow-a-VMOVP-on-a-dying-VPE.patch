From: Jiri Slaby <jslaby@suse.cz>
Subject: kABI: Don't allow a VMOVP on a dying VPE
Patch-mainline: never, kabi
References: kabi CVE-2024-50192 bsc#1233106

Commit 1442ee001198 (irqchip/gic-v4: Don't allow a VMOVP on a dying VPE)
moved vmapp_count away from an union. This broke the kabi checker.

Note the member was already on this memory place due to union. It's only
available for everyone, so nothing changed. So silently hide it.

Signed-off-by: Jiri Slaby <jslaby@suse.cz>
---
 include/linux/irqchip/arm-gic-v4.h |    5 +++++
 1 file changed, 5 insertions(+)

--- a/include/linux/irqchip/arm-gic-v4.h
+++ b/include/linux/irqchip/arm-gic-v4.h
@@ -58,11 +58,16 @@ struct its_vpe {
 				bool	enabled;
 				bool	group;
 			}			sgi_config[16];
+#ifdef __GENKSYMS__
+			atomic_t vmapp_count;
+#endif
 		};
 	};
 
+#ifndef __GENKSYMS__
 	/* Track the VPE being mapped */
 	atomic_t vmapp_count;
+#endif
 
 	/*
 	 * Ensures mutual exclusion between affinity setting of the
