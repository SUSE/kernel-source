From: Michal Kubecek <mkubecek@suse.cz>
Date: Wed, 28 Jan 2026 22:24:27 +0100
Subject: kabi: hide include of <net/lwtunnel.h> in include/net/ip.h
Patch-mainline: Never, kabi workaround
References: CVE-2025-40139 bsc#1253409

Backport of mainline commit ac6627a28dbf ("net: ipv4: Consolidate ipv4_mtu
and ip_dst_mtu_maybe_forward") moves some code from ipv4_mtu() in
net/ipv4/route.c into ip_dst_mtu_maybe_forward() in include/net/ip.h
As a call to lwtunnel_headroom() is part of this code, we need to include
<net/lwtunnel.h> in include/net/ip.h which was added in mainline commit
fade56410c22 ("net: lwtunnel: handle MTU calculation in forwading") missing
in SLE15-SP3-LTSS.

Adding the include triggers a flood of spurious "became defined" kabi check
errors so that the include needs to be hidden from genksyms.

Signed-off-by: Michal Kubecek <mkubecek@suse.cz>
Reviewed-by: Jan Kara <jack@suse.cz>
---
 include/net/ip.h | 2 ++
 1 file changed, 2 insertions(+)

--- a/include/net/ip.h
+++ b/include/net/ip.h
@@ -30,7 +30,9 @@
 #include <net/flow.h>
 #include <net/flow_dissector.h>
 #include <net/netns/hash.h>
+#ifndef __GENKSYMS__
 #include <net/lwtunnel.h>
+#endif
 
 #define IPV4_MAX_PMTU		65535U		/* RFC 2675, Section 5.1 */
 #define IPV4_MIN_MTU		68			/* RFC 791 */
