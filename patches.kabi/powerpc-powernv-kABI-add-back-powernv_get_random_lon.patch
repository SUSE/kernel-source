From cbddef9267861ca36182a70378214fa4ec31ade5 Mon Sep 17 00:00:00 2001
From: Michal Suchanek <msuchanek@suse.de>
Date: Tue, 9 Aug 2022 12:50:51 +0200
Subject: [PATCH] powerpc: powernv: kABI: add back powernv_get_random_long

References: bsc#1065729
Signed-off-by: Michal Suchanek <msuchanek@suse.de>
---
 arch/powerpc/include/asm/archrandom.h | 1 +
 arch/powerpc/platforms/powernv/rng.c  | 4 ++++
 2 files changed, 5 insertions(+)

diff --git a/arch/powerpc/include/asm/archrandom.h b/arch/powerpc/include/asm/archrandom.h
index 89417909a54d..f743dd24e3d0 100644
--- a/arch/powerpc/include/asm/archrandom.h
+++ b/arch/powerpc/include/asm/archrandom.h
@@ -47,6 +47,7 @@ static inline int arch_has_random_seed(void)
 
 #ifdef CONFIG_PPC_POWERNV
 int pnv_get_random_long(unsigned long *v);
+#define powernv_get_random_long pnv_get_random_long
 #endif
 
 #endif /* _ASM_POWERPC_ARCHRANDOM_H */
diff --git a/arch/powerpc/platforms/powernv/rng.c b/arch/powerpc/platforms/powernv/rng.c
index 829ebb8c7c5a..b68b4c5faf63 100644
--- a/arch/powerpc/platforms/powernv/rng.c
+++ b/arch/powerpc/platforms/powernv/rng.c
@@ -198,3 +198,7 @@ static int __init pnv_rng_late_init(void)
 	return 0;
 }
 machine_subsys_initcall(powernv, pnv_rng_late_init);
+
+#undef powernv_get_random_long
+int powernv_get_random_long(unsigned long *v) { return pnv_get_random_long(v); }
+EXPORT_SYMBOL_GPL(powernv_get_random_long);
-- 
2.35.3

