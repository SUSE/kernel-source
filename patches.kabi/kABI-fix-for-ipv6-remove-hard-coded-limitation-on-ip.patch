From: Steffen Jaeckel <sjaeckel@suse.de>
Subject: kABI fix for ipv6: remove hard coded limitation on ipv6_pinfo
Patch-mainline: Never, kABI workaround
References: git-fixes

Upstream commit f5f80e32de12 ("ipv6: remove hard coded
limitation on ipv6_pinfo") added a new member to `struct proto`, which
had luckily a 4 byte hole to fit this in.

```
        unsigned int               inuse_idx;            /*   216     4 */

        /* XXX 4 bytes hole, try to pack */

        int                        (*forward_alloc_get)(const struct sock  *); /*   224     8 */
```

Signed-off-by: Steffen Jaeckel <sjaeckel@suse.de>
Acked-by: Steffen Jaeckel <sjaeckel@suse.de>

---
 include/net/sock.h | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/include/net/sock.h b/include/net/sock.h
index 122789040bee2..5ca418e47f4ce 100644
--- a/include/net/sock.h
+++ b/include/net/sock.h
@@ -1314,6 +1314,10 @@ struct proto {
 	unsigned int		inuse_idx;
 #endif
 
+#ifndef __GENKSYMS__
+	unsigned int		ipv6_pinfo_offset;
+#endif
+
 #if IS_ENABLED(CONFIG_MPTCP)
 	int			(*forward_alloc_get)(const struct sock *sk);
 #endif
@@ -1347,7 +1351,6 @@ struct proto {
 
 	struct kmem_cache	*slab;
 	unsigned int		obj_size;
-	unsigned int		ipv6_pinfo_offset;
 	slab_flags_t		slab_flags;
 	unsigned int		useroffset;	/* Usercopy region offset */
 	unsigned int		usersize;	/* Usercopy region size */
-- 
2.47.1

