From: Steffen Jaeckel <sjaeckel@suse.de>
Subject: kABI fix for "Bluetooth: L2CAP: Fix div-by-zero in
 l2cap_le_flowctl_init()"
Patch-mainline: never, kabi
References: CVE-2024-36968 bsc#1226130

Upstream commit a5b862c6a2214 ("Bluetooth: L2CAP: Fix div-by-zero in
l2cap_le_flowctl_init()") added a new member `mtu` to the `struct hci_conn`.
In order to preserve the kABI, move the `mtu` field to a hole and hide it
during ksyms generation.

```
[...]
        __s8                       max_tx_power;         /*   413     1 */

        /* XXX 2 bytes hole, try to pack */

        struct bt_iso_qos          iso_qos;              /*   416    60 */
[...]
```

Signed-off-by: Steffen Jaeckel <sjaeckel@suse.de>

---
 include/net/bluetooth/hci_core.h | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/include/net/bluetooth/hci_core.h b/include/net/bluetooth/hci_core.h
index 05c9e1d2c2a79..e0613d2da714c 100644
--- a/include/net/bluetooth/hci_core.h
+++ b/include/net/bluetooth/hci_core.h
@@ -706,7 +706,6 @@ struct hci_conn {
 	__u16		handle;
 	__u16		sync_handle;
 	__u16		state;
-	__u16		mtu;
 	__u8		mode;
 	__u8		type;
 	__u8		role;
@@ -743,6 +742,9 @@ struct hci_conn {
 	__s8		rssi;
 	__s8		tx_power;
 	__s8		max_tx_power;
+#ifndef __GENKSYMS__
+	__u16		mtu;
+#endif
 	struct bt_iso_qos iso_qos;
 	unsigned long	flags;
 
-- 
2.47.0

