From: Anthony Iliopoulos <ailiop@suse.com>
Date: Tue, 22 Oct 2024 22:57:55 +0200
Subject: [PATCH] kabi fix for NFSv4: Prevent NULL-pointer dereference in
 nfs42_complete_copies()
Patch-mainline: never, kABI fix
References: bsc#1231902 CVE-2024-50046

Move the newly introduced member to the end of struct nfs_server, and
hide it from the kABI checker. This should be safe since the struct is
allocated and initialized by nfs_alloc_server().

Signed-off-by: Anthony Iliopoulos <ailiop@suse.com>
Acked-by: Anthony Iliopoulos <ailiop@suse.com>

---
 include/linux/nfs_fs_sb.h |    4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

--- a/include/linux/nfs_fs_sb.h
+++ b/include/linux/nfs_fs_sb.h
@@ -232,7 +232,6 @@ struct nfs_server {
 	struct list_head	layouts;
 	struct list_head	delegations;
 	struct list_head	ss_copies;
-	struct list_head	ss_src_copies;
 
 	unsigned long		delegation_gen;
 	unsigned long		mig_gen;
@@ -259,6 +258,9 @@ struct nfs_server {
 	/* User namespace info */
 	const struct cred	*cred;
 	bool			has_sec_mnt_opts;
+#ifndef __GENKSYMS__
+	struct list_head	ss_src_copies;
+#endif
 };
 
 /* Server capabilities */
