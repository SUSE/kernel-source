From: Takashi Iwai <tiwai@suse.de>
Subject: kABI workaround for soc-qcom pmic_glink changes
Patch-mainline: Never, kABI workaround
References: CVE-2024-46693 bsc#1230521

The patch soc-qcom-pmic_glink-Fix-race-during-initialization.patch
removed the exported symbol devm_pmic_glink_register_client.
Revive just for kABI compatibility.

Signed-off-by: Takashi Iwai <tiwai@suse.de>

---
 drivers/soc/qcom/pmic_glink.c |   16 ++++++++++++++++
 1 file changed, 16 insertions(+)

--- a/drivers/soc/qcom/pmic_glink.c
+++ b/drivers/soc/qcom/pmic_glink.c
@@ -112,6 +112,22 @@ void pmic_glink_client_register(struct p
 }
 EXPORT_SYMBOL_GPL(pmic_glink_client_register);
 
+/* FIXME: provided only for kABI compatibility */
+struct pmic_glink_client *devm_pmic_glink_register_client(struct device *dev,
+							  unsigned int id,
+							  void (*cb)(const void *, size_t, void *),
+							  void (*pdr)(void *, int),
+							  void *priv)
+{
+	struct pmic_glink_client *c;
+
+	c = devm_pmic_glink_client_alloc(dev, id, cb, pdr, priv);
+	if (!IS_ERR(c))
+		pmic_glink_client_register(c);
+	return c;
+}
+EXPORT_SYMBOL_GPL(devm_pmic_glink_register_client);
+
 int pmic_glink_send(struct pmic_glink_client *client, void *data, size_t len)
 {
 	struct pmic_glink *pg = client->pg;
