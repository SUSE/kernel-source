From: Ivan T. Ivanov <iivanov@suse.de>
Subject: kABI: i2c: smbus: restore of_ alert variant
Patch-mainline: Never, kABI compatibility
References: jsc#SLE-24569

After patch [1] i2c core got firmware independent way for registering
for alters. Unfortunately of_ variant, even used only internally, was
exported globally. Restore status quo. Also workaround modversion
changes because of the removed include file.

[1] a263a84088f6 "i2c: smbus: Use device_*() functions instead of of_*()"

Signed-off-by: Ivan T. Ivanov <iivanov@suse.de>
---
 drivers/i2c/i2c-core-smbus.c |    9 +++++++++
 drivers/i2c/i2c-smbus.c      |    1 +
 2 files changed, 10 insertions(+)

--- a/drivers/i2c/i2c-core-smbus.c
+++ b/drivers/i2c/i2c-core-smbus.c
@@ -717,4 +717,13 @@ int i2c_setup_smbus_alert(struct i2c_ada
 	return PTR_ERR_OR_ZERO(i2c_new_smbus_alert_device(adapter, NULL));
 }
 EXPORT_SYMBOL_GPL(i2c_setup_smbus_alert);
+
+#if IS_ENABLED(CONFIG_OF)
+int of_i2c_setup_smbus_alert(struct i2c_adapter *adapter)
+{
+	return i2c_setup_smbus_alert(adapter);
+}
+EXPORT_SYMBOL_GPL(of_i2c_setup_smbus_alert);
+#endif
 #endif
+
--- a/drivers/i2c/i2c-smbus.c
+++ b/drivers/i2c/i2c-smbus.c
@@ -13,6 +13,7 @@
 #include <linux/interrupt.h>
 #include <linux/kernel.h>
 #include <linux/module.h>
+#include <linux/of_irq.h>
 #include <linux/property.h>
 #include <linux/slab.h>
 #include <linux/workqueue.h>
