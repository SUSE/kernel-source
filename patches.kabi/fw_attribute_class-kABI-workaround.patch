From: Takashi Iwai <tiwai@suse.de>
Subject: kABI workaround for fw_attributes_class_get()
Patch-mainline: Never, kABI workaround
References: stable-fixes

The recent change for x86 platform drivers replaced the argument
for fw_attributes_class_get() with const pointer, which broke kABI.
Provide a kABI-compatible wrapper for SLE kernels in addition.

Signed-off-by: Takashi Iwai <tiwai@suse.de>

---
 drivers/platform/x86/firmware_attributes_class.c |    8 ++++++++
 drivers/platform/x86/firmware_attributes_class.h |    1 +
 2 files changed, 9 insertions(+)

--- a/drivers/platform/x86/firmware_attributes_class.c
+++ b/drivers/platform/x86/firmware_attributes_class.c
@@ -35,5 +35,13 @@ int fw_attributes_class_put(void)
 }
 EXPORT_SYMBOL_GPL(fw_attributes_class_put);
 
+/* FIXME: redefine for kABI compatibility */
+#undef fw_attributes_class_get
+int fw_attributes_class_get(struct class **fw_attr_class)
+{
+	return __fw_attributes_class_get((const struct class **)fw_attr_class);
+}
+EXPORT_SYMBOL_GPL(fw_attributes_class_get);
+
 MODULE_AUTHOR("Mark Pearson <markpearson@lenovo.com>");
 MODULE_LICENSE("GPL");
--- a/drivers/platform/x86/firmware_attributes_class.h
+++ b/drivers/platform/x86/firmware_attributes_class.h
@@ -8,6 +8,7 @@
 #include <linux/device/class.h>
 
 extern const struct class firmware_attributes_class;
+#define fw_attributes_class_get __fw_attributes_class_get
 int fw_attributes_class_get(const struct class **fw_attr_class);
 int fw_attributes_class_put(void);
 
