From: Steffen Jaeckel <sjaeckel@suse.de>
Subject: kABI fix for tcp: replace tcp_time_stamp_raw()
Patch-mainline: Never, kABI workaround
References: git-fixes

Upstream commit 16cf6477741b ("tcp: replace
tcp_time_stamp_raw()") removed `tcp_time_stamp_raw()` and thereby broke
kABI. Re-introduce the function.

Signed-off-by: Steffen Jaeckel <sjaeckel@suse.de>

---
 include/net/tcp.h | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/include/net/tcp.h b/include/net/tcp.h
index 35ec298ab295d..d8bfc3f6d0f93 100644
--- a/include/net/tcp.h
+++ b/include/net/tcp.h
@@ -853,6 +853,12 @@ static inline u32 tcp_ns_to_ts(u64 ns)
 	return __tcp_ns_to_ts(ns);
 }
 
+/* Could use tcp_clock_us() / 1000, but this version uses a single divide */
+static inline u32 tcp_time_stamp_raw(void)
+{
+	return tcp_ns_to_ts(tcp_clock_ns());
+}
+
 void tcp_mstamp_refresh(struct tcp_sock *tp);
 
 static inline u32 tcp_stamp_us_delta(u64 t1, u64 t0)
-- 
2.47.1

