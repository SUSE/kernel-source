From: Miroslav Franc <mfranc@suse.cz>
Subject: kabi fix for KVM: s390: fix LPSWEY handling
Patch-mainline: never, kabi
References: bsc#1227634 git-fixes

Unfortunately, the struct kvm_vcpu_stat definnition is leaking into
vfio driver, despite not being used by it.  This triggers KABI
warnings.  Exclude added member from kabi check, but only in case we
are in the vfio driver.

Signed-off-by: Miroslav Franc <mfranc@suse.cz>
---
--- a/arch/s390/include/asm/kvm_host.h
+++ b/arch/s390/include/asm/kvm_host.h
@@ -427,7 +427,6 @@
 	u64 instruction_io_other;
 	u64 instruction_lpsw;
 	u64 instruction_lpswe;
-	u64 instruction_lpswey;
 	u64 instruction_pfmf;
 	u64 instruction_ptff;
 	u64 instruction_sck;
@@ -476,6 +475,9 @@
 	u64 instruction_diagnose_500;
 	u64 instruction_diagnose_other;
 	u64 pfault_sync;
+#ifndef __GENKSYMS__
+	u64 instruction_lpswey;
+#endif
 };
 
 #define PGM_OPERATION			0x01
--- a/arch/s390/kvm/kvm-s390.c
+++ b/arch/s390/kvm/kvm-s390.c
@@ -132,7 +132,6 @@
 	STATS_DESC_COUNTER(VCPU, instruction_io_other),
 	STATS_DESC_COUNTER(VCPU, instruction_lpsw),
 	STATS_DESC_COUNTER(VCPU, instruction_lpswe),
-	STATS_DESC_COUNTER(VCPU, instruction_lpswey),
 	STATS_DESC_COUNTER(VCPU, instruction_pfmf),
 	STATS_DESC_COUNTER(VCPU, instruction_ptff),
 	STATS_DESC_COUNTER(VCPU, instruction_sck),
@@ -180,7 +179,8 @@
 	STATS_DESC_COUNTER(VCPU, instruction_diagnose_308),
 	STATS_DESC_COUNTER(VCPU, instruction_diagnose_500),
 	STATS_DESC_COUNTER(VCPU, instruction_diagnose_other),
-	STATS_DESC_COUNTER(VCPU, pfault_sync)
+	STATS_DESC_COUNTER(VCPU, pfault_sync),
+	STATS_DESC_COUNTER(VCPU, instruction_lpswey)
 };
 
 const struct kvm_stats_header kvm_vcpu_stats_header = {
