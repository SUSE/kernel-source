From: Takashi Iwai <tiwai@suse.de>
Subject: kABI workaround for cfg80211 mgmt_registration_lock changes
Patch-mainline: Never, kABI workaround
References: git-fixes

The recent fix patch
  patches.suse/cfg80211-fix-management-registrations-locking.patch
moved the mgmt_registrations_lock from struct wireless_dev to
struct cfg80211_registered_device, and it caused kABI breakage.
Restore the old spinlock as a placeholder.

Signed-off-by: Takashi Iwai <tiwai@suse.de>

---
 include/net/cfg80211.h |    1 +
 net/wireless/core.c    |    1 +
 2 files changed, 2 insertions(+)

--- a/include/net/cfg80211.h
+++ b/include/net/cfg80211.h
@@ -5148,6 +5148,7 @@ struct wireless_dev {
 	u32 identifier;
 
 	struct list_head mgmt_registrations;
+	spinlock_t mgmt_registrations_lock; /* XXX SLE kABI placeholder */
 	u8 mgmt_registrations_need_update:1;
 
 	struct mutex mtx;
--- a/net/wireless/core.c
+++ b/net/wireless/core.c
@@ -1255,6 +1255,7 @@ void cfg80211_init_wdev(struct wireless_
 	INIT_LIST_HEAD(&wdev->event_list);
 	spin_lock_init(&wdev->event_lock);
 	INIT_LIST_HEAD(&wdev->mgmt_registrations);
+	spin_lock_init(&wdev->mgmt_registrations_lock); /* XXX SLE kABI placeholder */
 	INIT_LIST_HEAD(&wdev->pmsr_list);
 	spin_lock_init(&wdev->pmsr_lock);
 	INIT_WORK(&wdev->pmsr_free_wk, cfg80211_pmsr_free_wk);
