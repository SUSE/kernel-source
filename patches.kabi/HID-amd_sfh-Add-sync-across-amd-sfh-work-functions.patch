From: Takashi Iwai <tiwai@suse.de>
Subject: kABI workaround for amd_sfh
Patch-mainline: Never, kABI workaround
References: git-fixes

patches.suse/HID-amd_sfh-Add-sync-across-amd-sfh-work-functions.patch
with commit bba920e6f803 introduced a new mutex field to struct
amd_mp2_dev and it broke kABI.  As the struct is allocated dynamically
in amd_mp2_pci_probe(), just move the new field to the tail with the
standard ifdef for kABI compatibility.

Reviewed-by: Jan Kara <jack@suse.cz>
Signed-off-by: Takashi Iwai <tiwai@suse.de>

---
 drivers/hid/amd-sfh-hid/amd_sfh_common.h |    6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

--- a/drivers/hid/amd-sfh-hid/amd_sfh_common.h
+++ b/drivers/hid/amd-sfh-hid/amd_sfh_common.h
@@ -58,10 +58,12 @@ struct amd_mp2_dev {
 	u32 mp2_acs;
 	struct sfh_dev_status dev_en;
 	struct work_struct work;
-	/* mp2 to protect data */
-	struct mutex lock;
 	u8 init_done;
 	u8 rver;
+#ifndef __GENKSYMS__
+	/* mp2 to protect data */
+	struct mutex lock;
+#endif
 };
 
 struct amd_mp2_ops {
