From: Steffen Jaeckel <sjaeckel@suse.de>
Date: Tue, 26 Nov 2024 10:48:12 +0100
Subject: kABI fix for netfilter: nft_set_pipapo: walk over current view on
 netlink dump (CVE-2024-27017 bsc#1223733).
References: CVE-2024-27017 bsc#1223733
Patch-mainline: Never, kABI workaround

Upstream commit d1885c49016 ("netfilter: nft_set_pipapo:
walk over current view on netlink dump (CVE-2024-27017
bsc#1223733).") added a new member to `struct nft_set_iter`. It's
already placed in a hole, so we only have to hide it during ksyms
generation.

Also hide the enum that is added.

```
struct nft_set_iter {
        u8                         genmask;              /*     0     1
*/

        /* XXX 3 bytes hole, try to pack */

        unsigned int               count;                /*     4     4
*/
[...]
```

Signed-off-by: Steffen Jaeckel <sjaeckel@suse.de>

---
 include/net/netfilter/nf_tables.h | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/include/net/netfilter/nf_tables.h b/include/net/netfilter/nf_tables.h
index bc43271b7c87e..1a12bb0710231 100644
--- a/include/net/netfilter/nf_tables.h
+++ b/include/net/netfilter/nf_tables.h
@@ -298,6 +298,7 @@ struct nft_set_elem {
 };
 
 
+#ifndef __GENKSYMS__
 /**
  * enum nft_iter_type - nftables set iterator type
  *
@@ -309,11 +310,14 @@ enum nft_iter_type {
 	NFT_ITER_READ,
 	NFT_ITER_UPDATE,
 };
+#endif
 
 struct nft_set;
 struct nft_set_iter {
 	u8		genmask;
+#ifndef __GENKSYMS__
 	enum nft_iter_type type:8;
+#endif
 	unsigned int	count;
 	unsigned int	skip;
 	int		err;
-- 
2.47.0

