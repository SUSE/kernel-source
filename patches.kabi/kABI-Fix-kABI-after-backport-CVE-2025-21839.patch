From: Dario Faggioli <dfaggioli@suse.com>
Subject: kABI: Fix kABI after backport od CVE-2025-21839
Patch-mainline: Never, kABI workaround
References: bsc#1239061 CVE-2025-21839

Repair kABI after backporting "KVM: x86: Load DR6 with guest value only
before entering .vcpu_run() loop" which adds a function in
struct kvm_x86_ops.

Signed-off-by: Dario Faggioli <dfaggioli@suse.com>

--- a/arch/x86/include/asm/kvm_host.h
+++ b/arch/x86/include/asm/kvm_host.h
@@ -1332,7 +1332,6 @@
 	void (*get_gdt)(struct kvm_vcpu *vcpu, struct desc_ptr *dt);
 	void (*set_gdt)(struct kvm_vcpu *vcpu, struct desc_ptr *dt);
 	void (*sync_dirty_debug_regs)(struct kvm_vcpu *vcpu);
-	void (*set_dr6)(struct kvm_vcpu *vcpu, unsigned long value);
 	void (*set_dr7)(struct kvm_vcpu *vcpu, unsigned long value);
 	void (*cache_reg)(struct kvm_vcpu *vcpu, enum kvm_reg reg);
 	unsigned long (*get_rflags)(struct kvm_vcpu *vcpu);
@@ -1355,6 +1365,10 @@
 	void (*set_rflags)(struct kvm_vcpu *vcpu, unsigned long rflags);
 	bool (*get_if_flag)(struct kvm_vcpu *vcpu);
 
+ #ifndef __GENKSYMS__
+	void (*set_dr6)(struct kvm_vcpu *vcpu, unsigned long value);
+ #endif
+ 
 	void (*tlb_flush_all)(struct kvm_vcpu *vcpu);
 	void (*tlb_flush_current)(struct kvm_vcpu *vcpu);
 	int  (*tlb_remote_flush)(struct kvm *kvm);
