From: Takashi Iwai <tiwai@suse.de>
Subject: i915 kABI workaround
Patch-mainline: Never, kABI workaround
References: git-fixes

The addition of a new field to drm_i915_gem_object broke kABI.
Just wrap with __GENKSYMS__ as it's in an addition at the hole.

Also add the inclusion of linux/swiotlb.h to keep the kABI in a
few places.

Signed-off-by: Takashi Iwai <tiwai@suse.de>

---
 drivers/gpu/drm/i915/gem/i915_gem_internal.c     |    1 +
 drivers/gpu/drm/i915/gem/i915_gem_object_types.h |    2 ++
 drivers/gpu/drm/i915/i915_scatterlist.h          |    1 +
 3 files changed, 4 insertions(+)

--- a/drivers/gpu/drm/i915/gem/i915_gem_internal.c
+++ b/drivers/gpu/drm/i915/gem/i915_gem_internal.c
@@ -6,6 +6,7 @@
 
 #include <linux/scatterlist.h>
 #include <linux/slab.h>
+#include <linux/swiotlb.h>
 
 #include "i915_drv.h"
 #include "i915_gem.h"
--- a/drivers/gpu/drm/i915/gem/i915_gem_object_types.h
+++ b/drivers/gpu/drm/i915/gem/i915_gem_object_types.h
@@ -490,8 +490,10 @@ struct drm_i915_gem_object {
 	 */
 	unsigned int cache_dirty:1;
 
+#ifndef __GENKSYMS__
 	/* @is_dpt: Object houses a display page table (DPT) */
 	unsigned int is_dpt:1;
+#endif
 
 	/**
 	 * @read_domains: Read memory domains.
--- a/drivers/gpu/drm/i915/i915_scatterlist.h
+++ b/drivers/gpu/drm/i915/i915_scatterlist.h
@@ -10,6 +10,7 @@
 #include <linux/pfn.h>
 #include <linux/scatterlist.h>
 #include <linux/dma-mapping.h>
+#include <linux/swiotlb.h>
 #include <xen/xen.h>
 
 #include "i915_gem.h"
