From 95fa801979a592f9f17ddc733017860ca84ab7ad Mon Sep 17 00:00:00 2001
From: Oliver Neukum <oneukum@suse.com>
Date: Mon, 21 Jul 2025 16:24:36 +0200
References: CVE-2025-38117 bsc#1245695
Patch-mainline: Never (kABI fixup)
Subject: [PATCH] bluetooth: restore le_scan_restart in struct hci_dev

Restore it as a dummy member for kABI

Signed-off-by: Oliver Neukum <oneukum@suse.com>
---
 include/net/bluetooth/hci_core.h |    1 +
 net/bluetooth/hci_sync.c         |    6 ++++++
 2 files changed, 7 insertions(+)

--- a/include/net/bluetooth/hci_core.h
+++ b/include/net/bluetooth/hci_core.h
@@ -539,6 +539,7 @@ struct hci_dev {
 	struct work_struct	tx_work;
 
 	struct delayed_work	le_scan_disable;
+	struct delayed_work	le_scan_restart;
 
 	struct sk_buff_head	rx_q;
 	struct sk_buff_head	raw_q;
--- a/net/bluetooth/hci_sync.c
+++ b/net/bluetooth/hci_sync.c
@@ -569,6 +569,11 @@ unlock:
 	hci_dev_unlock(hdev);
 }
 
+static void le_scan_restart(struct work_struct *work)
+{
+	/* dummy */
+}
+
 void hci_cmd_sync_init(struct hci_dev *hdev)
 {
 	INIT_WORK(&hdev->cmd_sync_work, hci_cmd_sync_work);
@@ -579,6 +584,7 @@ void hci_cmd_sync_init(struct hci_dev *h
 	INIT_WORK(&hdev->cmd_sync_cancel_work, hci_cmd_sync_cancel_work);
 	INIT_WORK(&hdev->reenable_adv_work, reenable_adv);
 	INIT_DELAYED_WORK(&hdev->le_scan_disable, le_scan_disable);
+	INIT_DELAYED_WORK(&hdev->le_scan_restart, le_scan_restart);
 	INIT_DELAYED_WORK(&hdev->adv_instance_expire, adv_timeout_expire);
 }
 
