From: Takashi Iwai <tiwai@suse.de>
Subject: kABI workaround for powercap update
Patch-mainline: Never, kABI workaround
References: bsc#1241010

The patch
  patches.suse/powercap-intel_rapl-Introduce-APIs-for-PMU-support.patch
added new fields to the exposed struct rapl_package that break kABI.
Also a couple of header inclusions matters, too.

Guard them with the standard ifdef for keeping kABI.

Signed-off-by: Takashi Iwai <tiwai@suse.de>

---
 drivers/powercap/intel_rapl_common.c |    2 ++
 include/linux/intel_rapl.h           |    2 ++
 2 files changed, 4 insertions(+)

--- a/drivers/powercap/intel_rapl_common.c
+++ b/drivers/powercap/intel_rapl_common.c
@@ -13,8 +13,10 @@
 #include <linux/device.h>
 #include <linux/slab.h>
 #include <linux/log2.h>
+#ifndef __GENKSYMS__
 #include <linux/nospec.h>
 #include <linux/perf_event.h>
+#endif
 #include <linux/bitmap.h>
 #include <linux/delay.h>
 #include <linux/sysfs.h>
--- a/include/linux/intel_rapl.h
+++ b/include/linux/intel_rapl.h
@@ -191,9 +191,11 @@ struct rapl_package {
 	char name[PACKAGE_DOMAIN_NAME_LENGTH];
 	struct rapl_if_priv *priv;
 #ifdef CONFIG_PERF_EVENTS
+#ifndef __GENKSYMS__
 	bool has_pmu;
 	struct rapl_package_pmu_data pmu_data;
 #endif
+#endif
 };
 
 struct rapl_package *rapl_find_package_domain_cpuslocked(int id, struct rapl_if_priv *priv,
