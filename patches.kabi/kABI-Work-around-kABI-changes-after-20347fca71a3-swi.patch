From: Joerg Roedel <jroedel@suse.de>
Date: Tue, 21 Feb 2023 15:16:24 +0100
Subject: [PATCH] kABI: Work around kABI changes after '20347fca71a3 swiotlb:
 split up the global swiotlb lock'
Patch-mainline: Never, kABI workaround
References: jsc#PED-3259

Signed-off-by: Joerg Roedel <jroedel@suse.de>
---
 include/linux/swiotlb.h | 10 +++++++---
 1 file changed, 7 insertions(+), 3 deletions(-)

diff --git a/include/linux/swiotlb.h b/include/linux/swiotlb.h
index fcdd5141f765..a5727015c3c1 100644
--- a/include/linux/swiotlb.h
+++ b/include/linux/swiotlb.h
@@ -95,18 +95,22 @@ struct io_tlb_mem {
 	void *vaddr;
 	unsigned long nslabs;
 	unsigned long used;
+	unsigned int index;
+	spinlock_t lock;
 	struct dentry *debugfs;
 	bool late_alloc;
 	bool force_bounce;
 	bool for_alloc;
-	unsigned int nareas;
-	unsigned int area_nslabs;
-	struct io_tlb_area *areas;
 	struct io_tlb_slot {
 		phys_addr_t orig_addr;
 		size_t alloc_size;
 		unsigned int list;
 	} *slots;
+#ifndef __GENKSYMS__
+	unsigned int nareas;
+	unsigned int area_nslabs;
+	struct io_tlb_area *areas;
+#endif
 };
 extern struct io_tlb_mem io_tlb_default_mem;
 
-- 
2.39.2

