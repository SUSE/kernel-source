From: Jiri Slaby <jslaby@suse.cz>
Subject: kABI: PCI/ACPI: Fix runtime PM ref imbalance on Hot-Plug Capable ports
Patch-mainline: never, kabi
References: git-fixes

Commit 6cff20ce3b92 (PCI/ACPI: Fix runtime PM ref imbalance on Hot-Plug
Capable ports) added a bit to struct pci_dev. This breaks kabi for
already built modules.

Move the 'is_pciehp' bit to a hole after 'clear_retrain_link' and
protect it by __GENKSYMS__.

Signed-off-by: Jiri Slaby <jslaby@suse.cz>
---
 include/linux/pci.h |    4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

--- a/include/linux/pci.h
+++ b/include/linux/pci.h
@@ -391,6 +391,9 @@ struct pci_dev {
 						      user sysfs */
 	unsigned int	clear_retrain_link:1;	/* Need to clear Retrain Link
 						   bit manually */
+#ifndef __GENKSYMS__
+	unsigned int	is_pciehp:1;
+#endif
 	unsigned int	d3hot_delay;	/* D3hot->D0 transition time in ms */
 	unsigned int	d3cold_delay;	/* D3cold->D0 transition time in ms */
 
@@ -444,7 +447,6 @@ struct pci_dev {
 	unsigned int	is_physfn:1;
 	unsigned int	is_virtfn:1;
 	unsigned int	is_hotplug_bridge:1;
-	unsigned int	is_pciehp:1;
 	unsigned int	shpc_managed:1;		/* SHPC owned by shpchp */
 	unsigned int	is_thunderbolt:1;	/* Thunderbolt controller */
 	/*
