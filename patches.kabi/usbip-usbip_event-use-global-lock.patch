From 2899b6bfab8e973d8b7a056245e80b2297170e50 Mon Sep 17 00:00:00 2001
From: Oliver Neukum <oneukum@suse.com>
Date: Thu, 17 Nov 2022 13:47:41 +0100
Subject: [PATCH] usbip: usbip_event: use global lock
Patch-mainline: Never (kABI fixup)
References: git-fixes

use a global lock instead of a per device lock
introduced to preserve kABI

Signed-off-by: Oliver Neukum <oneukum@suse.com>
---
 drivers/usb/usbip/usbip_event.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/usb/usbip/usbip_event.c b/drivers/usb/usbip/usbip_event.c
index 086ca76dd..354520524 100644
--- a/drivers/usb/usbip/usbip_event.c
+++ b/drivers/usb/usbip/usbip_event.c
@@ -70,7 +70,7 @@ static void event_handler(struct work_struct *work)
 	while ((ud = get_event()) != NULL) {
 		usbip_dbg_eh("pending event %lx\n", ud->event);
 
-		mutex_lock(&ud->sysfs_lock);
+		mutex_lock(&suse_big_usbip_lock);
 		/*
 		 * NOTE: shutdown must come first.
 		 * Shutdown the device.
@@ -91,7 +91,7 @@ static void event_handler(struct work_struct *work)
 			ud->eh_ops.unusable(ud);
 			unset_event(ud, USBIP_EH_UNUSABLE);
 		}
-		mutex_unlock(&ud->sysfs_lock);
+		mutex_unlock(&suse_big_usbip_lock);
 
 		wake_up(&ud->eh_waitq);
 	}
-- 
2.35.3

