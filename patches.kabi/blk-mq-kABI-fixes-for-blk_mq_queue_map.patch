From: Daniel Wagner <dwagner@suse.de>
Date: Mon, 04 Oct 2021 16:06:52 +0200
Subject: blk-mq: kABI fixes for blk_mq_queue_map
Patch-Mainline: never, kABI fix for SLE15-SP2
References: bsc#1185762

Signed-off-by: Daniel Wagner <dwagner@suse.de>
---
 block/blk-mq-pci.c     |    2 ++
 block/blk-mq-virtio.c  |    2 ++
 include/linux/blk-mq.h |    4 ++++
 3 files changed, 8 insertions(+)

--- a/block/blk-mq-pci.c
+++ b/block/blk-mq-pci.c
@@ -8,7 +8,9 @@
 #include <linux/blk-mq-pci.h>
 #include <linux/pci.h>
 #include <linux/module.h>
+#ifndef __GENKSYMS__
 #include <linux/msi.h>
+#endif
 
 #include "blk-mq.h"
 
--- a/block/blk-mq-virtio.c
+++ b/block/blk-mq-virtio.c
@@ -7,7 +7,9 @@
 #include <linux/blk-mq-virtio.h>
 #include <linux/virtio_config.h>
 #include <linux/module.h>
+#ifndef __GENKSYMS__
 #include <linux/msi.h>
+#endif
 #include "blk-mq.h"
 
 /**
--- a/include/linux/blk-mq.h
+++ b/include/linux/blk-mq.h
@@ -79,8 +79,12 @@ struct blk_mq_hw_ctx {
 struct blk_mq_queue_map {
 	unsigned int *mq_map;
 	unsigned int nr_queues;
+#ifndef __GENKSYMS__
 	unsigned int queue_offset:31;
 	unsigned int use_managed_irq:1;
+#else
+	unsigned int queue_offset;
+#endif
 };
 
 enum hctx_type {
