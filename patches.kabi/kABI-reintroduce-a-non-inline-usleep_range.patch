From ee3dcf8fd591dc34ea04e6a7b49182602f94681e Mon Sep 17 00:00:00 2001
From: Oliver Neukum <oneukum@suse.com>
Date: Wed, 14 Dec 2022 13:33:55 +0100
Subject: [PATCH] kABI: reintroduce a non-inline usleep_range
Patch-mainline: Never (kABI fixup)
References: git-fixes

Signed-off-by: Oliver Neukum <oneukum@suse.com>
---
 include/linux/delay.h | 6 +-----
 kernel/time/timer.c   | 6 ++++++
 2 files changed, 7 insertions(+), 5 deletions(-)

diff --git a/include/linux/delay.h b/include/linux/delay.h
index e8607992c..07c0d8880 100644
--- a/include/linux/delay.h
+++ b/include/linux/delay.h
@@ -59,14 +59,10 @@ void calibrate_delay(void);
 void __attribute__((weak)) calibration_delay_done(void);
 void msleep(unsigned int msecs);
 unsigned long msleep_interruptible(unsigned int msecs);
+void usleep_range(unsigned long min, unsigned long max);
 void usleep_range_state(unsigned long min, unsigned long max,
 			unsigned int state);
 
-static inline void usleep_range(unsigned long min, unsigned long max)
-{
-	usleep_range_state(min, max, TASK_UNINTERRUPTIBLE);
-}
-
 static inline void usleep_idle_range(unsigned long min, unsigned long max)
 {
 	usleep_range_state(min, max, TASK_IDLE);
diff --git a/kernel/time/timer.c b/kernel/time/timer.c
index 85f1021ad..6b1ae86a3 100644
--- a/kernel/time/timer.c
+++ b/kernel/time/timer.c
@@ -2079,3 +2079,9 @@ void __sched usleep_range_state(unsigned long min, unsigned long max,
 	}
 }
 EXPORT_SYMBOL(usleep_range_state);
+
+void usleep_range(unsigned long min, unsigned long max)
+{
+	usleep_range_state(min, max, TASK_UNINTERRUPTIBLE);
+}
+EXPORT_SYMBOL(usleep_range);
-- 
2.35.3

