From: NeilBrown <neilb@suse.de>
Subject: kabi-fix for NFS: Fix another fsync() issue after a server reboot
Patch-mainline: Never, kabi
References: git-fixes

Union the new field - which applies to regular files only - with a field
that applies only to directories.

---
 include/linux/nfs_fs.h |    8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

--- a/include/linux/nfs_fs.h
+++ b/include/linux/nfs_fs.h
@@ -177,7 +177,6 @@ struct nfs_inode {
 	__be32			cookieverf[NFS_DIR_VERIFIER_SIZE];
 
 	atomic_long_t		nrequests;
-	atomic_long_t	redirtied_pages;
 	struct nfs_mds_commit_info commit_info;
 
 	/* Open contexts for shared mmap writes */
@@ -185,7 +184,14 @@ struct nfs_inode {
 
 	/* Readers: in-flight sillydelete RPC calls */
 	/* Writers: rmdir */
+#ifndef __GENKSYMS__
+	union {
+#endif
 	struct rw_semaphore	rmdir_sem;
+#ifndef __GENKSYMS__
+	atomic_long_t	redirtied_pages;
+	};
+#endif
 	struct mutex		commit_mutex;
 
 	/* Keep track of out-of-order replies.
