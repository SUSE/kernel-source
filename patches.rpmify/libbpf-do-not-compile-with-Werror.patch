From: "Jiri Slaby (SUSE)" <jirislaby@kernel.org>
Date: Thu, 3 Jul 2025 09:40:55 +0200
Subject: libbpf: do not compile with -Werror
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit
References: bsc#1245584
Patch-mainline: not yet, it's unclear whether this is a compiler bug

This currently fails on s390 due to a false warning:
 libbpf.c:10090:33: error: ‘mod_len’ may be used uninitialized [-Werror=maybe-uninitialized]
 10090 |                 if (mod_name && strncmp(mod->name, mod_name, mod_len) != 0)
       |                                 ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 libbpf.c:10060:21: note: ‘mod_len’ was declared here
 10060 |         int ret, i, mod_len;
       |                     ^~~~~~~
 cc1: all warnings being treated as errors

Note that if mod_name is set, mod_len is too.

Signed-off-by: Jiri Slaby <jslaby@suse.cz>
---
 tools/lib/bpf/Makefile | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/tools/lib/bpf/Makefile b/tools/lib/bpf/Makefile
index 168140f8e646..a45c07a7a3b4 100644
--- a/tools/lib/bpf/Makefile
+++ b/tools/lib/bpf/Makefile
@@ -80,7 +80,7 @@ endif
 # Append required CFLAGS
 override CFLAGS += -std=gnu89
 override CFLAGS += $(EXTRA_WARNINGS) -Wno-switch-enum
-override CFLAGS += -Werror -Wall
+override CFLAGS += -Wall
 override CFLAGS += $(INCLUDES)
 override CFLAGS += -fvisibility=hidden
 override CFLAGS += -D_LARGEFILE64_SOURCE -D_FILE_OFFSET_BITS=64
-- 
2.50.0

