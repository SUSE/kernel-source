From: Xiubo Li <xiubli@redhat.com>
Date: Tue, 5 Jul 2022 10:40:23 +0800
Subject: ceph: remove useless check for the folio
Git-commit: c460f4e4bba2d3f8dc0b5bfa8995d6e8d2d527a1
Patch-mainline: v6.0-rc1
References: jsc#SES-1880

The netfs_write_begin() won't set the folio if the return value
is non-zero.

Signed-off-by: Xiubo Li <xiubli@redhat.com>
Reviewed-by: Ilya Dryomov <idryomov@gmail.com>
Signed-off-by: Ilya Dryomov <idryomov@gmail.com>
Acked-by: Luis Henriques <lhenriques@suse.com>
---
 fs/ceph/addr.c |   17 +++++++----------
 1 file changed, 7 insertions(+), 10 deletions(-)

--- a/fs/ceph/addr.c
+++ b/fs/ceph/addr.c
@@ -1315,16 +1315,13 @@ static int ceph_write_begin(struct file
 	int r;
 
 	r = netfs_write_begin(file, inode->i_mapping, pos, len, 0, &page, NULL);
-	if (r == 0)
-		wait_on_page_fscache(page);
-	if (r < 0) {
-		if (page)
-			put_page(page);
-	} else {
-		WARN_ON_ONCE(!PageLocked(page));
-		*pagep = page;
-	}
-	return r;
+	if (r < 0)
+		return r;
+
+	wait_on_page_fscache(page);
+	WARN_ON_ONCE(!PageLocked(page));
+	*pagep = page;
+	return 0;
 }
 
 /*
