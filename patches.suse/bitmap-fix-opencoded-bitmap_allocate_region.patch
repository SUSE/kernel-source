From: Yury Norov <yury.norov@gmail.com>
Date: Sun, 24 Sep 2023 19:38:12 -0700
Subject: bitmap: fix opencoded bitmap_allocate_region()
Patch-mainline: v6.7-rc1
Git-commit: b085f969ed3df1916b9d9029225f2472df33cc17
References: jsc#PED-9947

bitmap_find_region() opencodes bitmap_allocate_region().

CC: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
CC: Rasmus Villemoes <linux@rasmusvillemoes.dk>
Signed-off-by: Yury Norov <yury.norov@gmail.com>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 lib/bitmap.c |    6 ++----
 1 file changed, 2 insertions(+), 4 deletions(-)

--- a/lib/bitmap.c
+++ b/lib/bitmap.c
@@ -803,10 +803,8 @@ int bitmap_find_free_region(unsigned lon
 	unsigned int pos, end;		/* scans bitmap by regions of size order */
 
 	for (pos = 0; (end = pos + BIT(order)) <= bits; pos = end) {
-		if (!__reg_op(bitmap, pos, order, REG_OP_ISFREE))
-			continue;
-		__reg_op(bitmap, pos, order, REG_OP_ALLOC);
-		return pos;
+		if (!bitmap_allocate_region(bitmap, pos, order))
+			return pos;
 	}
 	return -ENOMEM;
 }
