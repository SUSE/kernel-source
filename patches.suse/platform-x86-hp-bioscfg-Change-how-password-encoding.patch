From: Jorge Lopez <jorge.lopez2@hp.com>
Date: Mon, 31 Jul 2023 15:31:40 -0500
Subject: platform/x86: hp-bioscfg: Change how password encoding size is
 evaluated
References: jsc#PED-13019
Git-commit: efd4211e54d1fe9c788a0506849616b41edbe7d1
Patch-mainline: 6.6-rc1

Update steps how password encoding size is evaluated

Signed-off-by: Jorge Lopez <jorge.lopez2@hp.com>
Link: https://lore.kernel.org/r/20230731203141.30044-8-jorge.lopez2@hp.com
Reviewed-by: Hans de Goede <hdegoede@redhat.com>
Signed-off-by: Hans de Goede <hdegoede@redhat.com>
Signed-off-by: Jiri Slaby <jslaby@suse.cz>
---
 drivers/platform/x86/hp/hp-bioscfg/passwdobj-attributes.c |    7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

--- a/drivers/platform/x86/hp/hp-bioscfg/passwdobj-attributes.c
+++ b/drivers/platform/x86/hp/hp-bioscfg/passwdobj-attributes.c
@@ -335,9 +335,12 @@ static int hp_populate_password_elements
 			password_data->max_password_length = int_value;
 			break;
 		case PSWD_SIZE:
-			password_data->encodings_size = int_value;
-			if (int_value > MAX_ENCODINGS_SIZE)
+
+			if (int_value > MAX_ENCODINGS_SIZE) {
 				pr_warn("Password Encoding size value exceeded the maximum number of elements supported or data may be malformed\n");
+				int_value = MAX_ENCODINGS_SIZE;
+			}
+			password_data->encodings_size = int_value;
 
 			/* This step is needed to keep the expected
 			 * element list pointing to the right obj[elem].type
