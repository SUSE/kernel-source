From: Kashyap Desai <kashyap.desai@broadcom.com>
Date: Mon, 14 Aug 2023 10:00:18 -0700
Subject: RDMA/bnxt_re: Initialize mutex dbq_lock
Patch-mainline: v6.6-rc1
Git-commit: 811e0ce9e6499a0c71c359a2b7e2bd6a5ed8e58f
References: jsc#PED-6864

Fix the missing dbq_lock mutex initialization

Fixes: 2ad4e6303a6d ("RDMA/bnxt_re: Implement doorbell pacing algorithm")
Signed-off-by: Kashyap Desai <kashyap.desai@broadcom.com>
Signed-off-by: Selvin Xavier <selvin.xavier@broadcom.com>
Link: https://lore.kernel.org/r/1692032419-21680-1-git-send-email-selvin.xavier@broadcom.com
Signed-off-by: Leon Romanovsky <leon@kernel.org>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 drivers/infiniband/hw/bnxt_re/main.c |    1 +
 1 file changed, 1 insertion(+)

--- a/drivers/infiniband/hw/bnxt_re/main.c
+++ b/drivers/infiniband/hw/bnxt_re/main.c
@@ -920,6 +920,7 @@ static struct bnxt_re_dev *bnxt_re_dev_a
 	rdev->id = rdev->en_dev->pdev->devfn;
 	INIT_LIST_HEAD(&rdev->qp_list);
 	mutex_init(&rdev->qp_lock);
+	mutex_init(&rdev->pacing.dbq_lock);
 	atomic_set(&rdev->stats.res.qp_count, 0);
 	atomic_set(&rdev->stats.res.cq_count, 0);
 	atomic_set(&rdev->stats.res.srq_count, 0);
