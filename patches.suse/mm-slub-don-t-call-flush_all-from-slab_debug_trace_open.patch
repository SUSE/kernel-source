From: Vlastimil Babka <vbabka@suse.cz>
Date: Fri, 28 May 2021 14:32:10 +0200
Subject: mm, slub: don't call flush_all() from slab_debug_trace_open()
Git-commit: eafb1d64030abf5f885026c2074d120c13e0ca9d
Patch-mainline: v5.15-rc1
References: bsc#1189998

slab_debug_trace_open() can only be called on caches with SLAB_STORE_USER flag
and as with all slub debugging flags, such caches avoid cpu or percpu partial
slabs altogether, so there's nothing to flush.

Signed-off-by: Vlastimil Babka <vbabka@suse.cz>
Acked-by: Christoph Lameter <cl@linux.com>
---
 mm/slub.c |    3 ---
 1 file changed, 3 deletions(-)

--- a/mm/slub.c
+++ b/mm/slub.c
@@ -5825,9 +5825,6 @@ static int slab_debug_trace_open(struct
 	if (!alloc_loc_track(t, PAGE_SIZE / sizeof(struct location), GFP_KERNEL))
 		return -ENOMEM;
 
-	/* Push back cpu slabs */
-	flush_all(s);
-
 	for_each_kmem_cache_node(s, node, n) {
 		unsigned long flags;
 		struct page *page;
