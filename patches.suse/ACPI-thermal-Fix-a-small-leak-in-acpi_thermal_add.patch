From: Dan Carpenter <dan.carpenter@linaro.org>
Date: Wed, 27 Sep 2023 15:37:26 +0300
Subject: ACPI: thermal: Fix a small leak in acpi_thermal_add()
Patch-mainline: v6.7-rc1
Git-commit: 0d9741abd1c583e7bedb178358a9abd0981f49ba
References: jsc#PED-11164

Free "tz" if the "trip" allocation fails.

Fixes: 5fc2189f9335 ("ACPI: thermal: Create and populate trip points table earlier")
Signed-off-by: Dan Carpenter <dan.carpenter@linaro.org>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
Acked-by: Chun-Yi Lee <jlee@suse.com>
---
 drivers/acpi/thermal.c |    6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

--- a/drivers/acpi/thermal.c
+++ b/drivers/acpi/thermal.c
@@ -928,8 +928,10 @@ static int acpi_thermal_add(struct acpi_
 	acpi_thermal_guess_offset(tz, crit_temp);
 
 	trip = kcalloc(trip_count, sizeof(*trip), GFP_KERNEL);
-	if (!trip)
-		return -ENOMEM;
+	if (!trip) {
+		result = -ENOMEM;
+		goto free_memory;
+	}
 
 	tz->trip_table = trip;
 
