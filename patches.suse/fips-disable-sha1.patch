From: Nicolai Stange <nstange@suse.de>
Date: Wed, 08 Jan 2025 11:19:03 +0000
Subject: [PATCH] crypto/testmgr: disallow sha1 in FIPS mode
Patch-mainline: Not yet, downstream move to disable it now already
References: jsc#PED-12225

Disallow SHA1 usage in FIPS mode, as it's going to be sunset within the
lifetime of certificates issued today.

Signed-off-by: Nicolai Stange <nstange@suse.de>
---
 crypto/testmgr.c |    5 -----
 1 file changed, 5 deletions(-)

--- a/crypto/testmgr.c
+++ b/crypto/testmgr.c
@@ -4383,7 +4383,6 @@ static const struct alg_test_desc alg_te
 	}, {
 		.alg = "authenc(hmac(sha1),cbc(aes))",
 		.test = alg_test_aead,
-		.fips_allowed = 1,
 		.suite = {
 			.aead = __VECS(hmac_sha1_aes_cbc_tv_temp)
 		}
@@ -4402,7 +4401,6 @@ static const struct alg_test_desc alg_te
 	}, {
 		.alg = "authenc(hmac(sha1),ctr(aes))",
 		.test = alg_test_null,
-		.fips_allowed = 1,
 	}, {
 		.alg = "authenc(hmac(sha1),ecb(cipher_null))",
 		.test = alg_test_aead,
@@ -4412,7 +4410,6 @@ static const struct alg_test_desc alg_te
 	}, {
 		.alg = "authenc(hmac(sha1),rfc3686(ctr(aes)))",
 		.test = alg_test_null,
-		.fips_allowed = 1,
 	}, {
 		.alg = "authenc(hmac(sha224),cbc(des))",
 		.test = alg_test_aead,
@@ -5259,7 +5256,6 @@ static const struct alg_test_desc alg_te
 	}, {
 		.alg = "hmac(sha1)",
 		.test = alg_test_hash,
-		.fips_allowed = 1,
 		.suite = {
 			.hash = __VECS(hmac_sha1_tv_template)
 		}
@@ -5576,7 +5572,6 @@ static const struct alg_test_desc alg_te
 	}, {
 		.alg = "sha1",
 		.test = alg_test_hash,
-		.fips_allowed = 1,
 		.suite = {
 			.hash = __VECS(sha1_tv_template)
 		}
