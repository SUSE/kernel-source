From: Vlastimil Babka <vbabka@suse.cz>
Subject: mm/khugepaged: disable READ_ONLY_THP_FOR_FS
Patch-mainline: Never, temporary fix
References: bsc#1195774

A rare apparent data corruption was detected in OBS and traced down to
CONFIG_READ_ONLY_THP_FOR_FS collapsing of file huge pages by khugepaged. As
it's a kABI hazard to disable it completely at this stage, leave it enabled but
effectively not collapsing any file pages, until properly investigated and
fixed (including upstream).

Signed-off-by: Vlastimil Babka <vbabka@suse.cz>
---
 mm/khugepaged.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/mm/khugepaged.c
+++ b/mm/khugepaged.c
@@ -458,7 +458,7 @@ static bool hugepage_vma_check(struct vm
 		return false;
 
 	/* Only regular file is valid */
-	if (IS_ENABLED(CONFIG_READ_ONLY_THP_FOR_FS) && vma->vm_file &&
+	if (false && IS_ENABLED(CONFIG_READ_ONLY_THP_FOR_FS) && vma->vm_file &&
 	    (vm_flags & VM_EXEC)) {
 		struct inode *inode = vma->vm_file->f_inode;
 
