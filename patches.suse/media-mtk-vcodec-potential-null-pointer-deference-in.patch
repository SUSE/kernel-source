From: Fullway Wang <fullwaywang@outlook.com>
Date: Thu, 18 Jan 2024 02:35:06 +0000
Subject: [PATCH] media: mtk-vcodec: potential null pointer deference in SCP
Git-commit: 53dbe08504442dc7ba4865c09b3bbf5fe849681b
Patch-mainline: v6.10-rc1
References: CVE-2024-40973 bsc#1227890

The return value of devm_kzalloc() needs to be checked to avoid
NULL pointer deference. This is similar to CVE-2022-3113.

Link: https://lore.kernel.org/linux-media/PH7PR20MB5925094DAE3FD750C7E39E01BF712@PH7PR20MB5925.namprd20.prod.outlook.com
Signed-off-by: Fullway Wang <fullwaywang@outlook.com>
Signed-off-by: Mauro Carvalho Chehab <mchehab@kernel.org>
Signed-off-by: David Sterba <dsterba@suse.com>
---
 drivers/media/platform/mediatek/vcodec/mtk_vcodec_fw_scp.c |    2 ++
 1 file changed, 2 insertions(+)

--- a/drivers/media/platform/mediatek/vcodec/mtk_vcodec_fw_scp.c
+++ b/drivers/media/platform/mediatek/vcodec/mtk_vcodec_fw_scp.c
@@ -65,6 +65,8 @@ struct mtk_vcodec_fw *mtk_vcodec_fw_scp_
 	}
 
 	fw = devm_kzalloc(&dev->plat_dev->dev, sizeof(*fw), GFP_KERNEL);
+	if (!fw)
+		return ERR_PTR(-ENOMEM);
 	fw->type = SCP;
 	fw->ops = &mtk_vcodec_rproc_msg;
 	fw->scp = scp;
