From ac765219c2c4e44f29063724c8d36435a3e61985 Mon Sep 17 00:00:00 2001
From: Martin Jocic <martin.jocic@kvaser.com>
Date: Fri, 14 Jun 2024 17:15:19 +0200
Subject: [PATCH] can: kvaser_pciefd: Skip redundant NULL pointer check in ISR
Git-commit: ac765219c2c4e44f29063724c8d36435a3e61985
Patch-mainline: v6.11-rc1
References: stable-fixes

This check is already done at the creation of the net devices in
kvaser_pciefd_setup_can_ctrls called from kvaser_pciefd_probe.

If it fails, the driver won't load, so there should be no need to
repeat the check inside the ISR. The number of channels is read
from the FPGA and should be trusted.

Signed-off-by: Martin Jocic <martin.jocic@kvaser.com>
Link: https://lore.kernel.org/all/20240614151524.2718287-3-martin.jocic@kvaser.com
Signed-off-by: Marc Kleine-Budde <mkl@pengutronix.de>
Acked-by: Takashi Iwai <tiwai@suse.de>

---
 drivers/net/can/kvaser_pciefd.c |    6 ------
 1 file changed, 6 deletions(-)

--- a/drivers/net/can/kvaser_pciefd.c
+++ b/drivers/net/can/kvaser_pciefd.c
@@ -1721,12 +1721,6 @@ static irqreturn_t kvaser_pciefd_irq_han
 		kvaser_pciefd_receive_irq(pcie);
 
 	for (i = 0; i < pcie->nr_channels; i++) {
-		if (!pcie->can[i]) {
-			dev_err(&pcie->pci->dev,
-				"IRQ mask points to unallocated controller\n");
-			break;
-		}
-
 		/* Check that mask matches channel (i) IRQ mask */
 		if (board_irq & (1 << i))
 			kvaser_pciefd_transmit_irq(pcie->can[i]);
