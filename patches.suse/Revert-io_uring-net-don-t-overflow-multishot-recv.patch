From: Jiri Slaby <jslaby@suse.cz>
Date: Thu, 14 Sep 2023 10:27:59 +0200
Subject: Revert "io_uring/net: don't overflow multishot recv"
Patch-mainline: never, under discussion <037c9d5c-5910-49e0-af3b-70a48c36b0ca@kernel.org>
References: bsc#1215332

This reverts commit 1e2db9837be7d24a2a74eb3f3906d0872bee8907 as it breaks
iouring's recv-multishot.t test.

Signed-off-by: Jiri Slaby <jslaby@suse.cz>
---
 io_uring/net.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/io_uring/net.c
+++ b/io_uring/net.c
@@ -642,7 +642,7 @@ static inline bool io_recv_finish(struct
 
 	if (!mshot_finished) {
 		if (io_aux_cqe(req, issue_flags & IO_URING_F_COMPLETE_DEFER,
-			       *ret, cflags | IORING_CQE_F_MORE, false)) {
+			       *ret, cflags | IORING_CQE_F_MORE, true)) {
 			io_recv_prep_retry(req);
 			/* Known not-empty or unknown state, retry */
 			if (cflags & IORING_CQE_F_SOCK_NONEMPTY ||
