From: Jason Gunthorpe <jgg@nvidia.com>
Date: Thu, 11 Apr 2024 13:46:16 -0300
Subject: s390: Stop using weak symbols for __iowrite64_copy()
Git-commit: e7bc47b16622d1016b3b77bbdb20fb9e213045f2
Patch-mainline: v6.10-rc1
References: bsc#1226502

Complete switching the __iowriteXX_copy() routines over to use #define and
arch provided inline/macro functions instead of weak symbols.

S390 has an implementation that simply calls another memcpy
function. Inline this so the callers don't have to do two jumps.

Link: https://lore.kernel.org/r/3-v3-1893cd8b9369+1925-mlx5_arm_wc_jgg@nvidia.com
Acked-by: Niklas Schnelle <schnelle@linux.ibm.com>
Acked-by: Arnd Bergmann <arnd@arndb.de>
Signed-off-by: Jason Gunthorpe <jgg@nvidia.com>
[iivanov: Do not remove __weak__ implementation, preserve kABI]
Acked-by: Ivan T. Ivanov <iivanov@suse.de>
---
 arch/s390/include/asm/io.h |    7 +++++++
 1 file changed, 7 insertions(+)

--- a/arch/s390/include/asm/io.h
+++ b/arch/s390/include/asm/io.h
@@ -78,6 +78,13 @@ static inline void __iowrite32_copy(void
 }
 #define __iowrite32_copy __iowrite32_copy
 
+static inline void __iowrite64_copy(void __iomem *to, const void *from,
+				    size_t count)
+{
+	zpci_memcpy_toio(to, from, count * 8);
+}
+#define __iowrite64_copy __iowrite64_copy
+
 #endif /* CONFIG_PCI */
 
 #include <asm-generic/io.h>
