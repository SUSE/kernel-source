From 3b16431c28781c158a6823d0a742bfc3ea97e194 Mon Sep 17 00:00:00 2001
From: Mike Christie <michaelc@cs.wisc.edu>
Date: Wed, 15 Jan 2020 13:37:04 +0100
Subject: [PATCH] rbd: add lio specific data area
References: fate#318836
Patch-mainline: Not yet, SES clustered LIO/RBD

The LIO RBD backend is going to make img_request calls, so this patch
adds a pointer so it can store its cmd for completions.

Signed-off-by: Mike Christie <michaelc@cs.wisc.edu>
[ddiss: moved into union with rq/copyup state]
Signed-off-by: David Disseldorp <ddiss@suse.de>
---
 include/linux/ceph/librbd.h |    6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

--- a/include/linux/ceph/librbd.h
+++ b/include/linux/ceph/librbd.h
@@ -114,7 +114,11 @@ struct rbd_img_request {
 		u64			snap_id;	/* for reads */
 		struct ceph_snap_context *snapc;	/* for writes */
 	};
-	struct rbd_obj_request	*obj_request;	/* obj req initiator */
+ 	union {
+ 		struct request		*rq;		/* block request */
+ 		struct rbd_obj_request	*obj_request;	/* obj req initiator */
+		void			*lio_cmd_data;	/* lio specific data */
+ 	};
 	rbd_img_request_end_cb_t callback;
 
 	struct list_head	lock_item;
