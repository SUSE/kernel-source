From: "Russell King (Oracle)" <rmk+kernel@armlinux.org.uk>
Date: Fri, 26 May 2023 12:44:43 +0100
Subject: net: dpaa2-mac: use correct interface to free mdiodev
Patch-mainline: v6.5-rc1
Git-commit: 404621fab27310c231bab9a3999eab858390cb45
References: bsc#1232798

Rather than using put_device(&mdiodev->dev), use the proper interface
provided to dispose of the mdiodev - that being mdio_device_free().

Signed-off-by: Russell King (Oracle) <rmk+kernel@armlinux.org.uk>
Reviewed-by: Simon Horman <simon.horman@corigine.com>
Reviewed-by: Ioana Ciornei <ioana.ciornei@nxp.com>
Tested-by: Ioana Ciornei <ioana.ciornei@nxp.com>
Link: https://lore.kernel.org/r/E1q2VsB-008QlZ-El@rmk-PC.armlinux.org.uk
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 drivers/net/ethernet/freescale/dpaa2/dpaa2-mac.c |    5 ++---
 1 file changed, 2 insertions(+), 3 deletions(-)

--- a/drivers/net/ethernet/freescale/dpaa2/dpaa2-mac.c
+++ b/drivers/net/ethernet/freescale/dpaa2/dpaa2-mac.c
@@ -278,7 +278,7 @@ static int dpaa2_pcs_create(struct dpaa2
 	mac->pcs = lynx_pcs_create(mdiodev);
 	if (!mac->pcs) {
 		netdev_err(mac->net_dev, "lynx_pcs_create() failed\n");
-		put_device(&mdiodev->dev);
+		mdio_device_free(mdiodev);
 		return -ENOMEM;
 	}
 
@@ -291,10 +291,9 @@ static void dpaa2_pcs_destroy(struct dpa
 
 	if (phylink_pcs) {
 		struct mdio_device *mdio = lynx_get_mdio_device(phylink_pcs);
-		struct device *dev = &mdio->dev;
 
 		lynx_pcs_destroy(phylink_pcs);
-		put_device(dev);
+		mdio_device_free(mdio);
 		mac->pcs = NULL;
 	}
 }
