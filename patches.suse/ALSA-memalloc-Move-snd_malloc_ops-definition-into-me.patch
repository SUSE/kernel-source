From 5ced8b914ed46edff0d265fb6f397bc851f5fd85 Mon Sep 17 00:00:00 2001
From: Takashi Iwai <tiwai@suse.de>
Date: Tue, 10 Sep 2024 13:31:41 +0200
Subject: [PATCH] ALSA: memalloc: Move snd_malloc_ops definition into memalloc.c again
Git-commit: 5ced8b914ed46edff0d265fb6f397bc851f5fd85
Patch-mainline: v6.12-rc1
References: jsc#PED-9993 jsc#PED-10202

The definition of struct snd_malloc_ops was moved out to
memalloc_local.h since there was another code for S/G buffer
allocation referring to the struct.  But since the code change to use
non-contiguous allocators, it's solely referred in memalloc.c, hence
it makes little sense to have a separate header file.

Let's move it back to memalloc.c.

Link: https://patch.msgid.link/20240910113141.32618-1-tiwai@suse.de
Signed-off-by: Takashi Iwai <tiwai@suse.de>

---
 sound/core/memalloc.c       | 12 +++++++++++-
 sound/core/memalloc_local.h | 16 ----------------
 2 files changed, 11 insertions(+), 17 deletions(-)
 delete mode 100644 sound/core/memalloc_local.h

diff --git a/sound/core/memalloc.c b/sound/core/memalloc.c
index f3ad9f85adf1..7237d77713be 100644
--- a/sound/core/memalloc.c
+++ b/sound/core/memalloc.c
@@ -17,7 +17,17 @@
 #include <asm/set_memory.h>
 #endif
 #include <sound/memalloc.h>
-#include "memalloc_local.h"
+
+struct snd_malloc_ops {
+	void *(*alloc)(struct snd_dma_buffer *dmab, size_t size);
+	void (*free)(struct snd_dma_buffer *dmab);
+	dma_addr_t (*get_addr)(struct snd_dma_buffer *dmab, size_t offset);
+	struct page *(*get_page)(struct snd_dma_buffer *dmab, size_t offset);
+	unsigned int (*get_chunk_size)(struct snd_dma_buffer *dmab,
+				       unsigned int ofs, unsigned int size);
+	int (*mmap)(struct snd_dma_buffer *dmab, struct vm_area_struct *area);
+	void (*sync)(struct snd_dma_buffer *dmab, enum snd_dma_sync_mode mode);
+};
 
 #define DEFAULT_GFP \
 	(GFP_KERNEL | \
diff --git a/sound/core/memalloc_local.h b/sound/core/memalloc_local.h
deleted file mode 100644
index 8b19f3a68a4b..000000000000
--- a/sound/core/memalloc_local.h
+++ /dev/null
@@ -1,16 +0,0 @@
-// SPDX-License-Identifier: GPL-2.0-only
-#ifndef __MEMALLOC_LOCAL_H
-#define __MEMALLOC_LOCAL_H
-
-struct snd_malloc_ops {
-	void *(*alloc)(struct snd_dma_buffer *dmab, size_t size);
-	void (*free)(struct snd_dma_buffer *dmab);
-	dma_addr_t (*get_addr)(struct snd_dma_buffer *dmab, size_t offset);
-	struct page *(*get_page)(struct snd_dma_buffer *dmab, size_t offset);
-	unsigned int (*get_chunk_size)(struct snd_dma_buffer *dmab,
-				       unsigned int ofs, unsigned int size);
-	int (*mmap)(struct snd_dma_buffer *dmab, struct vm_area_struct *area);
-	void (*sync)(struct snd_dma_buffer *dmab, enum snd_dma_sync_mode mode);
-};
-
-#endif /* __MEMALLOC_LOCAL_H */
-- 
2.43.0

