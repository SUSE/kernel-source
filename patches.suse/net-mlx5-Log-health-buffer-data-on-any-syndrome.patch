From: Moshe Shemesh <moshe@nvidia.com>
Date: Wed, 26 Feb 2025 14:25:41 +0200
Subject: net/mlx5: Log health buffer data on any syndrome
Patch-mainline: v6.15-rc1
Git-commit: 6bdce277a32632045648abaf3386bb5229670e68
References: jsc#PED-14197 jsc#PED-14199 jsc#PED-15315

Currently health buffer data is logged either when FW fatal error
detected or miss counter reached max misses threshold.

Log health buffer whenever new health syndrome is detected.

Signed-off-by: Moshe Shemesh <moshe@nvidia.com>
Reviewed-by: Shahar Shitrit <shshitrit@nvidia.com>
Signed-off-by: Tariq Toukan <tariqt@nvidia.com>
Reviewed-by: Kalesh AP <kalesh-anakkur.purayil@broadcom.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 drivers/net/ethernet/mellanox/mlx5/core/health.c |    4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

--- a/drivers/net/ethernet/mellanox/mlx5/core/health.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/health.c
@@ -806,8 +806,10 @@ static void poll_health(struct timer_lis
 
 	prev_synd = health->synd;
 	health->synd = ioread8(&h->synd);
-	if (health->synd && health->synd != prev_synd)
+	if (health->synd && health->synd != prev_synd) {
+		print_health_info(dev);
 		queue_work(health->wq, &health->report_work);
+	}
 
 out:
 	mod_timer(&health->timer, get_next_poll_jiffies(dev));
