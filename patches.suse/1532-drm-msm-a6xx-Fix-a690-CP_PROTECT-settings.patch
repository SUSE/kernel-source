From 46a3c9456aace8c70f143e494911c55c7677b31f Mon Sep 17 00:00:00 2001
From: Rob Clark <robdclark@chromium.org>
Date: Sat, 3 Jun 2023 09:43:56 -0700
Subject: drm/msm/a6xx: Fix a690 CP_PROTECT settings
Git-commit: bf08e9791ca4e598f7088f24189dc3ef802b2a9f
Patch-mainline: v6.5-rc1
References: drm-backport-placeholder jsc#PED-3527 jsc#PED-5475 jsc#PED-6068 jsc#PED-6070 jsc#PED-6116 jsc#PED-6120 jsc#PED-5065 jsc#PED-5477 jsc#PED-5511 jsc#PED-6041 jsc#PED-6069 jsc#PED-6071

Allow access to CP_PERFCTR_CP_SEL[n] and RB_PERFCTR_RB_SEL which are
used by fdperf and pps-provider (perfetto).

Signed-off-by: Rob Clark <robdclark@chromium.org>
Acked-by: Patrik Jakobsson <pjakobsson@suse.de>
---
 drivers/gpu/drm/msm/adreno/a6xx_gpu.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/gpu/drm/msm/adreno/a6xx_gpu.c b/drivers/gpu/drm/msm/adreno/a6xx_gpu.c
index 3c2488e63e06..ab5c446e4409 100644
--- a/drivers/gpu/drm/msm/adreno/a6xx_gpu.c
+++ b/drivers/gpu/drm/msm/adreno/a6xx_gpu.c
@@ -815,7 +815,7 @@ static const u32 a690_protect[] = {
 	A6XX_PROTECT_NORDWR(0x00800, 0x00082),
 	A6XX_PROTECT_NORDWR(0x008a0, 0x00008),
 	A6XX_PROTECT_NORDWR(0x008ab, 0x00024),
-	A6XX_PROTECT_RDONLY(0x008d0, 0x000bc),
+	A6XX_PROTECT_RDONLY(0x008de, 0x000ae),
 	A6XX_PROTECT_NORDWR(0x00900, 0x0004d),
 	A6XX_PROTECT_NORDWR(0x0098d, 0x00272),
 	A6XX_PROTECT_NORDWR(0x00e00, 0x00001),
@@ -824,7 +824,7 @@ static const u32 a690_protect[] = {
 	A6XX_PROTECT_RDONLY(0x03cc4, 0x01fff),
 	A6XX_PROTECT_NORDWR(0x08630, 0x001cf),
 	A6XX_PROTECT_NORDWR(0x08e00, 0x00000),
-	A6XX_PROTECT_NORDWR(0x08e08, 0x00008),
+	A6XX_PROTECT_NORDWR(0x08e08, 0x00007),
 	A6XX_PROTECT_NORDWR(0x08e50, 0x0001f),
 	A6XX_PROTECT_NORDWR(0x08e80, 0x0027f),
 	A6XX_PROTECT_NORDWR(0x09624, 0x001db),
-- 
2.46.0

