From d9fa32dd92eb162cf996d2881a9596b28d91eb64 Mon Sep 17 00:00:00 2001
From: Nemesa Garg <nemesa.garg@intel.com>
Date: Mon, 28 Oct 2024 10:11:53 +0530
Subject: drm/i915/display: Add Wa_16023981245
Git-commit: d9fa32dd92eb162cf996d2881a9596b28d91eb64
Patch-mainline: v6.13-rc1
References: jsc#PED-13979 jsc#PED-14039 jsc#PED-14046 jsc#PED-14211 jsc#PED-14333 jsc#PED-14487 jsc#PED-14488 jsc#PED-14497 jsc#PED-14499

Disable the support for odd panning in x direction.

V2: Replace HSD with WA in commit message [Suraj]
    Modified the condition for handling odd panning

V3: Simplified the condition for checking hsub
    Using older framework for wa as rev1[Jani]

V4: Modify the condition for hsub [Sai Teja]
    Initialize hsub in else path [Dan]

V5: Replace IS_LUNARLAKE with display version.
    Resolve nitpicks[Jani]

V6: Replace -EINVAL with hsub [Suraj]
    Remove src_w check as not required

V7: Remove check for NV12.
    Add check for PTL as well [Matt]

V8: Alignment fix

Continuing discussions from:
https://patchwork.freedesktop.org/series/136416/

Signed-off-by: Nemesa Garg <nemesa.garg@intel.com>
Reviewed-by: Suraj Kandpal <suraj.kandpal@intel.com>
Signed-off-by: Suraj Kandpal <suraj.kandpal@intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20241028044153.1605209-1-nemesa.garg@intel.com
Acked-by: Patrik Jakobsson <pjakobsson@suse.de>

---
 drivers/gpu/drm/i915/display/intel_atomic_plane.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/drivers/gpu/drm/i915/display/intel_atomic_plane.c b/drivers/gpu/drm/i915/display/intel_atomic_plane.c
index b7e462075ded..73fe36f00dae 100644
--- a/drivers/gpu/drm/i915/display/intel_atomic_plane.c
+++ b/drivers/gpu/drm/i915/display/intel_atomic_plane.c
@@ -1024,6 +1024,12 @@ int intel_plane_check_src_coordinates(struct intel_plane_state *plane_state)
 		 */
 		hsub = 1;
 		vsub = 1;
+
+		/* Wa_16023981245 */
+		if ((DISPLAY_VER_FULL(i915) == IP_VER(20, 0) ||
+		     DISPLAY_VER_FULL(i915) == IP_VER(30, 0)) &&
+		     src_x % 2 != 0)
+			hsub = 2;
 	} else {
 		hsub = fb->format->hsub;
 		vsub = fb->format->vsub;
-- 
2.52.0

