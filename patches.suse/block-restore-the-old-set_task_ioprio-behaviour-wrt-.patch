From: Jiri Slaby <jslaby@suse.cz>
Date: Mon, 28 Mar 2022 10:47:58 +0200
Subject: block: restore the old set_task_ioprio() behaviour wrt PF_EXITING
Patch-mainline: submitted <20220328085928.7899-1-jslaby@suse.cz>
References: bsc#1197582

PF_EXITING tasks were silently ignored before the below commits.
Continue doing so.

Fixes: 5fc11eebb4 (block: open code create_task_io_context in set_task_ioprio)
Fixes: a957b61254 (block: fix error in handling dead task for ioprio setting)
Signed-off-by: Jiri Slaby <jslaby@suse.cz>
---
 block/blk-ioc.c |    3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

--- a/block/blk-ioc.c
+++ b/block/blk-ioc.c
@@ -280,7 +280,6 @@ int set_task_ioprio(struct task_struct *
 
 		task_lock(task);
 		if (task->flags & PF_EXITING) {
-			err = -ESRCH;
 			kmem_cache_free(iocontext_cachep, ioc);
 			goto out;
 		}
@@ -292,7 +291,7 @@ int set_task_ioprio(struct task_struct *
 	task->io_context->ioprio = ioprio;
 out:
 	task_unlock(task);
-	return err;
+	return 0;
 }
 EXPORT_SYMBOL_GPL(set_task_ioprio);
 
