From 1dcc81d95b910dc404c40ff6101bfa2520a3528e Mon Sep 17 00:00:00 2001
From: Arnd Bergmann <arnd@arndb.de>
Date: Wed, 27 Oct 2021 10:23:46 +0200
Subject: [PATCH] ASoC: amd: acp: fix Kconfig dependencies
Git-commit: 1dcc81d95b910dc404c40ff6101bfa2520a3528e
Patch-mainline: v5.16-rc1
References: jsc#PED-850

The CONFIG_SND_SOC_AMD_MACH_COMMON has some dependencies that
are not checked by the symbols that select it:

Warning: unmet direct dependencies detected for SND_SOC_AMD_MACH_COMMON  Depends on [n]: SOUND [=y] && !UML && SND [=m] && SND_SOC [=m] && X86 && PCI [=y] && I2C [=n]  Selected by [m]:  - SND_SOC_AMD_LEGACY_MACH [=m] && SOUND [=y] && !UML && SND [=m] && SND_SOC [=m]  - SND_SOC_AMD_SOF_MACH [=m] && SOUND [=y] && !UML && SND [=m] && SND_SOC [=m]

Warning: unmet direct dependencies detected for SND_SOC_AMD_MACH_COMMON  Depends on [n]: SOUND [=m] && !UML && SND [=m] && SND_SOC [=m] && X86 && PCI [=n] && I2C [=m]  Selected by [m]:  - SND_SOC_AMD_LEGACY_MACH [=m] && SOUND [=m] && !UML && SND [=m] && SND_SOC [=m]

Make this more consistent by adding the same checks everywhere.

Fixes: 9d8a7be88b33 ("ASoC: amd: acp: Add legacy sound card support for Chrome audio")
Fixes: 9f84940f5004 ("ASoC: amd: acp: Add SOF audio support on Chrome board")
Signed-off-by: Arnd Bergmann <arnd@arndb.de>
Link: https://lore.kernel.org/r/20211027082359.52248-1-arnd@kernel.org
Signed-off-by: Mark Brown <broonie@kernel.org>
Acked-by: Takashi Iwai <tiwai@suse.de>

---
 sound/soc/amd/acp/Kconfig | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/sound/soc/amd/acp/Kconfig b/sound/soc/amd/acp/Kconfig
index ba6ec96f0a64..e3d5cf993f5f 100644
--- a/sound/soc/amd/acp/Kconfig
+++ b/sound/soc/amd/acp/Kconfig
@@ -31,18 +31,19 @@ config SND_AMD_ASOC_RENOIR
 
 config SND_SOC_AMD_MACH_COMMON
 	tristate
+	depends on X86 && PCI && I2C
 	select CLK_FIXED_FCH
 	select SND_SOC_RT5682_I2C
 	select SND_SOC_DMIC
 	select SND_SOC_RT1019
 	select SND_SOC_MAX98357A
 	select SND_SOC_RT5682S
-	depends on X86 && PCI && I2C
 	help
 	  This option enables common Machine driver module for ACP.
 
 config SND_SOC_AMD_LEGACY_MACH
 	tristate "AMD Legacy Machine Driver Support"
+	depends on X86 && PCI && I2C
 	select SND_SOC_AMD_MACH_COMMON
 	depends on X86 && PCI && I2C
 	help
@@ -50,6 +51,7 @@ config SND_SOC_AMD_LEGACY_MACH
 
 config SND_SOC_AMD_SOF_MACH
 	tristate "AMD SOF Machine Driver Support"
+	depends on X86 && PCI && I2C
 	select SND_SOC_AMD_MACH_COMMON
 	depends on X86 && PCI && I2C
 	help
-- 
2.35.3

