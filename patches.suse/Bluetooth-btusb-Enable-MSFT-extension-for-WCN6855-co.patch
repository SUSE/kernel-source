From cbe6a0441315dfc0d6db62da3904d5f6d5747fab Mon Sep 17 00:00:00 2001
From: Michael Sun <michaelfsun@google.com>
Date: Thu, 29 Jul 2021 10:10:59 -0700
Subject: [PATCH] Bluetooth: btusb: Enable MSFT extension for WCN6855 controller
Git-commit: cbe6a0441315dfc0d6db62da3904d5f6d5747fab
Patch-mainline: v5.15-rc1
References: jsc#SLE-19360

The Qualcomm WCN6855 Bluetooth controller supports the Microsoft vendor
extension, enable them by setting VsMsftOpCode to 0xFD70.

Verified on a WCN6855 device through bluetoothctl show

Signed-off-by: Michael Sun <michaelfsun@google.com>
Signed-off-by: Marcel Holtmann <marcel@holtmann.org>
Acked-by: Takashi Iwai <tiwai@suse.de>

---
 drivers/bluetooth/btusb.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/drivers/bluetooth/btusb.c b/drivers/bluetooth/btusb.c
index b563226b7f4f..ab83ecc99920 100644
--- a/drivers/bluetooth/btusb.c
+++ b/drivers/bluetooth/btusb.c
@@ -4732,6 +4732,7 @@ static int btusb_probe(struct usb_interface *intf,
 		hdev->set_bdaddr = btusb_set_bdaddr_wcn6855;
 		hdev->cmd_timeout = btusb_qca_cmd_timeout;
 		set_bit(HCI_QUIRK_SIMULTANEOUS_DISCOVERY, &hdev->quirks);
+		hci_set_msft_opcode(hdev, 0xFD70);
 	}
 
 	if (id->driver_info & BTUSB_AMP) {
-- 
2.26.2

