From 003eae5a28c6c9d50290a4ac9b955be912f24c9f Mon Sep 17 00:00:00 2001
From: Benjamin Berg <benjamin.berg@intel.com>
Date: Tue, 9 Jul 2024 14:31:49 +0200
Subject: [PATCH] wifi: iwlwifi: correctly reference TSO page information
Git-commit: 003eae5a28c6c9d50290a4ac9b955be912f24c9f
Patch-mainline: v6.11-rc1
References: jsc#PED-10412

The code got copied from get_workaround_page, but here p->page is the
correct way to reference the page.

Signed-off-by: Benjamin Berg <benjamin.berg@intel.com>
Fixes: adc902ceada2 ("wifi: iwlwifi: keep the TSO and workaround pages mapped")
Reported-by: kernel test robot <lkp@intel.com>
Reported-by: Dan Carpenter <dan.carpenter@linaro.org>
Closes: https://lore.kernel.org/r/202407062135.NNjnmMdR-lkp@intel.com/
Link: https://patch.msgid.link/20240709123149.1848315-1-benjamin@sipsolutions.net
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Acked-by: Takashi Iwai <tiwai@suse.de>

---
 drivers/net/wireless/intel/iwlwifi/pcie/tx.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/net/wireless/intel/iwlwifi/pcie/tx.c b/drivers/net/wireless/intel/iwlwifi/pcie/tx.c
index 748772fa6b3e..22d482ae53d9 100644
--- a/drivers/net/wireless/intel/iwlwifi/pcie/tx.c
+++ b/drivers/net/wireless/intel/iwlwifi/pcie/tx.c
@@ -1770,7 +1770,7 @@ static void *iwl_pcie_get_page_hdr(struct iwl_trans *trans,
 	 * (see also get_workaround_page() in tx-gen2.c)
 	 */
 	if (((unsigned long)p->pos & ~PAGE_MASK) + len < IWL_TSO_PAGE_DATA_SIZE) {
-		info = IWL_TSO_PAGE_INFO(page_address(ret));
+		info = IWL_TSO_PAGE_INFO(page_address(p->page));
 		goto out;
 	}
 
@@ -1783,7 +1783,7 @@ static void *iwl_pcie_get_page_hdr(struct iwl_trans *trans,
 		return NULL;
 	p->pos = page_address(p->page);
 
-	info = IWL_TSO_PAGE_INFO(page_address(ret));
+	info = IWL_TSO_PAGE_INFO(page_address(p->page));
 
 	/* set the chaining pointer to NULL */
 	info->next = NULL;
-- 
2.43.0

