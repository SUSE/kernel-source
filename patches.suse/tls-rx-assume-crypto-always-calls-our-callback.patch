From: Jakub Kicinski <kuba@kernel.org>
Date: Mon, 11 Apr 2022 12:19:12 -0700
Subject: tls: rx: assume crypto always calls our callback
Patch-mainline: v5.19-rc1
Git-commit: 1c699ffa48a15710746989c36a82cbfb07e8d17f
References: CVE-2024-26583 CVE-2024-26584 bsc#1220185 bsc#1220186

If crypto didn't always invoke our callback for async
we'd not be clearing skb->sk and would crash in the
skb core when freeing it. This if must be dead code.

Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: Michal Kubecek <mkubecek@suse.cz>

---
 net/tls/tls_sw.c | 3 ---
 1 file changed, 3 deletions(-)

--- a/net/tls/tls_sw.c
+++ b/net/tls/tls_sw.c
@@ -272,9 +272,6 @@ static int tls_do_decryption(struct sock *sk,
 		ret = crypto_wait_req(ret, &ctx->async_wait);
 	}
 
-	if (async)
-		atomic_dec(&ctx->decrypt_pending);
-
 	return ret;
 }
 
