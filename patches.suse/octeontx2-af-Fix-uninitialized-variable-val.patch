From: Colin Ian King <colin.king@canonical.com>
Date: Fri, 17 Sep 2021 12:57:47 +0100
Subject: octeontx2-af: Fix uninitialized variable val
Patch-mainline: v5.16-rc1
Git-commit: d853f1d3c900cc16758b12853375c1ab888fae65
References: jsc#SLE-24682

In the case where the condition !is_rvu_otx2(rvu) is false variable
val is not initialized and can contain a garbage value. Fix this by
initializing val to zero and bit-wise or'ing in BIT_ULL(51) to val
for the true condition case of !is_rvu_otx2(rvu).

Addresses-Coverity: ("Uninitialized scalar variable")
Fixes: 4b5a3ab17c6c ("octeontx2-af: Hardware configuration for inline IPsec")
Signed-off-by: Colin Ian King <colin.king@canonical.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 drivers/net/ethernet/marvell/octeontx2/af/rvu_nix.c |    3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

--- a/drivers/net/ethernet/marvell/octeontx2/af/rvu_nix.c
+++ b/drivers/net/ethernet/marvell/octeontx2/af/rvu_nix.c
@@ -4599,9 +4599,10 @@ static void nix_inline_ipsec_cfg(struct
 
 	cpt_idx = (blkaddr == BLKADDR_NIX0) ? 0 : 1;
 	if (req->enable) {
+		val = 0;
 		/* Enable context prefetching */
 		if (!is_rvu_otx2(rvu))
-			val = BIT_ULL(51);
+			val |= BIT_ULL(51);
 
 		/* Set OPCODE and EGRP */
 		val |= FIELD_PREP(IPSEC_GEN_CFG_EGRP, req->gen_cfg.egrp);
