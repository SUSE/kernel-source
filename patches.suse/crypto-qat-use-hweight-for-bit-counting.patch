From c3878a786be09d3f7df17936c922be430cdd4e8e Mon Sep 17 00:00:00 2001
From: Giovanni Cabiddu <giovanni.cabiddu@intel.com>
Date: Tue, 28 Sep 2021 12:44:34 +0100
Subject: [PATCH] crypto: qat - use hweight for bit counting
Git-commit: c3878a786be09d3f7df17936c922be430cdd4e8e
Patch-mainline: v5.16-rc1
References: jsc#PED-1073

Replace homegrown bit counting logic in adf_gen2_get_num_accels() and
adf_gen2_get_num_aes() with the functions hweight16() and hweight32(),
respectively.

Signed-off-by: Giovanni Cabiddu <giovanni.cabiddu@intel.com>
Reviewed-by: Marco Chiappero <marco.chiappero@intel.com>
Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
Signed-off-by: Torsten Duwe <duwe@suse.de>

---
 drivers/crypto/qat/qat_common/adf_gen2_hw_data.c | 16 ++--------------
 1 file changed, 2 insertions(+), 14 deletions(-)

diff --git a/drivers/crypto/qat/qat_common/adf_gen2_hw_data.c b/drivers/crypto/qat/qat_common/adf_gen2_hw_data.c
index 1deeeaed9a8cb..262bdc05dab4e 100644
--- a/drivers/crypto/qat/qat_common/adf_gen2_hw_data.c
+++ b/drivers/crypto/qat/qat_common/adf_gen2_hw_data.c
@@ -54,31 +54,19 @@ EXPORT_SYMBOL_GPL(adf_gen2_disable_vf2pf_interrupts);
 
 u32 adf_gen2_get_num_accels(struct adf_hw_device_data *self)
 {
-	u32 i, ctr = 0;
-
 	if (!self || !self->accel_mask)
 		return 0;
 
-	for (i = 0; i < self->num_accel; i++)
-		if (self->accel_mask & (1 << i))
-			ctr++;
-
-	return ctr;
+	return hweight16(self->accel_mask);
 }
 EXPORT_SYMBOL_GPL(adf_gen2_get_num_accels);
 
 u32 adf_gen2_get_num_aes(struct adf_hw_device_data *self)
 {
-	u32 i, ctr = 0;
-
 	if (!self || !self->ae_mask)
 		return 0;
 
-	for (i = 0; i < self->num_engines; i++)
-		if (self->ae_mask & (1 << i))
-			ctr++;
-
-	return ctr;
+	return hweight32(self->ae_mask);
 }
 EXPORT_SYMBOL_GPL(adf_gen2_get_num_aes);
 
-- 
2.35.3

