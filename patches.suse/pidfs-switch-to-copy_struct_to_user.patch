From: Christian Brauner <brauner@kernel.org>
Date: Wed, 5 Mar 2025 11:08:11 +0100
Subject: pidfs: switch to copy_struct_to_user()
Git-commit: 816b2e602035214de9ca2f68751e64ecef023dd1
Patch-mainline: v6.15-rc1
References: jsc#PED-13113

We have a helper that deals with all the required logic.

Link: https://lore.kernel.org/r/20250305-work-pidfs-kill_on_last_close-v3-1-c8c3d8361705@kernel.org
Reviewed-by: Jeff Layton <jlayton@kernel.org>
Reviewed-by: Oleg Nesterov <oleg@redhat.com>
Signed-off-by: Christian Brauner <brauner@kernel.org>
Acked-by: Michal Koutn√Ω <mkoutny@suse.com>
---
 fs/pidfs.c |    5 +----
 1 file changed, 1 insertion(+), 4 deletions(-)

--- a/fs/pidfs.c
+++ b/fs/pidfs.c
@@ -184,10 +184,7 @@ static long pidfd_info(struct task_struc
 	 * userspace knows about will be copied. If userspace provides a new
 	 * struct, only the bits that the kernel knows about will be copied.
 	 */
-	if (copy_to_user(uinfo, &kinfo, min(usize, sizeof(kinfo))))
-		return -EFAULT;
-
-	return 0;
+	return copy_struct_to_user(uinfo, usize, &kinfo, sizeof(kinfo), NULL);
 }
 
 static long pidfd_ioctl(struct file *file, unsigned int cmd, unsigned long arg)
