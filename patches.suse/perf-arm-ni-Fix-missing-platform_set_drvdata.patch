From: Hongbo Yao <andy.xu@hj-micro.com>
Date: Tue, 1 Apr 2025 13:42:48 +0800
Subject: [PATCH] perf: arm-ni: Fix missing platform_set_drvdata()
Git-commit: fc5106088d6db75df61308ef6de314d1f7959646
Patch-mainline: v6.16-rc1
References: CVE-2025-38318 bsc#1246444

Add missing platform_set_drvdata in arm_ni_probe(), otherwise
calling platform_get_drvdata() in remove returns NULL.

Fixes: 4d5a7680f2b4 ("perf: Add driver for Arm NI-700 interconnect PMU")
Signed-off-by: Hongbo Yao <andy.xu@hj-micro.com>
Reviewed-by: Robin Murphy <robin.murphy@arm.com>
Link: https://lore.kernel.org/r/20250401054248.3985814-1-andy.xu@hj-micro.com
Signed-off-by: Will Deacon <will@kernel.org>
Signed-off-by: David Sterba <dsterba@suse.com>
---
 drivers/perf/arm-ni.c |    1 +
 1 file changed, 1 insertion(+)

--- a/drivers/perf/arm-ni.c
+++ b/drivers/perf/arm-ni.c
@@ -644,6 +644,7 @@ static int arm_ni_probe(struct platform_
 	ni->num_cds = num_cds;
 	ni->part = part;
 	ni->id = atomic_fetch_inc(&id);
+	platform_set_drvdata(pdev, ni);
 
 	for (int v = 0; v < cfg.num_components; v++) {
 		reg = readl_relaxed(cfg.base + NI_CHILD_PTR(v));
