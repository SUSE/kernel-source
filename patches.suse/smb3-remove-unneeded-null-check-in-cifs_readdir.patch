From: Steve French <stfrench@microsoft.com>
Date: Wed, 25 May 2022 23:56:07 -0500
Subject: [PATCH] smb3: remove unneeded null check in cifs_readdir
Git-commit: 44a48081fc03187d3c047077f3ad3eb3a3eaf8fb
References: bsc#1193629
Patch-mainline: v5.19-rc1

Coverity pointed out an unneeded check.

Addresses-Coverity: 1518030 ("Null pointer dereferences")
Reviewed-by: Ronnie Sahlberg <lsahlber@redhat.com>
Signed-off-by: Steve French <stfrench@microsoft.com>
Acked-by: Paulo Alcantara <palcantara@suse.de>
---
 fs/cifs/readdir.c | 6 ++----
 fs/cifs/smb2ops.c | 1 +
 2 files changed, 3 insertions(+), 4 deletions(-)

diff --git a/fs/cifs/readdir.c b/fs/cifs/readdir.c
index ccf34481d801..384cabdf47ca 100644
--- a/fs/cifs/readdir.c
+++ b/fs/cifs/readdir.c
@@ -1105,10 +1105,8 @@ int cifs_readdir(struct file *file, struct dir_context *ctx)
 	 * find_cifs_entry in case there will be reconnects during
 	 * query_directory.
 	 */
-	if (cfid) {
-		close_cached_dir(cfid);
-		cfid = NULL;
-	}
+	close_cached_dir(cfid);
+	cfid = NULL;
 
  cache_not_found:
 	/*
diff --git a/fs/cifs/smb2ops.c b/fs/cifs/smb2ops.c
index 7e2c86e0cede..d7ade739cde1 100644
--- a/fs/cifs/smb2ops.c
+++ b/fs/cifs/smb2ops.c
@@ -770,6 +770,7 @@ smb2_cached_lease_break(struct work_struct *work)
 /*
  * Open the and cache a directory handle.
  * Only supported for the root handle.
+ * If error then *cfid is not initialized.
  */
 int open_cached_dir(unsigned int xid, struct cifs_tcon *tcon,
 		const char *path,
-- 
2.37.3


