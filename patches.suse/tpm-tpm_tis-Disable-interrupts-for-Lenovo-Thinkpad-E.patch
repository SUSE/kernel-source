From: Takashi Iwai <tiwai@suse.de>
Date: Mon,  7 Aug 2023 16:01:25 +0200
Subject: [PATCH] tpm/tpm_tis: Disable interrupts for Lenovo Thinkpad E14 Gen 2
 and 13s-IML
Message-Id: <20230807140125.18486-1-tiwai@suse.de>
Patch-mainline: Submitted, linux-integrity ML
References: bsc#1213779

Like other Lenovo laptops, Thinkpad E14 Gen 2 and Thinkpad 13s-IML
also require to disable the tpm_tis interrupts for avoiding a boot
hang.

Fixes: e644b2f498d2 ("tpm, tpm_tis: Enable interrupt test")
Cc: <stable@vger.kernel.org> # v6.4+
Link: https://bugzilla.suse.com/show_bug.cgi?id=1213779
Signed-off-by: Takashi Iwai <tiwai@suse.de>

---
 drivers/char/tpm/tpm_tis.c | 16 ++++++++++++++++
 1 file changed, 16 insertions(+)

diff --git a/drivers/char/tpm/tpm_tis.c b/drivers/char/tpm/tpm_tis.c
index a98773ac2e55..0633823dc515 100644
--- a/drivers/char/tpm/tpm_tis.c
+++ b/drivers/char/tpm/tpm_tis.c
@@ -130,6 +130,22 @@ static const struct dmi_system_id tpm_tis_dmi_table[] = {
 			DMI_MATCH(DMI_PRODUCT_NAME, "Laptop (13th Gen Intel Core)"),
 		},
 	},
+	{
+		.callback = tpm_tis_disable_irq,
+		.ident = "ThinkPad E14 Gen 2",
+		.matches = {
+			DMI_MATCH(DMI_SYS_VENDOR, "LENOVO"),
+			DMI_MATCH(DMI_PRODUCT_VERSION, "ThinkPad E14 Gen 2"),
+		},
+	},
+	{
+		.callback = tpm_tis_disable_irq,
+		.ident = "ThinkBook 13s-IML",
+		.matches = {
+			DMI_MATCH(DMI_SYS_VENDOR, "LENOVO"),
+			DMI_MATCH(DMI_PRODUCT_VERSION, "Lenovo ThinkBook 13s-IML"),
+		},
+	},
 	{
 		.callback = tpm_tis_disable_irq,
 		.ident = "ThinkPad T490s",
-- 
2.35.3

