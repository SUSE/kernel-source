From b7bfd85faa2a998202434d364742caebd0e6722f Mon Sep 17 00:00:00 2001
From: Oliver Neukum <oneukum@suse.com>
Date: Wed, 28 Feb 2024 12:48:15 +0100
Subject: [PATCH 2/5] padding: XHCI additional padding
Patch-mainline: Never, kabi padding
References: bsc#1220369

Where it doesn't hurt, adding it.

Signed-off-by: Oliver Neukum <oneukum@suse.com>
---
 drivers/usb/host/xhci-dbgcap.h |    4 ++++
 drivers/usb/host/xhci.h        |   16 ++++++++++++++++
 2 files changed, 20 insertions(+)

--- a/drivers/usb/host/xhci-dbgcap.h
+++ b/drivers/usb/host/xhci-dbgcap.h
@@ -113,11 +113,13 @@ struct dbc_port {
 	unsigned int			tx_boundary;
 
 	bool				registered;
+	void *suse_kabi_padding;
 };
 
 struct dbc_driver {
 	int (*configure)(struct xhci_dbc *dbc);
 	void (*disconnect)(struct xhci_dbc *dbc);
+	void *suse_kabi_padding;
 };
 
 struct xhci_dbc {
@@ -146,6 +148,7 @@ struct xhci_dbc {
 	struct dbc_ep			eps[2];
 
 	const struct dbc_driver		*driver;
+	void *suse_kabi_padding;
 	void				*priv;
 };
 
@@ -164,6 +167,7 @@ struct dbc_request {
 	dma_addr_t			trb_dma;
 	union xhci_trb			*trb;
 	unsigned			direction:1;
+	void *suse_kabi_padding;
 };
 
 #define dbc_bulkout_ctx(d)		\
--- a/drivers/usb/host/xhci.h
+++ b/drivers/usb/host/xhci.h
@@ -538,6 +538,8 @@ struct xhci_command {
 	struct list_head		cmd_list;
 	/* xHCI command response timeout in milliseconds */
 	unsigned int			timeout_ms;
+
+	void *suse_kabi_padding;
 };
 
 /* drop context bitmasks */
@@ -580,6 +582,7 @@ struct xhci_stream_info {
 	/* For mapping physical TRB addresses to segments in stream rings */
 	struct radix_tree_root		trb_address_map;
 	struct xhci_command		*free_streams_command;
+	void *suse_kabi_padding;
 };
 
 #define	SMALL_STREAM_ARRAY_SIZE		256
@@ -695,6 +698,7 @@ struct xhci_virt_ep {
 	int			next_frame_id;
 	/* Use new Isoch TRB layout needed for extended TBC support */
 	bool			use_extended_tbc;
+	void *suse_kabi_padding;
 };
 
 enum xhci_overhead_type {
@@ -757,6 +761,7 @@ struct xhci_virt_device {
 	u16				current_mel;
 	/* Used for the debugfs interfaces. */
 	void				*debugfs_private;
+	void *suse_kabi_padding;
 };
 
 /*
@@ -1271,6 +1276,7 @@ struct xhci_segment {
 	void			*bounce_buf;
 	unsigned int		bounce_offs;
 	unsigned int		bounce_len;
+	void *suse_kabi_padding;
 };
 
 enum xhci_cancelled_td_status {
@@ -1295,6 +1301,8 @@ struct xhci_td {
 	/* actual_length of the URB has already been set */
 	bool			urb_length_set;
 	bool			error_mid_td;
+
+	void *suse_kabi_padding;
 };
 
 /*
@@ -1362,6 +1370,7 @@ struct xhci_ring {
 	enum xhci_ring_type	type;
 	bool			last_td_was_short;
 	struct radix_tree_root	*trb_address_map;
+	void *suse_kabi_padding;
 };
 
 struct xhci_erst_entry {
@@ -1388,6 +1397,7 @@ struct xhci_scratchpad {
 struct urb_priv {
 	int	num_tds;
 	int	num_tds_done;
+	void *suse_kabi_padding;
 	struct	xhci_td	td[] __counted_by(num_tds);
 };
 
@@ -1423,6 +1433,7 @@ struct xhci_bus_state {
 	u32			port_remote_wakeup;
 	/* which ports have started to resume */
 	unsigned long		resuming_ports;
+	void *suse_kabi_padding;
 };
 
 struct xhci_interrupter {
@@ -1438,6 +1449,7 @@ struct xhci_interrupter {
 	u32	s3_erst_size;
 	u64	s3_erst_base;
 	u64	s3_erst_dequeue;
+	void *suse_kabi_padding;
 };
 /*
  * It can take up to 20 ms to transition from RExit to U0 on the
@@ -1466,6 +1478,7 @@ struct xhci_port {
 	int			slot_id;
 	struct completion	rexit_done;
 	struct completion	u3exit_done;
+	void *suse_kabi_padding;
 };
 
 struct xhci_hub {
@@ -1477,6 +1490,7 @@ struct xhci_hub {
 	/* supported prococol extended capabiliy values */
 	u8			maj_rev;
 	u8			min_rev;
+	void *suse_kabi_padding;
 };
 
 /* There is one xhci_hcd structure per controller */
@@ -1653,6 +1667,7 @@ struct xhci_hcd {
 	struct list_head	regset_list;
 
 	void			*dbc;
+	void *suse_kabi_padding;
 	/* platform-specific data -- must come last */
 	unsigned long		priv[] __aligned(sizeof(s64));
 };
@@ -1672,6 +1687,7 @@ struct xhci_driver_overrides {
 			    struct usb_tt *tt, gfp_t mem_flags);
 	int (*hub_control)(struct usb_hcd *hcd, u16 typeReq, u16 wValue,
 			   u16 wIndex, char *buf, u16 wLength);
+	void *suse_kabi_padding;
 };
 
 #define	XHCI_CFC_DELAY		10
