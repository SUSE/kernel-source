From a9802ce210a8caccd5456c782c8a4d8d6fdc2115 Mon Sep 17 00:00:00 2001
From: Yousaf Kaukab <ykaukab@suse.de>
Date: Fri, 10 Jan 2025 15:08:25 +0100
Subject: [PATCH] stackleak: disable stack erasing by default

Patch-mainline: Never, workaround for unreliable sysctl configuration handling
References: jsc#PED-11837

It is possible to disable stack erasing by setting stack_erasing
sysctl to 0. However, it is unclear how sysctl files are handled by
different packages. Disable stack_erasing by changing the default value
of the static key. This should probably be a kernel configuration option
upstream.

Signed-off-by: Yousaf Kaukab <ykaukab@suse.de>
---
 kernel/stackleak.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/kernel/stackleak.c b/kernel/stackleak.c
index 0f4804f28c61..9d070fbd970b 100644
--- a/kernel/stackleak.c
+++ b/kernel/stackleak.c
@@ -19,7 +19,7 @@
 #include <linux/sysctl.h>
 #include <linux/init.h>
 
-static DEFINE_STATIC_KEY_FALSE(stack_erasing_bypass);
+static DEFINE_STATIC_KEY_TRUE(stack_erasing_bypass);
 
 #ifdef CONFIG_SYSCTL
 static int stack_erasing_sysctl(const struct ctl_table *table, int write,
-- 
2.43.0

