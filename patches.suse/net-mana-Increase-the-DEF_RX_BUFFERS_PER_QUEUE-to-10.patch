From: Shradha Gupta <shradhagupta@linux.microsoft.com>
Date: Sun, 29 Sep 2024 20:44:35 -0700
Subject: net: mana: Increase the DEF_RX_BUFFERS_PER_QUEUE to 1024
Patch-mainline: v6.13-rc1
Git-commit: e26a0c5d828b225b88f534e2fcf10bf617f85f23
References: bsc#1235246

Through some experiments, we found out that increasing the default
RX buffers count from 512 to 1024, gives slightly better throughput
and significantly reduces the no_wqe_rx errs on the receiver side.
Along with these, other parameters like cpu usage, retrans seg etc
also show some improvement with 1024 value.

Following are some snippets from the experiments

ntttcp tests with 512 Rx buffers
---------------------------------------
connections|  throughput|  no_wqe errs|
---------------------------------------
1          |  40.93Gbps | 123,211     |
16         | 180.15Gbps | 190,120     |
128        | 180.20Gbps | 173,508     |
256        | 180.27Gbps | 189,884     |

ntttcp tests with 1024 Rx buffers
---------------------------------------
connections|  throughput|  no_wqe errs|
---------------------------------------
1          |  44.22Gbps | 19,864      |
16         | 180.19Gbps | 4,430       |
128        | 180.21Gbps | 2,560       |
256        | 180.29Gbps | 1,529       |

So, increasing the default RX buffers per queue count to 1024

Signed-off-by: Shradha Gupta <shradhagupta@linux.microsoft.com>
Reviewed-by: Haiyang Zhang <haiyangz@microsoft.com>
Reviewed-by: Pavan Chebbi <pavan.chebbi@broadcom.com>
Link: https://patch.msgid.link/1727667875-29908-1-git-send-email-shradhagupta@linux.microsoft.com
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 include/net/mana/mana.h |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/include/net/mana/mana.h
+++ b/include/net/mana/mana.h
@@ -36,7 +36,7 @@ enum TRI_STATE {
 
 #define COMP_ENTRY_SIZE 64
 
-#define RX_BUFFERS_PER_QUEUE 512
+#define RX_BUFFERS_PER_QUEUE 1024
 
 #define MAX_SEND_BUFFERS_PER_QUEUE 256
 
