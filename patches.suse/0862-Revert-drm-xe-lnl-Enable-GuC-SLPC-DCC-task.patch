From 55d4b69861e853ac987f6d593b44a3c18b468576 Mon Sep 17 00:00:00 2001
From: Rodrigo Vivi <rodrigo.vivi@intel.com>
Date: Tue, 28 Jan 2025 17:32:48 -0500
Subject: Revert "drm/xe/lnl: Enable GuC SLPC DCC task"
Git-commit: 55d4b69861e853ac987f6d593b44a3c18b468576
Patch-mainline: v6.15-rc1
References: jsc#PED-13979 jsc#PED-14039 jsc#PED-14046 jsc#PED-14211 jsc#PED-14333 jsc#PED-14487 jsc#PED-14488 jsc#PED-14497 jsc#PED-14499

This reverts commit 50554bf3e56dd0c78ef1eedb685d0ab36c9c9987.

DCC in LNL should be disabled. It was a mistake to decide
to go against GuC platform defaults in this case and this
could lead to regressions in some TDP limited scenarios
instead of helping.

Cc: Vinay Belgaumkar <vinay.belgaumkar@intel.com>
Cc: Jonathan Cavitt <jonathan.cavitt@intel.com>
Reviewed-by: Jonathan Cavitt <jonathan.cavitt@intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20250128223248.660748-1-rodrigo.vivi@intel.com
Signed-off-by: Rodrigo Vivi <rodrigo.vivi@intel.com>
Acked-by: Patrik Jakobsson <pjakobsson@suse.de>

---
 drivers/gpu/drm/xe/xe_guc_pc.c | 25 -------------------------
 1 file changed, 25 deletions(-)

diff --git a/drivers/gpu/drm/xe/xe_guc_pc.c b/drivers/gpu/drm/xe/xe_guc_pc.c
index 9f0b6e0a09f3..6b295fbe28d1 100644
--- a/drivers/gpu/drm/xe/xe_guc_pc.c
+++ b/drivers/gpu/drm/xe/xe_guc_pc.c
@@ -1008,27 +1008,6 @@ static int pc_init_freqs(struct xe_guc_pc *pc)
 	return ret;
 }
 
-static int slpc_enable_dcc(struct xe_guc_pc *pc)
-{
-	int ret;
-
-	ret = pc_action_set_param(pc, SLPC_PARAM_TASK_ENABLE_DCC, 1);
-	if (ret)
-		return ret;
-
-	return pc_action_set_param(pc, SLPC_PARAM_TASK_DISABLE_DCC, 0);
-}
-
-static int slpc_set_policies(struct xe_guc_pc *pc)
-{
-	struct xe_device *xe = pc_to_xe(pc);
-
-	if (xe->info.platform == XE_LUNARLAKE)
-		return slpc_enable_dcc(pc);
-
-	return 0;
-}
-
 /**
  * xe_guc_pc_start - Start GuC's Power Conservation component
  * @pc: Xe_GuC_PC instance
@@ -1085,10 +1064,6 @@ int xe_guc_pc_start(struct xe_guc_pc *pc)
 			   ktime_ms_delta(ktime_get(), earlier));
 	}
 
-	ret = slpc_set_policies(pc);
-	if (ret)
-		goto out;
-
 	ret = pc_init_freqs(pc);
 	if (ret)
 		goto out;
-- 
2.52.0

