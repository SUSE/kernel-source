From ed4042e7e4035d290bdba6e8e66397645a6150e4 Mon Sep 17 00:00:00 2001
From: Thomas Zimmermann <tzimmermann@suse.com>
Date: Fri, 19 Jan 2024 09:23:33 +0100
Subject: fbdev: Only disable sysfb on the primary device
Patch-mainline: Never, SLE-specific workaround
References: bsc#1216441

Sysfb only operates on the primary display device. Never touch its
state when handling non-primary devices.

Signed-off-by: Thomas Zimmermann <tzimmermann@suse.com>
Acked-by: Thomas Zimmermann <tzimmermann@suse.com>
---
 drivers/video/fbdev/core/fbmem.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/drivers/video/fbdev/core/fbmem.c b/drivers/video/fbdev/core/fbmem.c
index fd2026e7980bc..9a5cd50a51cde 100644
--- a/drivers/video/fbdev/core/fbmem.c
+++ b/drivers/video/fbdev/core/fbmem.c
@@ -1792,7 +1792,8 @@ int remove_conflicting_framebuffers(struct apertures_struct *a,
 	 * ask for this, so let's assume that a real driver for the display
 	 * was already probed and prevent sysfb to register devices later.
 	 */
-	sysfb_disable();
+	if (primary)
+		sysfb_disable();
 
 	mutex_lock(&registration_lock);
 	do_remove_conflicting_framebuffers(a, name, primary);
-- 
2.43.0

