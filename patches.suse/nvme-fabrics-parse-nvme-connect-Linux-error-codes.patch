From: Amit Engel <amit.engel@dell.com>
Date: Mon, 1 Aug 2022 21:40:39 +0300
Subject: nvme-fabrics: parse nvme connect Linux error codes
Patch-mainline: v6.0-rc1
Git-commit: ec9e96b5230148294c7abcaf3a4c592d3720b62d
References: bsc#1201865

This fixes the assumption that errval is an unsigned nvme error

Signed-off-by: Amit Engel <amit.engel@dell.com>
Signed-off-by: Christoph Hellwig <hch@lst.de>
Acked-by: Daniel Wagner <dwagner@suse.de>
---
 drivers/nvme/host/fabrics.c |    6 ++++++
 1 file changed, 6 insertions(+)

--- a/drivers/nvme/host/fabrics.c
+++ b/drivers/nvme/host/fabrics.c
@@ -270,6 +270,12 @@ static void nvmf_log_connect_error(struc
 {
 	int err_sctype = errval & ~NVME_SC_DNR;
 
+	if (errval < 0) {
+		dev_err(ctrl->device,
+			"Connect command failed, errno: %d\n", errval);
+		return;
+	}
+
 	switch (err_sctype) {
 	case NVME_SC_CONNECT_INVALID_PARAM:
 		if (offset >> 16) {
