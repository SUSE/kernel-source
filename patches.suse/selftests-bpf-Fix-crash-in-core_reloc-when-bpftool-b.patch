From: Yucong Sun <fallentree@fb.com>
Date: Thu, 17 Feb 2022 10:02:10 -0800
Subject: selftests/bpf: Fix crash in core_reloc when bpftool btfgen fails
Patch-mainline: v5.18-rc1
Git-commit: b75dacaac4650478ed5a9d33975b91b99016daff
References: jsc#PED-1368

Avoid unnecessary goto cleanup, as there is nothing to clean up.

Signed-off-by: Yucong Sun <fallentree@fb.com>
Signed-off-by: Andrii Nakryiko <andrii@kernel.org>
Link: https://lore.kernel.org/bpf/20220217180210.2981502-1-fallentree@fb.com
Acked-by: Shung-Hsi Yu <shung-hsi.yu@suse.com>
---
 tools/testing/selftests/bpf/prog_tests/core_reloc.c |    4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

--- a/tools/testing/selftests/bpf/prog_tests/core_reloc.c
+++ b/tools/testing/selftests/bpf/prog_tests/core_reloc.c
@@ -888,12 +888,12 @@ static void run_core_reloc_tests(bool us
 
 			fd = mkstemp(btf_file);
 			if (!ASSERT_GE(fd, 0, "btf_tmp"))
-				goto cleanup;
+				continue;
 			close(fd); /* we only need the path */
 			err = run_btfgen(test_case->btf_src_file, btf_file,
 					 test_case->bpf_obj_file);
 			if (!ASSERT_OK(err, "run_btfgen"))
-				goto cleanup;
+				continue;
 
 			test_case->btf_src_file = btf_file;
 		}
