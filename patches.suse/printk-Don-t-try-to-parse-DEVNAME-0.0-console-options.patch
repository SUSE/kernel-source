From ca6c5b745346d3de6d6c10ac58f79bef50bf1c9f Mon Sep 17 00:00:00 2001
From: Tony Lindgren <tony@atomide.com>
Date: Wed, 27 Mar 2024 12:59:36 +0200
Subject: [PATCH] printk: Don't try to parse DEVNAME:0.0 console options

References: bsc#1214683 (PREEMPT_RT prerequisite backports)
Patch-mainline: v6.10-rc1
Git-commit: 8a831c584e6e80cf68f79893dc395c16cdf47dc8

Currently console_setup() tries to make a console index out of any digits
passed in the kernel command line for console. In the DEVNAME:0.0 case,
the name can contain a device IO address, so bail out on console names
with a ':'.

Signed-off-by: Tony Lindgren <tony@atomide.com>
Link: https://lore.kernel.org/r/20240327110021.59793-3-tony@atomide.com
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Mel Gorman <mgorman@suse.de>
---
 kernel/printk/printk.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/kernel/printk/printk.c b/kernel/printk/printk.c
index 543ce924361c..bb72641f068f 100644
--- a/kernel/printk/printk.c
+++ b/kernel/printk/printk.c
@@ -2509,6 +2509,10 @@ static int __init console_setup(char *str)
 	if (console_opt_save(str, brl_options))
 		return 1;
 
+	/* Don't attempt to parse a DEVNAME:0.0 style console */
+	if (strchr(str, ':'))
+		return 1;
+
 	/*
 	 * Decode str into name, index, options.
 	 */
