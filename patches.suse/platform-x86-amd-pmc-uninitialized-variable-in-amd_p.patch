From d713b8d2aa03454e676fbf453b1231c43033c33d Mon Sep 17 00:00:00 2001
From: Dan Carpenter <dan.carpenter@oracle.com>
Date: Mon, 7 Mar 2022 17:18:32 +0300
Subject: [PATCH] platform/x86: amd-pmc: uninitialized variable in amd_pmc_s2d_init()
Git-commit: d713b8d2aa03454e676fbf453b1231c43033c33d
Patch-mainline: v5.18-rc1
References: bsc#1210644

The "size" variable can be uninitialized if amd_pmc_send_cmd() fails.

Fixes: 3d7d407dfb05 ("platform/x86: amd-pmc: Add support for AMD Spill to DRAM STB feature")
Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
Link: https://lore.kernel.org/r/20220307141832.GA19660@kili
Signed-off-by: Hans de Goede <hdegoede@redhat.com>
Acked-by: Takashi Iwai <tiwai@suse.de>

---
 drivers/platform/x86/amd-pmc.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/drivers/platform/x86/amd-pmc.c b/drivers/platform/x86/amd-pmc.c
index 425a86108f75..fc0b4d628dec 100644
--- a/drivers/platform/x86/amd-pmc.c
+++ b/drivers/platform/x86/amd-pmc.c
@@ -708,8 +708,9 @@ static const struct pci_device_id pmc_pci_ids[] = {
 
 static int amd_pmc_s2d_init(struct amd_pmc_dev *dev)
 {
-	u32 size, phys_addr_low, phys_addr_hi;
+	u32 phys_addr_low, phys_addr_hi;
 	u64 stb_phys_addr;
+	u32 size = 0;
 
 	/* Spill to DRAM feature uses separate SMU message port */
 	dev->msg_port = 1;
-- 
2.35.3

