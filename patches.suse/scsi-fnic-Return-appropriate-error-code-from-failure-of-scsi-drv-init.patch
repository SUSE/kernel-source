From: Karan Tilak Kumar <kartilak@cisco.com>
Date: Fri, 10 Jan 2025 01:18:42 -0800
Subject: scsi: fnic: Return appropriate error code from failure of scsi drv
 init
Git-commit: 3986001ca11ec630d631467d788aac513c61cb52
Patch-mainline: v6.14-rc1
References: jsc#PED-12186

Return appropriate error code from fnic_probe caused by failure of
fnic_scsi_drv_init. Fix bug report.

Suggested-by: Dan Carpenter <dan.carpenter@linaro.org>
Reviewed-by: Sesidhar Baddela <sebaddel@cisco.com>
Reviewed-by: Arulprabhu Ponnusamy <arulponn@cisco.com>
Reviewed-by: Gian Carlo Boffa <gcboffa@cisco.com>
Reviewed-by: Arun Easi <aeasi@cisco.com>
Signed-off-by: Karan Tilak Kumar <kartilak@cisco.com>
Link: https://lore.kernel.org/r/20250110091842.17711-1-kartilak@cisco.com
Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
Acked-by: Lee Duncan <lduncan@suse.com>
---
 drivers/scsi/fnic/fnic_main.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/drivers/scsi/fnic/fnic_main.c b/drivers/scsi/fnic/fnic_main.c
index 2d51adf18501..9ed42d5819d5 100644
--- a/drivers/scsi/fnic/fnic_main.c
+++ b/drivers/scsi/fnic/fnic_main.c
@@ -1039,7 +1039,8 @@ static int fnic_probe(struct pci_dev *pdev, const struct pci_device_id *ent)
 
 	fnic_fdls_init(fnic, (fnic->config.flags & VFCF_FIP_CAPABLE));
 
-	if (fnic_scsi_drv_init(fnic))
+	err = fnic_scsi_drv_init(fnic);
+	if (err)
 		goto err_out_scsi_drv_init;
 
 	err = fnic_stats_debugfs_init(fnic);

