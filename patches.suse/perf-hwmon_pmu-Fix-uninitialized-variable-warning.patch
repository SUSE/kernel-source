From cc8b72fe13861da24967c45b65cd16786ff325aa Mon Sep 17 00:00:00 2001
From: Michal Suchanek <msuchanek@suse.de>
Date: Wed, 22 Oct 2025 12:37:07 +0200
Subject: [PATCH] perf hwmon_pmu: Fix uninitialized variable warning

Patch-mainline: Submitted https://lore.kernel.org/linux-perf-users/20251022103839.19550-1-msuchanek@suse.de/T/#u
References: perf-sle16-v6.13-userspace-update, git-fixes

The line_len is only set on success. Check the return value instead.

Fixes: 53cc0b351ec9 ("perf hwmon_pmu: Add a tool PMU exposing events from hwmon in sysfs")
Signed-off-by: Michal Suchanek <msuchanek@suse.de>
---
 tools/perf/util/hwmon_pmu.c | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/tools/perf/util/hwmon_pmu.c b/tools/perf/util/hwmon_pmu.c
index 6ba46cc43dfe..407f1808abf9 100644
--- a/tools/perf/util/hwmon_pmu.c
+++ b/tools/perf/util/hwmon_pmu.c
@@ -738,8 +738,7 @@ int perf_pmus__read_hwmon_pmus(struct list_head *pmus)
 			continue;
 		}
 		io__init(&io, name_fd, buf, sizeof(buf));
-		io__getline(&io, &line, &line_len);
-		if (line_len > 0 && line[line_len - 1] == '\n')
+		if (io__getline(&io, &line, &line_len) > 0 && line[line_len - 1] == '\n')
 			line[line_len - 1] = '\0';
 		hwmon_pmu__new(pmus, hwmon_dir, class_hwmon_ent->d_name, line);
 		close(name_fd);
-- 
2.51.0

