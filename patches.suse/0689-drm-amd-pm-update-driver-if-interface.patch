From 886b4a4252bf1bbd83355786ecc68ca2c761ecde Mon Sep 17 00:00:00 2001
From: Kenneth Feng <kenneth.feng@amd.com>
Date: Wed, 24 Apr 2024 11:41:02 +0800
Subject: drm/amd/pm: update driver-if interface
Git-commit: 67a4888dc38c1d90d22b051cdb68c9144a6bc317
Patch-mainline: v6.11-rc1
References: jsc#PED-9898 jsc#PED-10191 jsc#PED-10197 jsc#PED-10226 jsc#PED-10237 jsc#PED-10340 jsc#PED-10852 jsc#PED-11022

update driver-if interface for smu 14.0.2/3

Signed-off-by: Kenneth Feng <kenneth.feng@amd.com>
Reviewed-by: Yang Wang <kevinyang.wang@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Acked-by: Patrik Jakobsson <pjakobsson@suse.de>
---
 .../swsmu/inc/pmfw_if/smu14_driver_if_v14_0.h | 21 +++++++++++++++++--
 drivers/gpu/drm/amd/pm/swsmu/inc/smu_v14_0.h  |  2 +-
 2 files changed, 20 insertions(+), 3 deletions(-)

diff --git a/drivers/gpu/drm/amd/pm/swsmu/inc/pmfw_if/smu14_driver_if_v14_0.h b/drivers/gpu/drm/amd/pm/swsmu/inc/pmfw_if/smu14_driver_if_v14_0.h
index 97a29b80fb13..ee457a6f0813 100644
--- a/drivers/gpu/drm/amd/pm/swsmu/inc/pmfw_if/smu14_driver_if_v14_0.h
+++ b/drivers/gpu/drm/amd/pm/swsmu/inc/pmfw_if/smu14_driver_if_v14_0.h
@@ -1641,6 +1641,23 @@ typedef struct {
   uint16_t dGPU_W_MAX             ;
   uint16_t padding                ;
 
+  uint16_t MovingAverageGfxclkFrequencyTarget;
+  uint16_t MovingAverageGfxclkFrequencyPreDs;
+  uint16_t MovingAverageGfxclkFrequencyPostDs;
+  uint16_t MovingAverageFclkFrequencyPreDs;
+  uint16_t MovingAverageFclkFrequencyPostDs;
+  uint16_t MovingAverageMemclkFrequencyPreDs;
+  uint16_t MovingAverageMemclkFrequencyPostDs;
+  uint16_t MovingAverageVclk0Frequency;
+  uint16_t MovingAverageDclk0Frequency;
+  uint16_t MovingAverageGfxActivity;
+  uint16_t MovingAverageUclkActivity;
+  uint16_t MovingAverageVcn0ActivityPercentage;
+  uint16_t MovingAveragePCIeBusy;
+  uint16_t MovingAverageUclkActivity_MAX;
+  uint16_t MovingAverageSocketPower;
+  uint16_t MovingAveragePadding;
+
   uint32_t MetricsCounter         ;
 
   uint16_t AvgVoltage[SVI_PLANE_COUNT];
@@ -1653,7 +1670,7 @@ typedef struct {
 
   uint32_t EnergyAccumulator;
   uint16_t AverageSocketPower;
-  uint16_t AverageTotalBoardPower;
+  uint16_t MovingAverageTotalBoardPower;
 
   uint16_t AvgTemperature[TEMP_COUNT];
   uint16_t AvgTemperatureFanIntake;
@@ -1676,7 +1693,7 @@ typedef struct {
 
   uint16_t ApuSTAPMSmartShiftLimit;
   uint16_t ApuSTAPMLimit;
-  uint16_t AvgApuSocketPower;
+  uint16_t MovingAvgApuSocketPower;
 
   uint16_t AverageUclkActivity_MAX;
 
diff --git a/drivers/gpu/drm/amd/pm/swsmu/inc/smu_v14_0.h b/drivers/gpu/drm/amd/pm/swsmu/inc/smu_v14_0.h
index 3d34b3869df6..e6531c30c3eb 100644
--- a/drivers/gpu/drm/amd/pm/swsmu/inc/smu_v14_0.h
+++ b/drivers/gpu/drm/amd/pm/swsmu/inc/smu_v14_0.h
@@ -28,7 +28,7 @@
 #define SMU14_DRIVER_IF_VERSION_INV 0xFFFFFFFF
 #define SMU14_DRIVER_IF_VERSION_SMU_V14_0_0 0x7
 #define SMU14_DRIVER_IF_VERSION_SMU_V14_0_1 0x6
-#define SMU14_DRIVER_IF_VERSION_SMU_V14_0_2 0x25
+#define SMU14_DRIVER_IF_VERSION_SMU_V14_0_2 0x26
 
 #define FEATURE_MASK(feature) (1ULL << feature)
 
-- 
2.46.1

