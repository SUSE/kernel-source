From: Zhang Rui <rui.zhang@intel.com>
Subject: powercap: intel_rapl_tpmi: Enable PMU support
References: jsc#PED-10410
Patch-Mainline: v6.10-rc1
Git-commit: 963a9ad3c589dc0f922697faea53c69098083945

Enable RAPL PMU support for TPMI RAPL driver.

Signed-off-by: Zhang Rui <rui.zhang@intel.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>


Signed-off-by:  <trenn@suse.com>
---
 drivers/powercap/intel_rapl_tpmi.c |    3 +++
 1 file changed, 3 insertions(+)

--- a/drivers/powercap/intel_rapl_tpmi.c
+++ b/drivers/powercap/intel_rapl_tpmi.c
@@ -288,6 +288,8 @@ static int intel_rapl_tpmi_probe(struct
 		goto err;
 	}
 
+	rapl_package_add_pmu(trp->rp);
+
 	auxiliary_set_drvdata(auxdev, trp);
 
 	return 0;
@@ -300,6 +302,7 @@ static void intel_rapl_tpmi_remove(struc
 {
 	struct tpmi_rapl_package *trp = auxiliary_get_drvdata(auxdev);
 
+	rapl_package_remove_pmu(trp->rp);
 	rapl_remove_package(trp->rp);
 	trp_release(trp);
 }
