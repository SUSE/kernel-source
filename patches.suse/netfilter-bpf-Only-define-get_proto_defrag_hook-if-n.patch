From: Daniel Xu <dxu@dxuuu.xyz>
Date: Mon, 31 Jul 2023 15:55:00 -0600
Subject: netfilter: bpf: Only define get_proto_defrag_hook() if necessary
Patch-mainline: v6.6-rc1
Git-commit: 81584c23f249ac2d809e2f89b76a7a9a02c09d8a
References: jsc#PED-6811

Before, we were getting this warning:

  net/netfilter/nf_bpf_link.c:32:1: warning: 'get_proto_defrag_hook' defined but not used [-Wunused-function]

Guard the definition with CONFIG_NF_DEFRAG_IPV[4|6].

Fixes: 91721c2d02d3 ("netfilter: bpf: Support BPF_F_NETFILTER_IP_DEFRAG in netfilter link")
Reported-by: kernel test robot <lkp@intel.com>
Closes: https://lore.kernel.org/oe-kbuild-all/202307291213.fZ0zDmoG-lkp@intel.com/
Signed-off-by: Daniel Xu <dxu@dxuuu.xyz>
Link: https://lore.kernel.org/r/b128b6489f0066db32c4772ae4aaee1480495929.1690840454.git.dxu@dxuuu.xyz
Signed-off-by: Alexei Starovoitov <ast@kernel.org>
Acked-by: Shung-Hsi Yu <shung-hsi.yu@suse.com>
---
 net/netfilter/nf_bpf_link.c |    2 ++
 1 file changed, 2 insertions(+)

--- a/net/netfilter/nf_bpf_link.c
+++ b/net/netfilter/nf_bpf_link.c
@@ -28,6 +28,7 @@ struct bpf_nf_link {
 	const struct nf_defrag_hook *defrag_hook;
 };
 
+#if IS_ENABLED(CONFIG_NF_DEFRAG_IPV4) || IS_ENABLED(CONFIG_NF_DEFRAG_IPV6)
 static const struct nf_defrag_hook *
 get_proto_defrag_hook(struct bpf_nf_link *link,
 		      const struct nf_defrag_hook __rcu *global_hook,
@@ -68,6 +69,7 @@ get_proto_defrag_hook(struct bpf_nf_link
 
 	return hook;
 }
+#endif
 
 static int bpf_nf_enable_defrag(struct bpf_nf_link *link)
 {
