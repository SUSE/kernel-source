From: Jonathan Corbet <corbet@lwn.net>
Date: Mon, 18 Dec 2023 17:18:08 -0700
Subject: docs: ignore __counted_by attribute in structure definitions
Patch-mainline: v6.8-rc1
Git-commit: f600c77aeaff6e59806d7eef9ac269a7c1a6d817
References: jsc#PED-11153

kernel-doc appeared to ignore __counted_by, but appearances can be
deceiving; it caused member names to not be recognized, which manifested as
a number of spurious "Excess struct member" warnings.  Filter that
attribute out and reduce the warning onslaught slightly.

Signed-off-by: Jonathan Corbet <corbet@lwn.net>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 scripts/kernel-doc |    1 +
 1 file changed, 1 insertion(+)

--- a/scripts/kernel-doc
+++ b/scripts/kernel-doc
@@ -1125,6 +1125,7 @@ sub dump_struct($$) {
 	# strip attributes
 	$members =~ s/\s*$attribute/ /gi;
 	$members =~ s/\s*__aligned\s*\([^;]*\)/ /gos;
+	$members =~ s/\s*__counted_by\s*\([^;]*\)/ /gos;
 	$members =~ s/\s*__packed\s*/ /gos;
 	$members =~ s/\s*CRYPTO_MINALIGN_ATTR/ /gos;
 	$members =~ s/\s*____cacheline_aligned_in_smp/ /gos;
