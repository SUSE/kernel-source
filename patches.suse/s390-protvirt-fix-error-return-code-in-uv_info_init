From: zhongbaisong <zhongbaisong@huawei.com>
Date: Wed, 7 Apr 2021 20:38:55 +0800
Subject: s390/protvirt: fix error return code in uv_info_init()
Git-commit: 644975179c00802936c5afc732d9df7f63f735a0
Patch-mainline: v5.13-rc1
References: jsc#SLE-22135

Fix to return a negative error code from the error handling
case instead of 0, as done elsewhere in this function.

Reported-by: Hulk Robot <hulkci@huawei.com>
Signed-off-by: Baisong Zhong <zhongbaisong@huawei.com>
Fixes: 37564ed834ac ("s390/uv: add prot virt guest/host indication files")
Link: https://lore.kernel.org/r/2f7d62a4-3e75-b2b4-951b-75ef8ef59d16@huawei.com
Signed-off-by: Heiko Carstens <hca@linux.ibm.com>
Acked-by: Petr Tesarik <ptesarik@suse.com>
---
 arch/s390/kernel/uv.c |    4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

--- a/arch/s390/kernel/uv.c
+++ b/arch/s390/kernel/uv.c
@@ -437,8 +437,10 @@ static int __init uv_info_init(void)
 		goto out_kobj;
 
 	uv_query_kset = kset_create_and_add("query", NULL, uv_kobj);
-	if (!uv_query_kset)
+	if (!uv_query_kset) {
+		rc = -ENOMEM;
 		goto out_ind_files;
+	}
 
 	rc = sysfs_create_group(&uv_query_kset->kobj, &uv_query_attr_group);
 	if (!rc)
