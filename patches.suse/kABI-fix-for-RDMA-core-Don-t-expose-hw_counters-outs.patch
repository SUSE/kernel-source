From: Nicolas Morey <nmorey@suse.com>
Date: Tue, 1 Apr 2025 14:46:50 +0200
Subject: [PATCH 1/1] kABI fix for RDMA/core: Don't expose hw_counters outside
 of init net namespace
Patch-mainline: Never, kABI workaround
References: git-fixes bsc#1239925

Acked-by: Nicolas Morey <nmorey@suse.com>
---
 include/rdma/ib_verbs.h | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/include/rdma/ib_verbs.h b/include/rdma/ib_verbs.h
index 631b23a86540..5008796556c2 100644
--- a/include/rdma/ib_verbs.h
+++ b/include/rdma/ib_verbs.h
@@ -2740,7 +2740,6 @@ struct ib_device {
 	 * It is a NULL terminated array.
 	 */
 	const struct attribute_group	*groups[4];
-	u8				hw_stats_attr_index;
 
 	u64			     uverbs_cmd_mask;
 
@@ -2753,6 +2752,10 @@ struct ib_device {
 	/* CQ adaptive moderation (RDMA DIM) */
 	u16                          use_cq_dim:1;
 	u8                           node_type;
+#ifndef __GENKSYMS__
+	u8			     hw_stats_attr_index;
+#endif
+
 	u32			     phys_port_cnt;
 	struct ib_device_attr        attrs;
 	struct hw_stats_device_data *hw_stats_data;
-- 
2.48.1.1.g25877ef7d4f1

