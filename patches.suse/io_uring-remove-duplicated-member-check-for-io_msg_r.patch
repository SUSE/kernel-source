From f3b6a41eb2bbdf545a42e54d637c34f4b1fdf5b9 Mon Sep 17 00:00:00 2001
From: Jens Axboe <axboe@kernel.dk>
Date: Sat, 12 Mar 2022 06:50:13 -0700
Subject: [PATCH] io_uring: remove duplicated member check for
 io_msg_ring_prep()
Git-commit: f3b6a41eb2bbdf545a42e54d637c34f4b1fdf5b9
Patch-mainline: v5.18-rc1
References: bsc#1205205

Julia and the kernel test robot report that the prep handling for this
command inadvertently checks one field twice:

fs/io_uring.c:4338:42-56: duplicated argument to && or ||

Get rid of it.

Reported-by: kernel test robot <lkp@intel.com>
Reported-by: Julia Lawall <julia.lawall@lip6.fr>
Fixes: 4f57f06ce218 ("io_uring: add support for IORING_OP_MSG_RING command")
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Signed-off-by: Gabriel Krisman Bertazi <krisman@suse.de>
---
 fs/io_uring.c | 5 ++---
 1 file changed, 2 insertions(+), 3 deletions(-)

diff --git a/fs/io_uring.c b/fs/io_uring.c
index 229b31d644ef..299154efcd8a 100644
--- a/fs/io_uring.c
+++ b/fs/io_uring.c
@@ -4389,9 +4389,8 @@ static int io_nop(struct io_kiocb *req, unsigned int issue_flags)
 static int io_msg_ring_prep(struct io_kiocb *req,
 			    const struct io_uring_sqe *sqe)
 {
-	if (unlikely(sqe->addr || sqe->ioprio || sqe->buf_index ||
-		     sqe->rw_flags || sqe->splice_fd_in || sqe->buf_index ||
-		     sqe->personality))
+	if (unlikely(sqe->addr || sqe->ioprio || sqe->rw_flags ||
+		     sqe->splice_fd_in || sqe->buf_index || sqe->personality))
 		return -EINVAL;
 
 	if (req->file->f_op != &io_uring_fops)
-- 
2.35.3

