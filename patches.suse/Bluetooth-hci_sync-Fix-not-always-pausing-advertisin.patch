From: Luiz Augusto von Dentz <luiz.von.dentz@intel.com>
Date: Wed, 8 Dec 2021 15:43:24 -0800
Subject: Bluetooth: hci_sync: Fix not always pausing advertising when
 necessary
Patch-mainline: v5.17-rc1
Git-commit: 9446bdde51ac9cc8023c732ec0cc05e820ae8d20
References: jsc#PED-1407

hci_pause_advertising_sync shall always pause advertising until
hci_resume_advertising_sync but instance 0x00 doesn't count
in adv_instance_cnt so it was causing it to be skipped.

Signed-off-by: Luiz Augusto von Dentz <luiz.von.dentz@intel.com>
Signed-off-by: Marcel Holtmann <marcel@holtmann.org>
Acked-by: Lee, Chun-Yi <jlee@suse.com>
---
 net/bluetooth/hci_sync.c |    6 ++----
 1 file changed, 2 insertions(+), 4 deletions(-)

--- a/net/bluetooth/hci_sync.c
+++ b/net/bluetooth/hci_sync.c
@@ -1701,10 +1701,8 @@ static int hci_pause_advertising_sync(st
 	int err;
 	int old_state;
 
-	/* If there are no instances or advertising has already been paused
-	 * there is nothing to do.
-	 */
-	if (!hdev->adv_instance_cnt || hdev->advertising_paused)
+	/* If already been paused there is nothing to do. */
+	if (hdev->advertising_paused)
 		return 0;
 
 	bt_dev_dbg(hdev, "Pausing directed advertising");
