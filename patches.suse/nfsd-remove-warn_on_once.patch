From: NeilBrown <neilb@suse.com>
Subject: [NFSD] remove unnecessary WARN_ON_ONCE()
Patch-mainline: never, solved differently
References: bsc#1214823

This WARN_ON_ONCE() disppeared upstream in
Commit 8d0d254b15cc ("nfsd: fix nfsd_file_unhash_and_dispose")
with no useful explanation.
I believe the cause is a race of little consequence.  It can
be ignored.

Signed-off-by: NeilBrown <neilb@suse.de>
Acked-by: NeilBrown <neilb@suse.com>

---
 fs/nfsd/filecache.c |    7 ++-----
 1 file changed, 2 insertions(+), 5 deletions(-)

--- a/fs/nfsd/filecache.c
+++ b/fs/nfsd/filecache.c
@@ -744,12 +744,9 @@ nfsd_file_cache_purge(struct net *net)
 			if (net && nf->nf_net != net)
 				continue;
 			del = nfsd_file_unhash_and_release_locked(nf, &dispose);
-
-			/*
-			 * Deadlock detected! Something marked this entry as
-			 * unhased, but hasn't removed it from the hash list.
+			/* If !del, nfsd_file_lru_cb() is working on this
+			 * and will free it soon - just ignore.
 			 */
-			WARN_ON_ONCE(!del);
 		}
 		spin_unlock(&nfb->nfb_lock);
 		nfsd_file_dispose_list(&dispose);
