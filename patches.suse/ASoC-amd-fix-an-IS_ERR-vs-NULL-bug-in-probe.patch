From 37108ef45ae9021d23174ce89e76ad41443090bf Mon Sep 17 00:00:00 2001
From: Dan Carpenter <dan.carpenter@oracle.com>
Date: Tue, 27 Jul 2021 11:17:56 +0300
Subject: [PATCH] ASoC: amd: fix an IS_ERR() vs NULL bug in probe
Git-commit: 37108ef45ae9021d23174ce89e76ad41443090bf
Patch-mainline: v5.15-rc1
References: bsc#1192354

The devm_ioremap() function returns NULL on error, it doesn't return
error pointers.

Fixes: e550339ee652 ("ASoC: amd: add vangogh i2s controller driver")
Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
Link: https://lore.kernel.org/r/20210727081756.GA19121@kili
Signed-off-by: Mark Brown <broonie@kernel.org>
Acked-by: Takashi Iwai <tiwai@suse.de>

---
 sound/soc/amd/vangogh/acp5x-i2s.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/sound/soc/amd/vangogh/acp5x-i2s.c b/sound/soc/amd/vangogh/acp5x-i2s.c
index 86b37c93c3d2..2705e57eb713 100644
--- a/sound/soc/amd/vangogh/acp5x-i2s.c
+++ b/sound/soc/amd/vangogh/acp5x-i2s.c
@@ -399,8 +399,8 @@ static int acp5x_dai_probe(struct platform_device *pdev)
 	}
 	adata->acp5x_base = devm_ioremap(&pdev->dev, res->start,
 					 resource_size(res));
-	if (IS_ERR(adata->acp5x_base))
-		return PTR_ERR(adata->acp5x_base);
+	if (!adata->acp5x_base)
+		return -ENOMEM;
 
 	adata->master_mode = I2S_MASTER_MODE_ENABLE;
 	dev_set_drvdata(&pdev->dev, adata);
-- 
2.26.2

