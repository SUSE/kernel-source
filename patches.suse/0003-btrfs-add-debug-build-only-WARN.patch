From 3db15c6ca6feb2c5000a1cbb39c33866e0349abd Mon Sep 17 00:00:00 2001
Git-commit: 3db15c6ca6feb2c5000a1cbb39c33866e0349abd
References: bsc#1249038
Patch-mainline: v6.16-rc1
From: David Sterba <dsterba@suse.com>
Date: Thu, 17 Apr 2025 11:17:01 +0200
Subject: [PATCH 3/5] btrfs: add debug build only WARN

Add conditional WARN() wrapper that's enabled only in debug build. It
should be used for unexpected conditions that should be noisy.  Use it
instead of ASSERT(0). As it will not lead to BUG() make sure that
continuing is still possible, e.g. the error is handled anyway.

Reviewed-by: Josef Bacik <josef@toxicpanda.com>
Signed-off-by: David Sterba <dsterba@suse.com>
---
 fs/btrfs/messages.h | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/fs/btrfs/messages.h b/fs/btrfs/messages.h
index d4e85485d824..6abf81bb00c2 100644
--- a/fs/btrfs/messages.h
+++ b/fs/btrfs/messages.h
@@ -243,6 +243,13 @@ do {										\
 #define ASSERT(cond, args...)			(void)(cond)
 #endif
 
+#ifdef CONFIG_BTRFS_DEBUG
+/* Verbose warning only under debug build. */
+#define DEBUG_WARN(args...)			WARN(1, KERN_ERR args)
+#else
+#define DEBUG_WARN(...)				do {} while(0)
+#endif
+
 __printf(5, 6)
 __cold
 void __btrfs_handle_fs_error(struct btrfs_fs_info *fs_info, const char *function,
-- 
2.50.1

