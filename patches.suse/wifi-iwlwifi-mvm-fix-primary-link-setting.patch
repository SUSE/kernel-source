From 4e8a56aab3fb8cdf7843bc24d67ca25440085f1a Mon Sep 17 00:00:00 2001
From: Miri Korenblit <miriam.rachel.korenblit@intel.com>
Date: Mon, 6 May 2024 10:04:06 +0300
Subject: [PATCH] wifi: iwlwifi: mvm: fix primary link setting
Git-commit: 4e8a56aab3fb8cdf7843bc24d67ca25440085f1a
Patch-mainline: v6.10-rc1
References: jsc#PED-10412

mvmvif::primary link holds the ID and not a bitmap. Fix this

Fixes: 07bf5297d392 ("wifi: iwlwifi: mvm: Implement new link selection algorithm")
Signed-off-by: Miri Korenblit <miriam.rachel.korenblit@intel.com>
Reviewed-by: Johannes Berg <johannes.berg@intel.com>
Link: https://msgid.link/20240506095953.779bf6949053.Ia9297991ff2fdc82ae7c730e0069e2dd6e5f2902@changeid
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Acked-by: Takashi Iwai <tiwai@suse.de>

---
 drivers/net/wireless/intel/iwlwifi/mvm/mld-mac80211.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/net/wireless/intel/iwlwifi/mvm/mld-mac80211.c b/drivers/net/wireless/intel/iwlwifi/mvm/mld-mac80211.c
index bceafd551e8f..0a3b7284eedd 100644
--- a/drivers/net/wireless/intel/iwlwifi/mvm/mld-mac80211.c
+++ b/drivers/net/wireless/intel/iwlwifi/mvm/mld-mac80211.c
@@ -1212,7 +1212,7 @@ iwl_mvm_mld_change_vif_links(struct ieee80211_hw *hw,
 		 * Ensure we always have a valid primary_link, the real
 		 * decision happens later when PHY is activated.
 		 */
-		mvmvif->primary_link = BIT(__ffs(new_links));
+		mvmvif->primary_link = __ffs(new_links);
 	}
 
 out_err:
-- 
2.43.0

