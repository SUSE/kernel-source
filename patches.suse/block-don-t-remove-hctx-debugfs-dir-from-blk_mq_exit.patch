From: Ming Lei <ming.lei@redhat.com>
Date: Tue, 8 Mar 2022 06:51:56 +0100
Subject: [PATCH] block: don't remove hctx debugfs dir from blk_mq_exit_queue
Git-commit: de3d347f7b8a1a997fbc9267454ed6065068b969
Patch-mainline: v5.18-rc1
References: jsc#PED-1183

The queue's top debugfs dir is removed from blk_release_queue(), so all
hctx's debugfs dirs are removed from there. Given blk_mq_exit_queue()
is only called from blk_cleanup_queue(), it isn't necessary to remove
hctx debugfs from blk_mq_exit_queue().

So remove it from blk_mq_exit_queue().

Signed-off-by: Ming Lei <ming.lei@redhat.com>
Signed-off-by: Christoph Hellwig <hch@lst.de>
Link: https://lore.kernel.org/r/20220308055200.735835-11-hch@lst.de
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Acked-by: Hannes Reinecke <hare@suse.com>
---
 block/blk-mq.c | 1 -
 1 file changed, 1 deletion(-)

diff --git a/block/blk-mq.c b/block/blk-mq.c
index f7ef8e2ab935..862d91c6112e 100644
--- a/block/blk-mq.c
+++ b/block/blk-mq.c
@@ -3462,7 +3462,6 @@ static void blk_mq_exit_hw_queues(struct request_queue *q,
 	queue_for_each_hw_ctx(q, hctx, i) {
 		if (i == nr_queue)
 			break;
-		blk_mq_debugfs_unregister_hctx(hctx);
 		blk_mq_exit_hctx(q, set, hctx, i);
 	}
 }
-- 
2.35.3

