From: Ivan Hu <ivan.hu@canonical.com>
Date: Mon, 31 Mar 2025 15:45:04 +0800
Subject: efi/efi_test: Fix missing pending status update in getwakeuptime
Patch-mainline: v6.16-rc1
Git-commit: 3dcb524d785373fd43b129f01f32bd394fe167e0
References: jsc#PED-14259

The pending status was not being passed to user space, leading to
false test alarms when using the pending status. This patch ensures
that the pending status is correctly updated and exposed to user space
when calling getwakeuptime, preventing incorrect handling of the pending
status.

Signed-off-by: Ivan Hu <ivan.hu@canonical.com>
Signed-off-by: Ard Biesheuvel <ardb@kernel.org>
Acked-by: Chun-Yi Lee <jlee@suse.com>
---
 drivers/firmware/efi/test/efi_test.c |    4 ++++
 1 file changed, 4 insertions(+)

--- a/drivers/firmware/efi/test/efi_test.c
+++ b/drivers/firmware/efi/test/efi_test.c
@@ -361,6 +361,10 @@ static long efi_runtime_get_waketime(uns
 						getwakeuptime.enabled))
 		return -EFAULT;
 
+	if (getwakeuptime.pending && put_user(pending,
+						getwakeuptime.pending))
+		return -EFAULT;
+
 	if (getwakeuptime.time) {
 		if (copy_to_user(getwakeuptime.time, &efi_time,
 				sizeof(efi_time_t)))
