From ab2335daa6ef70df56c98c216261a93e28ae52b3 Mon Sep 17 00:00:00 2001
From: Takashi Iwai <tiwai@suse.de>
Date: Thu, 25 May 2023 10:31:23 +0200
Subject: [PATCH] ALSA: ump: Drop redundant check of note-on with zero velocity
Git-commit: ab2335daa6ef70df56c98c216261a93e28ae52b3
Patch-mainline: v6.5-rc1
References: jsc#PED-6045 jsc#PED-6036 jsc#PED-6104 jsc#PED-6114 jsc#PED-6067 jsc#PED-6123

The check of a note-on event with zero velocity is done twice, and the
latter one is superfluous.  Let's drop it.

Fixes: 0b5288f5fe63 ("ALSA: ump: Add legacy raw MIDI support")
Reported-by: Dan Carpenter <dan.carpenter@linaro.org>
Closes: https://lore.kernel.org/r/4683198a-84f6-4238-9e87-c70667d84523@kili.mountain
Suggested-by: Dan Carpenter <dan.carpenter@linaro.org>
Link: https://lore.kernel.org/r/20230525083124.15277-1-tiwai@suse.de
Signed-off-by: Takashi Iwai <tiwai@suse.de>

---
 sound/core/ump_convert.c | 3 ---
 1 file changed, 3 deletions(-)

diff --git a/sound/core/ump_convert.c b/sound/core/ump_convert.c
index cb7c2f959a27..164829d3e305 100644
--- a/sound/core/ump_convert.c
+++ b/sound/core/ump_convert.c
@@ -340,9 +340,6 @@ static int cvt_legacy_cmd_to_ump(struct snd_ump_endpoint *ump,
 
 	switch (status) {
 	case UMP_MSG_STATUS_NOTE_ON:
-		if (!buf[2])
-			status = UMP_MSG_STATUS_NOTE_OFF;
-		fallthrough;
 	case UMP_MSG_STATUS_NOTE_OFF:
 		midi2->note.note = buf[1];
 		midi2->note.velocity = upscale_7_to_16bit(buf[2]);
-- 
2.35.3

