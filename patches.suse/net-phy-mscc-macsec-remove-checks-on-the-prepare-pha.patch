From: Antoine Tenart <atenart@kernel.org>
Date: Wed, 21 Sep 2022 15:51:15 +0200
Subject: net: phy: mscc: macsec: remove checks on the prepare phase
Patch-mainline: v6.1-rc1
Git-commit: 6b701f4101e0d7db1084147e1413aaf26811cda5
References: jsc#PED-1549

Remove checks on the prepare phase as it is now unused by the MACsec
core implementation.

Signed-off-by: Antoine Tenart <atenart@kernel.org>
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 drivers/net/phy/mscc/mscc_macsec.c |   41 -------------------------------------
 1 file changed, 41 deletions(-)

--- a/drivers/net/phy/mscc/mscc_macsec.c
+++ b/drivers/net/phy/mscc/mscc_macsec.c
@@ -736,10 +736,6 @@ static int vsc8584_macsec_dev_open(struc
 	struct vsc8531_private *priv = ctx->phydev->priv;
 	struct macsec_flow *flow, *tmp;
 
-	/* No operation to perform before the commit step */
-	if (ctx->prepare)
-		return 0;
-
 	list_for_each_entry_safe(flow, tmp, &priv->macsec_flows, list)
 		vsc8584_macsec_flow_enable(ctx->phydev, flow);
 
@@ -751,10 +747,6 @@ static int vsc8584_macsec_dev_stop(struc
 	struct vsc8531_private *priv = ctx->phydev->priv;
 	struct macsec_flow *flow, *tmp;
 
-	/* No operation to perform before the commit step */
-	if (ctx->prepare)
-		return 0;
-
 	list_for_each_entry_safe(flow, tmp, &priv->macsec_flows, list)
 		vsc8584_macsec_flow_disable(ctx->phydev, flow);
 
@@ -766,9 +758,6 @@ static int vsc8584_macsec_add_secy(struc
 	struct vsc8531_private *priv = ctx->phydev->priv;
 	struct macsec_secy *secy = ctx->secy;
 
-	if (ctx->prepare)
-		return 0;
-
 	if (priv->secy)
 		return -EEXIST;
 
@@ -787,10 +776,6 @@ static int vsc8584_macsec_del_secy(struc
 	struct vsc8531_private *priv = ctx->phydev->priv;
 	struct macsec_flow *flow, *tmp;
 
-	/* No operation to perform before the commit step */
-	if (ctx->prepare)
-		return 0;
-
 	list_for_each_entry_safe(flow, tmp, &priv->macsec_flows, list)
 		vsc8584_macsec_del_flow(ctx->phydev, flow);
 
@@ -803,10 +788,6 @@ static int vsc8584_macsec_del_secy(struc
 
 static int vsc8584_macsec_upd_secy(struct macsec_context *ctx)
 {
-	/* No operation to perform before the commit step */
-	if (ctx->prepare)
-		return 0;
-
 	vsc8584_macsec_del_secy(ctx);
 	return vsc8584_macsec_add_secy(ctx);
 }
@@ -827,10 +808,6 @@ static int vsc8584_macsec_del_rxsc(struc
 	struct vsc8531_private *priv = ctx->phydev->priv;
 	struct macsec_flow *flow, *tmp;
 
-	/* No operation to perform before the commit step */
-	if (ctx->prepare)
-		return 0;
-
 	list_for_each_entry_safe(flow, tmp, &priv->macsec_flows, list) {
 		if (flow->bank == MACSEC_INGR && flow->rx_sa &&
 		    flow->rx_sa->sc->sci == ctx->rx_sc->sci)
@@ -847,9 +824,6 @@ static int vsc8584_macsec_add_rxsa(struc
 	struct macsec_flow *flow;
 	int ret;
 
-	if (ctx->prepare)
-		return 0;
-
 	flow = vsc8584_macsec_alloc_flow(priv, MACSEC_INGR);
 	if (IS_ERR(flow))
 		return PTR_ERR(flow);
@@ -869,9 +843,6 @@ static int vsc8584_macsec_upd_rxsa(struc
 	struct macsec_flow *flow;
 	int ret;
 
-	if (ctx->prepare)
-		return 0;
-
 	flow = vsc8584_macsec_find_flow(ctx, MACSEC_INGR);
 	if (IS_ERR(flow))
 		return PTR_ERR(flow);
@@ -891,9 +862,6 @@ static int vsc8584_macsec_del_rxsa(struc
 {
 	struct macsec_flow *flow;
 
-	if (ctx->prepare)
-		return 0;
-
 	flow = vsc8584_macsec_find_flow(ctx, MACSEC_INGR);
 	if (IS_ERR(flow))
 		return PTR_ERR(flow);
@@ -909,9 +877,6 @@ static int vsc8584_macsec_add_txsa(struc
 	struct macsec_flow *flow;
 	int ret;
 
-	if (ctx->prepare)
-		return 0;
-
 	flow = vsc8584_macsec_alloc_flow(priv, MACSEC_EGR);
 	if (IS_ERR(flow))
 		return PTR_ERR(flow);
@@ -931,9 +896,6 @@ static int vsc8584_macsec_upd_txsa(struc
 	struct macsec_flow *flow;
 	int ret;
 
-	if (ctx->prepare)
-		return 0;
-
 	flow = vsc8584_macsec_find_flow(ctx, MACSEC_EGR);
 	if (IS_ERR(flow))
 		return PTR_ERR(flow);
@@ -953,9 +915,6 @@ static int vsc8584_macsec_del_txsa(struc
 {
 	struct macsec_flow *flow;
 
-	if (ctx->prepare)
-		return 0;
-
 	flow = vsc8584_macsec_find_flow(ctx, MACSEC_EGR);
 	if (IS_ERR(flow))
 		return PTR_ERR(flow);
