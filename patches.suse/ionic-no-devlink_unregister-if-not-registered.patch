From: Shannon Nelson <snelson@pensando.io>
Date: Tue, 12 Oct 2021 16:15:20 -0700
Subject: ionic: no devlink_unregister if not registered
Patch-mainline: v5.16-rc1
Git-commit: d1f24712a86abd04d82cf4b00fb4ab8ff2d23c8a
References: jsc#SLE-19282

Don't try to unregister the devlink if it hasn't been registered
yet.  This bit of error cleanup code got missed in the recent
devlink registration changes.

Fixes: 7911c8bd546f ("ionic: Move devlink registration to be last devlink command")
Signed-off-by: Shannon Nelson <snelson@pensando.io>
Reviewed-by: Leon Romanovsky <leonro@nvidia.com>
Link: https://lore.kernel.org/r/20211012231520.72582-1-snelson@pensando.io
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 drivers/net/ethernet/pensando/ionic/ionic_devlink.c |    1 -
 1 file changed, 1 deletion(-)

--- a/drivers/net/ethernet/pensando/ionic/ionic_devlink.c
+++ b/drivers/net/ethernet/pensando/ionic/ionic_devlink.c
@@ -87,7 +87,6 @@ int ionic_devlink_register(struct ionic
 	err = devlink_port_register(dl, &ionic->dl_port, 0);
 	if (err) {
 		dev_err(ionic->dev, "devlink_port_register failed: %d\n", err);
-		devlink_unregister(dl);
 		return err;
 	}
 
