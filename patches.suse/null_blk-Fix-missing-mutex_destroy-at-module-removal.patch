From: Zhu Yanjun <yanjun.zhu@linux.dev>
Date: Thu, 25 Apr 2024 19:16:35 +0200
Subject: null_blk: Fix missing mutex_destroy() at module removal
Git-commit: 07d1b99825f40f9c0d93e6b99d79a08d0717bac1
Patch-mainline: v6.10-rc1
References: git-fixes

When a mutex lock is not used any more, the function mutex_destroy
should be called to mark the mutex lock uninitialized.

[lduncan: applied with fuzz=2]

Fixes: f2298c0403b0 ("null_blk: multi queue aware block test driver")
Signed-off-by: Zhu Yanjun <yanjun.zhu@linux.dev>
Link: https://lore.kernel.org/r/20240425171635.4227-1-yanjun.zhu@linux.dev
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Acked-by: Lee Duncan <lduncan@suse.com>
---
 drivers/block/null_blk/main.c |    2 ++
 1 file changed, 2 insertions(+)

--- a/drivers/block/null_blk/main.c
+++ b/drivers/block/null_blk/main.c
@@ -2373,6 +2373,8 @@ static void __exit null_exit(void)
 
 	if (g_queue_mode == NULL_Q_MQ && shared_tags)
 		blk_mq_free_tag_set(&tag_set);
+
+	mutex_destroy(&lock);
 }
 
 module_init(null_init);
