From: Shung-Hsi Yu <shung-hsi.yu@suse.com>
Date: Tue, 01 Fed 2022 08:43:36 +0800
Subject: [PATCH] kABI padding for bpf
Patch-mainline: Never, kABI padding
References: bsc#1179531

Add kABI padding to important BPF types

Signed-off-by: Shung-Hsi Yu <shung-hsi.yu@suse.com>
---
 include/linux/bpf.h          |    3 +++
 include/linux/bpf_verifier.h |    2 ++
 2 files changed, 5 insertions(+)

--- a/include/linux/bpf.h
+++ b/include/linux/bpf.h
@@ -306,6 +306,7 @@ struct bpf_map {
 	bool free_after_rcu_gp;
 	atomic64_t sleepable_refcnt;
 	s64 __percpu *elem_count;
+	void *suse_kabi_padding;
 };
 
 static inline const char *btf_field_type_name(enum btf_field_type type)
@@ -1565,6 +1566,7 @@ struct bpf_prog_aux {
 		struct work_struct work;
 		struct rcu_head	rcu;
 	};
+	void *suse_kabi_padding;
 };
 
 struct bpf_prog {
@@ -1595,6 +1597,7 @@ struct bpf_prog {
 					    const struct bpf_insn *insn);
 	struct bpf_prog_aux	*aux;		/* Auxiliary fields */
 	struct sock_fprog_kern	*orig_prog;	/* Original BPF program */
+	void			*suse_kabi_padding;
 	/* Instructions for interpreter */
 	union {
 		DECLARE_FLEX_ARRAY(struct sock_filter, insns);
--- a/include/linux/bpf_verifier.h
+++ b/include/linux/bpf_verifier.h
@@ -468,6 +468,7 @@ struct bpf_verifier_state {
 	u32 dfs_depth;
 	u32 callback_unroll_depth;
 	u32 may_goto_depth;
+	void *suse_kabi_padding;
 };
 
 #define bpf_get_spilled_reg(slot, frame, mask)				\
@@ -784,6 +785,7 @@ struct bpf_verifier_env {
 	char tmp_str_buf[TMP_STR_BUF_LEN];
 	struct bpf_insn insn_buf[INSN_BUF_SIZE];
 	struct bpf_insn epilogue_buf[INSN_BUF_SIZE];
+	void *suse_kabi_padding;
 };
 
 static inline struct bpf_func_info_aux *subprog_aux(struct bpf_verifier_env *env, int subprog)
