From: Yang Yingliang <yangyingliang@huawei.com>
Date: Mon, 11 Apr 2022 19:12:13 +0800
Subject: virt: sevguest: Fix return value check in alloc_shared_pages()
Git-commit: e50abbf788c239d529f9ab81e325f8e8f8432c9d
Patch-mainline: v5.19-rc1
References: jsc#SLE-19924, jsc#SLE-24814

If alloc_pages() fails, it returns a NULL pointer. Replace the wrong
IS_ERR() check with the proper NULL pointer check.

Fixes: fce96cf04430 ("virt: Add SEV-SNP guest driver")
Reported-by: Hulk Robot <hulkci@huawei.com>
Signed-off-by: Yang Yingliang <yangyingliang@huawei.com>
Signed-off-by: Borislav Petkov <bp@suse.de>
Reviewed-by: Brijesh Singh <brijesh.singh@amd.com>
Link: https://lore.kernel.org/r/20220411111213.1477853-1-yangyingliang@huawei.com

Acked-by: Joerg Roedel <jroedel@suse.de>
---
 drivers/virt/coco/sevguest/sevguest.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/drivers/virt/coco/sevguest/sevguest.c
+++ b/drivers/virt/coco/sevguest/sevguest.c
@@ -581,7 +581,7 @@ static void *alloc_shared_pages(size_t s
 	int ret;
 
 	page = alloc_pages(GFP_KERNEL_ACCOUNT, get_order(sz));
-	if (IS_ERR(page))
+	if (!page)
 		return NULL;
 
 	ret = set_memory_decrypted((unsigned long)page_address(page), npages);
