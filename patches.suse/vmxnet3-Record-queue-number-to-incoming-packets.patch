From: Andrey Turkin <andrey.turkin@gmail.com>
Date: Sun, 17 Jul 2022 02:20:50 +0000
Subject: vmxnet3: Record queue number to incoming packets
Patch-mainline: v6.0-rc1
Git-commit: bdeed8b0958cbe126fcc4a4945308907f44cc8a9
References: bsc#1200431

Make generic XDP processing attribute packets to their actual
queues instead of queue #0. This improves AF_XDP performance
considerably since softirq threads no longer fight over single
AF_XDP socket spinlock.

Signed-off-by: Andrey Turkin <andrey.turkin@gmail.com>
Link: https://lore.kernel.org/r/20220717022050.822766-2-andrey.turkin@gmail.com
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 drivers/net/vmxnet3/vmxnet3_drv.c |    1 +
 1 file changed, 1 insertion(+)

--- a/drivers/net/vmxnet3/vmxnet3_drv.c
+++ b/drivers/net/vmxnet3/vmxnet3_drv.c
@@ -1550,6 +1550,7 @@ vmxnet3_rq_rx_complete(struct vmxnet3_rx
 					     hash_type);
 			}
 #endif
+			skb_record_rx_queue(ctx->skb, rq->qid);
 			skb_put(ctx->skb, rcd->len);
 
 			if (VMXNET3_VERSION_GE_2(adapter) &&
