From: Soenke Huster <soenke.huster@eknoes.de>
Date: Sun, 23 Jan 2022 06:57:09 +0100
Subject: Bluetooth: msft: fix null pointer deref on msft_monitor_device_evt
Patch-mainline: v5.18-rc1
Git-commit: 5201d23cc8e57531e0b17e41c0ae10405ba6abd3
References: jsc#PED-1407

msft_find_handle_data returns NULL if it can't find the handle.
Therefore, handle_data must be checked, otherwise a null pointer
is dereferenced.

Signed-off-by: Soenke Huster <soenke.huster@eknoes.de>
Signed-off-by: Marcel Holtmann <marcel@holtmann.org>
Acked-by: Lee, Chun-Yi <jlee@suse.com>
---
 net/bluetooth/msft.c |    2 ++
 1 file changed, 2 insertions(+)

--- a/net/bluetooth/msft.c
+++ b/net/bluetooth/msft.c
@@ -704,6 +704,8 @@ static void msft_monitor_device_evt(stru
 		   ev->monitor_state, &ev->bdaddr);
 
 	handle_data = msft_find_handle_data(hdev, ev->monitor_handle, false);
+	if (!handle_data)
+		return;
 
 	switch (ev->addr_type) {
 	case ADDR_LE_DEV_PUBLIC:
