From: Nilesh Javali <njavali@marvell.com>
Date: Wed, 6 Sep 2023 15:39:21 +0530
Subject: qla2xxx: add debug log for unmaintained hw detected
Patch-mainline: never, downstream only
References: bsc#1216033, jsc#PED-6878, jsc#PED-6930

Few PCI IDs are unmaintained, ISP2532/ISP2031/ISP8031.
If the PCI IDs are identified in the system while driver load,
then warn the user about the details of unmaintained PCI ID.

Signed-off-by: Nilesh Javali <njavali@marvell.com>
Acked-by: Daniel Wagner <dwagner@suse.de>
---
 drivers/scsi/qla2xxx/qla_os.c | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/drivers/scsi/qla2xxx/qla_os.c b/drivers/scsi/qla2xxx/qla_os.c
index 93e83a2b265f..2ca39794ca81 100644
--- a/drivers/scsi/qla2xxx/qla_os.c
+++ b/drivers/scsi/qla2xxx/qla_os.c
@@ -2914,6 +2914,14 @@ qla2x00_probe_one(struct pci_dev *pdev, const struct pci_device_id *id)
 	struct rsp_que *rsp = NULL;
 	int i;
 
+	if (pdev->device == PCI_DEVICE_ID_QLOGIC_ISP2532 ||
+	    pdev->device == PCI_DEVICE_ID_QLOGIC_ISP2031 ||
+	    pdev->device == PCI_DEVICE_ID_QLOGIC_ISP8031) {
+		pr_warn("Warning: Unmaintained hardware is detected: %s:%04x:%04x @ %s\n",
+			dev_driver_string(&pdev->dev), pdev->device,
+			pdev->vendor, pci_name(pdev));
+	}
+
 	bars = pci_select_bars(pdev, IORESOURCE_MEM | IORESOURCE_IO);
 	sht = &qla2xxx_driver_template;
 	if (pdev->device == PCI_DEVICE_ID_QLOGIC_ISP2422 ||
-- 
2.31.1

