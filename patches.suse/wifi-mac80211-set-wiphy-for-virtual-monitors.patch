From a7614b482d64a1d7f595178b12d71f12936ba9a3 Mon Sep 17 00:00:00 2001
From: Johannes Berg <johannes.berg@intel.com>
Date: Mon, 28 Aug 2023 14:00:07 +0200
Subject: [PATCH] wifi: mac80211: set wiphy for virtual monitors
Git-commit: a7614b482d64a1d7f595178b12d71f12936ba9a3
Patch-mainline: v6.7-rc1
References: bsc#1227149

Drivers might plausibly want to have this, but also the
locking assertions will need it later.

Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Acked-by: Takashi Iwai <tiwai@suse.de>

---
 net/mac80211/iface.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/net/mac80211/iface.c b/net/mac80211/iface.c
index f7f58c3e8349..fc407be04ce9 100644
--- a/net/mac80211/iface.c
+++ b/net/mac80211/iface.c
@@ -1134,6 +1134,7 @@ int ieee80211_add_virtual_monitor(struct ieee80211_local *local)
 		 wiphy_name(local->hw.wiphy));
 	sdata->wdev.iftype = NL80211_IFTYPE_MONITOR;
 	mutex_init(&sdata->wdev.mtx);
+	sdata->wdev.wiphy = local->hw.wiphy;
 
 	ieee80211_sdata_init(local, sdata);
 
-- 
2.43.0

