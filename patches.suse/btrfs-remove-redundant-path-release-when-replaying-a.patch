From: Filipe Manana <fdmanana@suse.com>
Date: Wed, 21 May 2025 17:56:25 +0100
Subject: [PATCH] btrfs: remove redundant path release when replaying a log
 tree
Git-commit: 6466084df6b083b6f0778aa9adcb83cb8880597e
Patch-mainline: v6.17-rc1
References: git-fixes

There's no need to call btrfs_release_path() before calling
btrfs_init_root_free_objectid() as we have released the path already at
the top of the loop and the previous call to fixup_inode_link_counts()
also releases the path. So remove it to simplify the code.

Reviewed-by: Qu Wenruo <wqu@suse.com>
Signed-off-by: Filipe Manana <fdmanana@suse.com>
Reviewed-by: David Sterba <dsterba@suse.com>
Signed-off-by: David Sterba <dsterba@suse.com>
---
 fs/btrfs/tree-log.c | 2 --
 1 file changed, 2 deletions(-)

diff --git a/fs/btrfs/tree-log.c b/fs/btrfs/tree-log.c
index 6a60f072c3659..e52e15d46114c 100644
--- a/fs/btrfs/tree-log.c
+++ b/fs/btrfs/tree-log.c
@@ -7302,8 +7302,6 @@ int btrfs_recover_log_trees(struct btrfs_root *log_root_tree)
 		if (!ret && wc.stage == LOG_WALK_REPLAY_ALL) {
 			struct btrfs_root *root = wc.replay_dest;
 
-			btrfs_release_path(path);
-
 			/*
 			 * We have just replayed everything, and the highest
 			 * objectid of fs roots probably has changed in case
-- 
2.35.3

