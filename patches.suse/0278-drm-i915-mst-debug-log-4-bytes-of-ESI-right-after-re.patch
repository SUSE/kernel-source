From 896e75890a9d34e259a676225d96ce7fe497ef48 Mon Sep 17 00:00:00 2001
From: Jani Nikula <jani.nikula@intel.com>
Date: Wed, 12 Jan 2022 13:03:15 +0200
Subject: drm/i915/mst: debug log 4 bytes of ESI right after reading
Git-commit: 34ed3e83475eab0c8fe6bbb126165a3ff2f2ff90
Patch-mainline: v5.18-rc1
References: jsc#PED-1166 jsc#PED-1168 jsc#PED-1170 jsc#PED-1218 jsc#PED-1220 jsc#PED-1222 jsc#PED-1223 jsc#PED-1225

For whatever reason, the ESI link service irq vector was missing from
the debug output. Add the missing byte, clean up the debug message, and
do the logging right after reading the data.

Signed-off-by: Jani Nikula <jani.nikula@intel.com>
Reviewed-by: Uma Shankar <uma.shankar@intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20220112110319.1172110-3-jani.nikula@intel.com
Acked-by: Patrik Jakobsson <pjakobsson@suse.de>
---
 drivers/gpu/drm/i915/display/intel_dp.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/gpu/drm/i915/display/intel_dp.c b/drivers/gpu/drm/i915/display/intel_dp.c
index aa1ffe0eefe1..298de0a10a47 100644
--- a/drivers/gpu/drm/i915/display/intel_dp.c
+++ b/drivers/gpu/drm/i915/display/intel_dp.c
@@ -3683,6 +3683,8 @@ intel_dp_check_mst_status(struct intel_dp *intel_dp)
 			break;
 		}
 
+		drm_dbg_kms(&i915->drm, "DPRX ESI: %4ph\n", esi);
+
 		/* check link status - esi[10] = 0x200c */
 		if (intel_dp->active_mst_links > 0 && link_ok &&
 		    !drm_dp_channel_eq_ok(&esi[10], intel_dp->lane_count)) {
@@ -3691,8 +3693,6 @@ intel_dp_check_mst_status(struct intel_dp *intel_dp)
 			link_ok = false;
 		}
 
-		drm_dbg_kms(&i915->drm, "got esi %3ph\n", esi);
-
 		intel_dp_mst_hpd_irq(intel_dp, esi, &handled);
 
 		if (!handled)
-- 
2.38.1

