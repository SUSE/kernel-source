From: Eduard Zingerman <eddyz87@gmail.com>
Date: Sat, 25 Mar 2023 04:54:42 +0200
Subject: selftests/bpf: Report program name on parse_test_spec error
Patch-mainline: v6.4-rc1
Git-commit: 3e5329e193f463e6aaf98c33f7cb1308160880ab
References: bsc#1225903

Change test_loader.c:run_subtest() behavior to show BPF program name
when test spec for that program can't be parsed.

Signed-off-by: Eduard Zingerman <eddyz87@gmail.com>
Link: https://lore.kernel.org/r/20230325025524.144043-2-eddyz87@gmail.com
Signed-off-by: Alexei Starovoitov <ast@kernel.org>
Acked-by: Shung-Hsi Yu <shung-hsi.yu@suse.com>
---
 tools/testing/selftests/bpf/test_loader.c |    5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

--- a/tools/testing/selftests/bpf/test_loader.c
+++ b/tools/testing/selftests/bpf/test_loader.c
@@ -232,8 +232,11 @@ void run_subtest(struct test_loader *tes
 
 		/* if we can't derive test specification, go to the next test */
 		err = parse_test_spec(tester, obj, prog, &spec);
-		if (!ASSERT_OK(err, "parse_test_spec"))
+		if (err) {
+			PRINT_FAIL("Can't parse test spec for program '%s'\n",
+				   bpf_program__name(prog));
 			continue;
+		}
 
 		tobj = bpf_object__open_mem(obj_bytes, obj_byte_cnt, &open_opts);
 		if (!ASSERT_OK_PTR(tobj, "obj_open_mem")) /* shouldn't happen */
