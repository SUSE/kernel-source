From: Yang Yingliang <yangyingliang@huawei.com>
Date: Sat, 19 Aug 2023 10:37:16 +0800
Subject: vfio/pds: fix return value in pds_vfio_get_lm_file()
Git-commit: 2d12d18f14d9e6e2dcbc3e5942d718e6d4e028a5
Patch-mainline: v6.6-rc1
References: jsc#PED-7779 jsc#PED-7780

anon_inode_getfile() never returns NULL pointer, it will return
ERR_PTR() when it fails, so replace the check with IS_ERR().

Fixes: bb500dbe2ac6 ("vfio/pds: Add VFIO live migration support")
Signed-off-by: Yang Yingliang <yangyingliang@huawei.com>
Reviewed-by: Brett Creeley <brett.creeley@amd.com>
Link: https://lore.kernel.org/r/20230819023716.3469037-1-yangyingliang@huawei.com
Signed-off-by: Alex Williamson <alex.williamson@redhat.com>
Acked-by: Joerg Roedel <jroedel@suse.de>
---
 drivers/vfio/pci/pds/lm.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/vfio/pci/pds/lm.c b/drivers/vfio/pci/pds/lm.c
index aec75574cab3..79fe2e66bb49 100644
--- a/drivers/vfio/pci/pds/lm.c
+++ b/drivers/vfio/pci/pds/lm.c
@@ -31,7 +31,7 @@ pds_vfio_get_lm_file(const struct file_operations *fops, int flags, u64 size)
 	/* Create file */
 	lm_file->filep =
 		anon_inode_getfile("pds_vfio_lm", fops, lm_file, flags);
-	if (!lm_file->filep)
+	if (IS_ERR(lm_file->filep))
 		goto out_free_file;
 
 	stream_open(lm_file->filep->f_inode, lm_file->filep);

