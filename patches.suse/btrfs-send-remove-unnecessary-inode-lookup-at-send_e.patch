From: Filipe Manana <fdmanana@suse.com>
Date: Thu, 6 Mar 2025 17:45:40 +0000
Subject: [PATCH] btrfs: send: remove unnecessary inode lookup at
 send_encoded_inline_extent()
Git-commit: 0c8337c22043511549162df877cf752566aeedb9
Patch-mainline: v6.15-rc1
References: git-fixes

We are doing a lookup of the inode but we don't use it at all. So just
remove this pointless lookup.

Reviewed-by: Qu Wenruo <wqu@suse.com>
Signed-off-by: Filipe Manana <fdmanana@suse.com>
Reviewed-by: David Sterba <dsterba@suse.com>
Signed-off-by: David Sterba <dsterba@suse.com>
---
 fs/btrfs/send.c | 9 +--------
 1 file changed, 1 insertion(+), 8 deletions(-)

diff --git a/fs/btrfs/send.c b/fs/btrfs/send.c
index 119b9f1ee..f60177af2 100644
--- a/fs/btrfs/send.c
+++ b/fs/btrfs/send.c
@@ -5546,9 +5546,7 @@ static int send_encoded_inline_extent(struct send_ctx *sctx,
 				      struct btrfs_path *path, u64 offset,
 				      u64 len)
 {
-	struct btrfs_root *root = sctx->send_root;
-	struct btrfs_fs_info *fs_info = root->fs_info;
-	struct inode *inode;
+	struct btrfs_fs_info *fs_info = sctx->send_root->fs_info;
 	struct fs_path *fspath;
 	struct extent_buffer *leaf = path->nodes[0];
 	struct btrfs_key key;
@@ -5557,10 +5555,6 @@ static int send_encoded_inline_extent(struct send_ctx *sctx,
 	size_t inline_size;
 	int ret;
 
-	inode = btrfs_iget(sctx->cur_ino, root);
-	if (IS_ERR(inode))
-		return PTR_ERR(inode);
-
 	fspath = fs_path_alloc();
 	if (!fspath) {
 		ret = -ENOMEM;
@@ -5604,7 +5598,6 @@ static int send_encoded_inline_extent(struct send_ctx *sctx,
 tlv_put_failure:
 out:
 	fs_path_free(fspath);
-	iput(inode);
 	return ret;
 }
 
-- 
2.35.3

