From d2e85432a2e0a6f31bd9489800f443228f020ed6 Mon Sep 17 00:00:00 2001
From: Yang Yingliang <yangyingliang@huawei.com>
Date: Fri, 26 Aug 2022 15:33:37 +0800
Subject: [PATCH] fail_function: fix wrong use of fei_attr_remove()
Git-commit: d2e85432a2e0a6f31bd9489800f443228f020ed6
REferences: git-fixes
Patch-mainline: v6.1-rc1

If register_kprobe() fails, the new attr is not added to the list yet, so
it should call fei_attr_free() intstead.

Link: https://lkml.kernel.org/r/20220826073337.2085798-3-yangyingliang@huawei.com
Fixes: 4b1a29a7f542 ("error-injection: Support fault injection framework")
Signed-off-by: Yang Yingliang <yangyingliang@huawei.com>
Reviewed-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Oliver Neukum <oneukum@suse.com>

---
 kernel/fail_function.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/kernel/fail_function.c
+++ b/kernel/fail_function.c
@@ -301,7 +301,7 @@ static ssize_t fei_write(struct file *fi
 	if (!ret)
 		fei_debugfs_add_attr(attr);
 	if (ret < 0)
-		fei_attr_remove(attr);
+		fei_attr_free(attr);
 	else {
 		list_add_tail(&attr->list, &fei_attr_list);
 		ret = count;
