From: Shung-Hsi Yu <shung-hsi.yu@suse.com>
Date: Tue, 01 Fed 2022 09:12:20 +0800
Subject: [PATCH] bpf: make module BTF toggleable
Patch-mainline: Never, discussing proper fix with upstream
References: bsc#1194501

In its current form, kernel module BTF won't work for 3rd party kernel modules
due to the fact that the base BTF on vmlinux can change even when our kABI is
stable, leading to BTF incompatability between the kernel and 3rd party kernel
module.

This patch allows us to disable BTF support on kernel modules, which workaround
the current issue.
---
 lib/Kconfig.debug |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/lib/Kconfig.debug
+++ b/lib/Kconfig.debug
@@ -325,7 +325,7 @@ config PAHOLE_HAS_SPLIT_BTF
 	def_bool $(success, test `$(PAHOLE) --version | sed -E 's/v([0-9]+)\.([0-9]+)/\1\2/'` -ge "119")
 
 config DEBUG_INFO_BTF_MODULES
-	def_bool y
+	bool "Generate BTF typeinfo for kernel modules"
 	depends on DEBUG_INFO_BTF && MODULES && PAHOLE_HAS_SPLIT_BTF
 	help
 	  Generate compact split BTF type information for kernel modules.
