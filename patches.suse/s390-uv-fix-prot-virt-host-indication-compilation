From: Janosch Frank <frankja@linux.ibm.com>
Date: Tue, 23 Mar 2021 10:09:50 +0000
Subject: s390/uv: fix prot virt host indication compilation
Git-commit: df2e400e07ad53a582ee934ce8384479d5ddf48b
Patch-mainline: v5.13-rc1
References: jsc#SLE-22135

prot_virt_host is only available if CONFIG_KVM is enabled. So lets use
a variable initialized to zero and overwrite it when that config
option is set with prot_virt_host.

Signed-off-by: Janosch Frank <frankja@linux.ibm.com>
Fixes: 37564ed834ac ("s390/uv: add prot virt guest/host indication files")
Reported-by: kernel test robot <lkp@intel.com>
Signed-off-by: Heiko Carstens <hca@linux.ibm.com>
Acked-by: Petr Tesarik <ptesarik@suse.com>
---
 arch/s390/kernel/uv.c |    8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

--- a/arch/s390/kernel/uv.c
+++ b/arch/s390/kernel/uv.c
@@ -397,7 +397,13 @@ static ssize_t uv_is_prot_virt_guest(str
 static ssize_t uv_is_prot_virt_host(struct kobject *kobj,
 				    struct kobj_attribute *attr, char *page)
 {
-	return scnprintf(page, PAGE_SIZE, "%d\n", prot_virt_host);
+	int val = 0;
+
+#if IS_ENABLED(CONFIG_KVM)
+	val = prot_virt_host;
+#endif
+
+	return scnprintf(page, PAGE_SIZE, "%d\n", val);
 }
 
 static struct kobj_attribute uv_prot_virt_guest =
