From 6810ee918d23f67170f127a848cf30c257adcaff Mon Sep 17 00:00:00 2001
From: Johannes Berg <johannes.berg@intel.com>
Date: Wed, 28 Feb 2024 09:48:09 +0100
Subject: [PATCH] wifi: mac80211: update scratch_pos after defrag
Git-commit: 6810ee918d23f67170f127a848cf30c257adcaff
Patch-mainline: v6.9-rc1
References: git-fixes

The scratch_pos update here was lost after defrag, so any
other uses of the scratch buffer might overwrite it.

Fixes: a286de1aa38f ("wifi: mac80211: Rename multi_link")
Reviewed-by: Benjamin Berg <benjamin.berg@intel.com>
Reviewed-by: Ilan Peer <ilan.peer@intel.com>
Reviewed-by: Miriam Rachel Korenblit <miriam.rachel.korenblit@intel.com>
Link: https://msgid.link/20240228094901.9da35f39eeb7.I7127f2918ec4cba416fcbc35eacaea10262c1268@changeid
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Acked-by: Takashi Iwai <tiwai@suse.de>

---
 net/mac80211/util.c |    1 +
 1 file changed, 1 insertion(+)

--- a/net/mac80211/util.c
+++ b/net/mac80211/util.c
@@ -1561,6 +1561,7 @@ static void ieee80211_mle_parse_link(str
 
 	elems->ml_basic = (const void *)elems->scratch_pos;
 	elems->ml_basic_len = ml_len;
+	elems->scratch_pos += ml_len;
 
 	ieee80211_mle_get_sta_prof(elems, params->link_id);
 	prof = elems->prof;
