From 63e38d0787971d3026bb5e31c86663e0f1e62586 Mon Sep 17 00:00:00 2001
From: Takashi Iwai <tiwai@suse.de>
Date: Sat, 7 Sep 2024 10:40:47 +0200
Subject: [PATCH] ALSA: hda: Allow the default preallocation for x86 again
Git-commit: 63e38d0787971d3026bb5e31c86663e0f1e62586
Patch-mainline: v6.12-rc1
References: stable-fixes

Since there are a few corner cases where the S/G buffer allocation
isn't performed (e.g. depending on IOMMU implementations), it'd be
better to allow the default buffer preallocation size for x86, too.

The default for x86 is still kept to 0, as it should work in most
cases.

Link: https://patch.msgid.link/20240907084129.28802-1-tiwai@suse.de
Signed-off-by: Takashi Iwai <tiwai@suse.de>

---
 sound/hda/Kconfig | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/sound/hda/Kconfig b/sound/hda/Kconfig
index e2ac247fc1d4..eb488a522572 100644
--- a/sound/hda/Kconfig
+++ b/sound/hda/Kconfig
@@ -21,7 +21,7 @@ config SND_HDA_EXT_CORE
        select SND_HDA_CORE
 
 config SND_HDA_PREALLOC_SIZE
-	int "Pre-allocated buffer size for HD-audio driver" if !SND_DMA_SGBUF
+	int "Pre-allocated buffer size for HD-audio driver"
 	range 0 32768
 	default 0 if SND_DMA_SGBUF
 	default 64 if !SND_DMA_SGBUF
@@ -30,7 +30,8 @@ config SND_HDA_PREALLOC_SIZE
 	  HD-audio driver.  A larger buffer (e.g. 2048) is preferred
 	  for systems using PulseAudio.  The default 64 is chosen just
 	  for compatibility reasons.
-	  On x86 systems, the default is zero as we need no preallocation.
+	  On x86 systems, the default is zero as S/G allocation works
+	  and no preallocation is needed in most cases.
 
 	  Note that the pre-allocation size can be changed dynamically
 	  via a proc file (/proc/asound/card*/pcm*/sub*/prealloc), too.
-- 
2.43.0

