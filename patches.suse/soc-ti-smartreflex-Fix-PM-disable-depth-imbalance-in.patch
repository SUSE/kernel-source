From 69460e68eb662064ab4188d4e129ff31c1f23ed9 Mon Sep 17 00:00:00 2001
From: Zhang Qilong <zhangqilong3@huawei.com>
Date: Tue, 8 Nov 2022 16:03:22 +0800
Subject: [PATCH] soc: ti: smartreflex: Fix PM disable depth imbalance in omap_sr_probe
Git-commit: 69460e68eb662064ab4188d4e129ff31c1f23ed9
Patch-mainline: v6.2-rc1
References: git-fixes

The pm_runtime_enable will increase power disable depth. Thus
a pairing decrement is needed on the error handling path to
keep it balanced according to context.

Fixes: 984aa6dbf4ca ("OMAP3: PM: Adding smartreflex driver support.")
Signed-off-by: Zhang Qilong <zhangqilong3@huawei.com>
Signed-off-by: Nishanth Menon <nm@ti.com>
Link: https://lore.kernel.org/r/20221108080322.52268-3-zhangqilong3@huawei.com
Acked-by: Takashi Iwai <tiwai@suse.de>

---
 drivers/soc/ti/smartreflex.c |    1 +
 1 file changed, 1 insertion(+)

--- a/drivers/soc/ti/smartreflex.c
+++ b/drivers/soc/ti/smartreflex.c
@@ -940,6 +940,7 @@ static int omap_sr_probe(struct platform
 err_debugfs:
 	debugfs_remove_recursive(sr_info->dbg_dir);
 err_list_del:
+	pm_runtime_disable(&pdev->dev);
 	list_del(&sr_info->node);
 
 	pm_runtime_put_sync(&pdev->dev);
