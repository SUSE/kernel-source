From: Stanislav Fomichev <sdf@fomichev.me>
Date: Wed, 4 Dec 2024 07:55:45 -0800
Subject: ynl: add missing pieces to ethtool spec to better match uapi header
Patch-mainline: v6.14-rc1
Git-commit: 0187e602c03c876d69cf955dd438bc7fea8c8fd3
References: jsc#PED-10684 jsc#PED-11230

- __ETHTOOL_UDP_TUNNEL_TYPE_CNT and render max
- skip rendering stringset (empty enum)
- skip rendering c33-pse-ext-state (defined in ethtool.h)
- rename header flags to ethtool-flag-
- add attr-cnt-name to each attribute to use XXX_CNT instead of XXX_MAX
- add unspec 0 entry to each attribute
- carry some doc entries from the existing header
- tcp-header-split

Signed-off-by: Stanislav Fomichev <sdf@fomichev.me>
Link: https://patch.msgid.link/20241204155549.641348-5-sdf@fomichev.me
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 Documentation/netlink/specs/ethtool.yaml |  358 +++++++++++++++++++++++++++++--
 1 file changed, 346 insertions(+), 12 deletions(-)

--- a/Documentation/netlink/specs/ethtool.yaml
+++ b/Documentation/netlink/specs/ethtool.yaml
@@ -5,6 +5,7 @@ name: ethtool
 protocol: genetlink-legacy
 
 doc: Partial family for Ethtool Netlink.
+uapi-header: linux/ethtool_netlink_generated.h
 
 definitions:
   -
@@ -12,44 +13,100 @@ definitions:
     enum-name:
     type: enum
     entries: [ vxlan, geneve, vxlan-gpe ]
+    enum-cnt-name: __ethtool-udp-tunnel-type-cnt
+    render-max: true
   -
     name: stringset
     type: enum
     entries: []
+    header: linux/ethtool.h # skip rendering, no actual definition
   -
     name: header-flags
     type: flags
-    entries: [ compact-bitsets, omit-reply, stats ]
+    name-prefix: ethtool-flag-
+    doc: common ethtool header flags
+    entries:
+      -
+        name: compact-bitsets
+        doc: use compact bitsets in reply
+      -
+        name: omit-reply
+        doc: provide optional reply for SET or ACT requests
+      -
+        name: stats
+        doc: request statistics, if supported by the driver
   -
     name: module-fw-flash-status
     type: enum
-    entries: [ started, in_progress, completed, error ]
+    doc: plug-in module firmware flashing status
+    header: linux/ethtool.h
+    entries:
+      -
+        name: started
+        doc: The firmware flashing process has started.
+      -
+        name: in_progress
+        doc: The firmware flashing process is in progress.
+      -
+        name: completed
+        doc: The firmware flashing process was completed successfully.
+      -
+        name: error
+        doc: The firmware flashing process was stopped due to an error.
   -
     name: c33-pse-ext-state
-    enum-name:
+    doc: "groups of PSE extended states functions. IEEE 802.3-2022 33.2.4.4 Variables"
     type: enum
     name-prefix: ethtool-c33-pse-ext-state-
+    header: linux/ethtool.h
     entries:
-        - none
-        - error-condition
-        - mr-mps-valid
-        - mr-pse-enable
-        - option-detect-ted
-        - option-vport-lim
-        - ovld-detected
-        - power-not-available
-        - short-detected
+        -
+          name: none
+          doc: none
+        -
+          name: error-condition
+          doc: Group of error_condition states
+        -
+          name: mr-mps-valid
+          doc: Group of mr_mps_valid states
+        -
+          name: mr-pse-enable
+          doc: Group of mr_pse_enable states
+        -
+          name: option-detect-ted
+          doc: Group of option_detect_ted states
+        -
+          name: option-vport-lim
+          doc: Group of option_vport_lim states
+        -
+          name: ovld-detected
+          doc: Group of ovld_detected states
+        -
+          name: power-not-available
+          doc: Group of power_not_available states
+        -
+          name: short-detected
+          doc: Group of short_detected states
   -
     name: phy-upstream-type
     enum-name:
     type: enum
     entries: [ mac, phy ]
+  -
+    name: tcp-data-split
+    type: enum
+    entries: [ unknown, disabled, enabled ]
 
 attribute-sets:
   -
     name: header
+    attr-cnt-name: __ethtool-a-header-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: dev-index
         type: u32
       -
@@ -65,8 +122,13 @@ attribute-sets:
 
   -
     name: bitset-bit
+    attr-cnt-name: __ethtool-a-bitset-bit-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: index
         type: u32
       -
@@ -77,16 +139,26 @@ attribute-sets:
         type: flag
   -
     name: bitset-bits
+    attr-cnt-name: __ethtool-a-bitset-bits-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: bit
         type: nest
         multi-attr: true
         nested-attributes: bitset-bit
   -
     name: bitset
+    attr-cnt-name: __ethtool-a-bitset-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: nomask
         type: flag
       -
@@ -104,8 +176,13 @@ attribute-sets:
         type: binary
   -
     name: string
+    attr-cnt-name: __ethtool-a-string-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: index
         type: u32
       -
@@ -113,16 +190,30 @@ attribute-sets:
         type: string
   -
     name: strings
+    attr-cnt-name: __ethtool-a-strings-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: string
         type: nest
         multi-attr: true
         nested-attributes: string
   -
     name: stringset
+    attr-cnt-name: __ethtool-a-stringset-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: id
         type: u32
       -
@@ -135,16 +226,26 @@ attribute-sets:
         nested-attributes: strings
   -
     name: stringsets
+    attr-cnt-name: __ethtool-a-stringsets-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: stringset
         type: nest
         multi-attr: true
         nested-attributes: stringset
   -
     name: strset
+    attr-cnt-name: __ethtool-a-strset-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
@@ -158,8 +259,13 @@ attribute-sets:
 
   -
     name: privflags
+    attr-cnt-name: __ethtool-a-privflags-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
@@ -170,8 +276,13 @@ attribute-sets:
 
   -
     name: rings
+    attr-cnt-name: __ethtool-a-rings-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
@@ -205,6 +316,7 @@ attribute-sets:
       -
         name: tcp-data-split
         type: u8
+        enum: tcp-data-split
       -
         name: cqe-size
         type: u32
@@ -223,32 +335,49 @@ attribute-sets:
 
   -
     name: mm-stat
+    attr-cnt-name: __ethtool-a-mm-stat-cnt
+    doc: MAC Merge (802.3)
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: pad
         type: pad
       -
         name: reassembly-errors
+        doc: aMACMergeFrameAssErrorCount
         type: u64
       -
         name: smd-errors
+        doc: aMACMergeFrameSmdErrorCount
         type: u64
       -
         name: reassembly-ok
+        doc: aMACMergeFrameAssOkCount
         type: u64
       -
         name: rx-frag-count
+        doc: aMACMergeFragCountRx
         type: u64
       -
         name: tx-frag-count
+        doc: aMACMergeFragCountTx
         type: u64
       -
         name: hold-count
+        doc: aMACMergeHoldCount
         type: u64
   -
     name: mm
+    attr-cnt-name: __ethtool-a-mm-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
@@ -285,8 +414,13 @@ attribute-sets:
         nested-attributes: mm-stat
   -
     name: linkinfo
+    attr-cnt-name: __ethtool-a-linkinfo-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
@@ -307,8 +441,13 @@ attribute-sets:
         type: u8
   -
     name: linkmodes
+    attr-cnt-name: __ethtool-a-linkmodes-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
@@ -343,8 +482,13 @@ attribute-sets:
         type: u8
   -
     name: linkstate
+    attr-cnt-name: __ethtool-a-linkstate-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
@@ -368,8 +512,13 @@ attribute-sets:
         type: u32
   -
     name: debug
+    attr-cnt-name: __ethtool-a-debug-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
@@ -379,8 +528,13 @@ attribute-sets:
         nested-attributes: bitset
   -
     name: wol
+    attr-cnt-name: __ethtool-a-wol-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
@@ -393,8 +547,13 @@ attribute-sets:
         type: binary
   -
     name: features
+    attr-cnt-name: __ethtool-a-features-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
@@ -416,8 +575,13 @@ attribute-sets:
         nested-attributes: bitset
   -
     name: channels
+    attr-cnt-name: __ethtool-a-channels-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
@@ -448,8 +612,13 @@ attribute-sets:
 
   -
     name: irq-moderation
+    attr-cnt-name: __ethtool-a-irq-moderation-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: usec
         type: u32
       -
@@ -460,16 +629,26 @@ attribute-sets:
         type: u32
   -
     name: profile
+    attr-cnt-name: __ethtool-a-profile-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: irq-moderation
         type: nest
         multi-attr: true
         nested-attributes: irq-moderation
   -
     name: coalesce
+    attr-cnt-name: __ethtool-a-coalesce-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
@@ -565,8 +744,13 @@ attribute-sets:
 
   -
     name: pause-stat
+    attr-cnt-name: __ethtool-a-pause-stat-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: pad
         type: pad
       -
@@ -577,8 +761,13 @@ attribute-sets:
         type: u64
   -
     name: pause
+    attr-cnt-name: __ethtool-a-pause-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
@@ -600,8 +789,13 @@ attribute-sets:
         type: u32
   -
     name: eee
+    attr-cnt-name: __ethtool-a-eee-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
@@ -627,8 +821,13 @@ attribute-sets:
         type: u32
   -
     name: ts-stat
+    attr-cnt-name: __ethtool-a-ts-stat-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: tx-pkts
         type: uint
       -
@@ -639,8 +838,13 @@ attribute-sets:
         type: uint
   -
     name: tsinfo
+    attr-cnt-name: __ethtool-a-tsinfo-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
@@ -665,20 +869,33 @@ attribute-sets:
         nested-attributes: ts-stat
   -
     name: cable-result
+    attr-cnt-name: __ethtool-a-cable-result-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: pair
+        doc: ETHTOOL_A_CABLE_PAIR
         type: u8
       -
         name: code
+        doc: ETHTOOL_A_CABLE_RESULT_CODE
         type: u8
       -
         name: src
+        doc: ETHTOOL_A_CABLE_INF_SRC
         type: u32
   -
     name: cable-fault-length
+    attr-cnt-name: __ethtool-a-cable-fault-length-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: pair
         type: u8
       -
@@ -689,8 +906,13 @@ attribute-sets:
         type: u32
   -
     name: cable-nest
+    attr-cnt-name: __ethtool-a-cable-nest-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: result
         type: nest
         nested-attributes: cable-result
@@ -700,20 +922,31 @@ attribute-sets:
         nested-attributes: cable-fault-length
   -
     name: cable-test
+    attr-cnt-name: __ethtool-a-cable-test-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
   -
     name: cable-test-ntf
+    attr-cnt-name: __ethtool-a-cable-test-ntf-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
       -
         name: status
+        doc: _STARTED/_COMPLETE
         type: u8
       -
         name: nest
@@ -721,8 +954,13 @@ attribute-sets:
         nested-attributes: cable-nest
   -
     name: cable-test-tdr-cfg
+    attr-cnt-name: __ethtool-a-cable-test-tdr-cfg-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: first
         type: u32
       -
@@ -736,8 +974,13 @@ attribute-sets:
         type: u8
   -
     name: cable-test-tdr-ntf
+    attr-cnt-name: __ethtool-a-cable-test-tdr-ntf-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
@@ -750,8 +993,13 @@ attribute-sets:
         nested-attributes: cable-nest
   -
     name: cable-test-tdr
+    attr-cnt-name: __ethtool-a-cable-test-tdr-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
@@ -761,8 +1009,13 @@ attribute-sets:
         nested-attributes: cable-test-tdr-cfg
   -
     name: tunnel-udp-entry
+    attr-cnt-name: __ethtool-a-tunnel-udp-entry-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: port
         type: u16
         byte-order: big-endian
@@ -772,8 +1025,13 @@ attribute-sets:
         enum: udp-tunnel-type
   -
     name: tunnel-udp-table
+    attr-cnt-name: __ethtool-a-tunnel-udp-table-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: size
         type: u32
       -
@@ -787,15 +1045,25 @@ attribute-sets:
         nested-attributes: tunnel-udp-entry
   -
     name: tunnel-udp
+    attr-cnt-name: __ethtool-a-tunnel-udp-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: table
         type: nest
         nested-attributes: tunnel-udp-table
   -
     name: tunnel-info
+    attr-cnt-name: __ethtool-a-tunnel-info-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
@@ -805,8 +1073,13 @@ attribute-sets:
         nested-attributes: tunnel-udp
   -
     name: fec-stat
+    attr-cnt-name: __ethtool-a-fec-stat-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: pad
         type: pad
       -
@@ -823,8 +1096,13 @@ attribute-sets:
         sub-type: u64
   -
     name: fec
+    attr-cnt-name: __ethtool-a-fec-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
@@ -844,8 +1122,13 @@ attribute-sets:
         nested-attributes: fec-stat
   -
     name: module-eeprom
+    attr-cnt-name: __ethtool-a-module-eeprom-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
@@ -869,8 +1152,13 @@ attribute-sets:
         type: binary
   -
     name: stats-grp
+    attr-cnt-name: __ethtool-a-stats-grp-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: pad
         type: pad
       -
@@ -912,8 +1200,13 @@ attribute-sets:
         name: hist-val
   -
     name: stats
+    attr-cnt-name: __ethtool-a-stats-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: pad
         type: pad
       -
@@ -933,8 +1226,13 @@ attribute-sets:
         type: u32
   -
     name: phc-vclocks
+    attr-cnt-name: __ethtool-a-phc-vclocks-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
@@ -947,8 +1245,13 @@ attribute-sets:
         sub-type: s32
   -
     name: module
+    attr-cnt-name: __ethtool-a-module-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
@@ -960,8 +1263,14 @@ attribute-sets:
         type: u8
   -
     name: c33-pse-pw-limit
+    attr-cnt-name: __ethtool-a-c33-pse-pw-limit-cnt
+    attr-max-name: __ethtool-a-c33-pse-pw-limit-max
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: min
         type: u32
       -
@@ -969,8 +1278,13 @@ attribute-sets:
         type: u32
   -
     name: pse
+    attr-cnt-name: __ethtool-a-pse-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
@@ -1027,8 +1341,13 @@ attribute-sets:
         nested-attributes: c33-pse-pw-limit
   -
     name: rss
+    attr-cnt-name: __ethtool-a-rss-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
@@ -1053,8 +1372,13 @@ attribute-sets:
         type: u32
   -
     name: plca
+    attr-cnt-name: __ethtool-a-plca-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
@@ -1084,8 +1408,13 @@ attribute-sets:
         type: u32
   -
     name: module-fw-flash
+    attr-cnt-name: __ethtool-a-module-fw-flash-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
@@ -1110,8 +1439,13 @@ attribute-sets:
         type: uint
   -
     name: phy
+    attr-cnt-name: __ethtool-a-phy-cnt
     attributes:
       -
+        name: unspec
+        type: unused
+        value: 0
+      -
         name: header
         type: nest
         nested-attributes: header
