From a65cdffbef7bfdb9f55a3acb07ccf18d4f97b3a5 Mon Sep 17 00:00:00 2001
From: Arnd Bergmann <arnd@arndb.de>
Date: Fri, 27 Oct 2023 17:23:54 +0200
Subject: [PATCH] ASoC: amd: acp: select SND_SOC_AMD_ACP_LEGACY_COMMON for ACP63
Git-commit: a65cdffbef7bfdb9f55a3acb07ccf18d4f97b3a5
Patch-mainline: v6.7-rc1
References: jsc#PED-9993 jsc#PED-10202

Without this dependency, acp63 fails to link:

X86_64-linux-ld: sound/soc/amd/acp/acp63.o: in function `acp63_audio_remove':
acp63.c:(.text+0x22): undefined reference to `acp_disable_interrupts'
X86_64-linux-ld: sound/soc/amd/acp/acp63.o: in function `acp63_i2s_master_clock_generate.isra.0':
acp63.c:(.text+0x6f): undefined reference to `smn_read'
X86_64-linux-ld: acp63.c:(.text+0x81): undefined reference to `smn_write'
X86_64-linux-ld: acp63.c:(.text+0x8e): undefined reference to `smn_read'
X86_64-linux-ld: sound/soc/amd/acp/acp63.o: in function `acp63_pcm_resume':
acp63.c:(.text+0x230): undefined reference to `restore_acp_i2s_params'
X86_64-linux-ld: acp63.c:(.text+0x23d): undefined reference to `restore_acp_pdm_params'
X86_64-linux-ld: sound/soc/amd/acp/acp63.o: in function `acp63_audio_probe':
acp63.c:(.text+0x474): undefined reference to `acp_enable_interrupts'

Fixes: d4c2d5391d7e ("ASoC: amd: acp: add Kconfig options for acp6.3 based platform driver")
Signed-off-by: Arnd Bergmann <arnd@arndb.de>
Link: https://lore.kernel.org/r/20231027152403.386257-3-arnd@kernel.org
Signed-off-by: Mark Brown <broonie@kernel.org>
Acked-by: Takashi Iwai <tiwai@suse.de>

---
 sound/soc/amd/acp/Kconfig | 20 +++++++++++---------
 1 file changed, 11 insertions(+), 9 deletions(-)

diff --git a/sound/soc/amd/acp/Kconfig b/sound/soc/amd/acp/Kconfig
index b0e4d5117b81..5fb322212938 100644
--- a/sound/soc/amd/acp/Kconfig
+++ b/sound/soc/amd/acp/Kconfig
@@ -61,15 +61,17 @@ config SND_AMD_ASOC_REMBRANDT
 	  If unsure select "N".
 
 config SND_AMD_ASOC_ACP63
-        tristate "AMD ACP ASOC ACP6.3 Support"
-        select SND_SOC_AMD_ACP_PCM
-        select SND_SOC_AMD_ACP_I2S
-        select SND_SOC_AMD_ACP_PDM
-        depends on X86 && PCI
-        help
-          This option enables Acp6.3 I2S support on AMD platform.
-          Say Y if you want to enable AUDIO on ACP6.3
-          If unsure select "N".
+	tristate "AMD ACP ASOC ACP6.3 Support"
+	depends on X86 && PCI
+	depends on ACPI
+	select SND_SOC_AMD_ACP_PCM
+	select SND_SOC_AMD_ACP_I2S
+	select SND_SOC_AMD_ACP_PDM
+	select SND_SOC_AMD_ACP_LEGACY_COMMON
+	help
+	  This option enables Acp6.3 I2S support on AMD platform.
+	  Say Y if you want to enable AUDIO on ACP6.3
+	  If unsure select "N".
 
 config SND_SOC_AMD_MACH_COMMON
 	tristate
-- 
2.43.0

