From ee509efc74ddbc59bb5d6fd6e050f9ef25f74bff Mon Sep 17 00:00:00 2001
From: Herbert Xu <herbert@gondor.apana.org.au>
Date: Sat, 15 Feb 2025 08:57:51 +0800
Subject: [PATCH] crypto: skcipher - Zap type in crypto_alloc_sync_skcipher
Git-commit: ee509efc74ddbc59bb5d6fd6e050f9ef25f74bff
Patch-mainline: v6.15-rc1
References: stable-fixes

The type needs to be zeroed as otherwise the user could use it to
allocate an asynchronous sync skcipher.

Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
Acked-by: Takashi Iwai <tiwai@suse.de>

---
 crypto/skcipher.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/crypto/skcipher.c b/crypto/skcipher.c
index e3751cc88b76..cdf0f11c7eaa 100644
--- a/crypto/skcipher.c
+++ b/crypto/skcipher.c
@@ -682,6 +682,7 @@ struct crypto_sync_skcipher *crypto_alloc_sync_skcipher(
 
 	/* Only sync algorithms allowed. */
 	mask |= CRYPTO_ALG_ASYNC | CRYPTO_ALG_SKCIPHER_REQSIZE_LARGE;
+	type &= ~(CRYPTO_ALG_ASYNC | CRYPTO_ALG_SKCIPHER_REQSIZE_LARGE);
 
 	tfm = crypto_alloc_tfm(alg_name, &crypto_skcipher_type, type, mask);
 
-- 
2.49.0

