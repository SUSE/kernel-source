From: Lior Nahmanson <liorna@nvidia.com>
Date: Mon, 30 Aug 2021 13:48:49 +0300
Subject: RDMA/mlx5: Relax DCS QP creation checks
Patch-mainline: v5.15-rc1
Git-commit: 65f90c8e38c9900692338864156e7824cf8a6501
References: jsc#SLE-19250

In order to create DCS QPs, we don't need to rely on both
log_max_dci_stream_channels and log_max_dci_errored_streams capabilities.

Fixes: 11656f593a86 ("RDMA/mlx5: Add DCS offload support")
Link: https://lore.kernel.org/r/3e7b3363fd73686176cc584295e86832a7cf99b2.1630320354.git.leonro@nvidia.com
Signed-off-by: Lior Nahmanson <liorna@nvidia.com>
Signed-off-by: Leon Romanovsky <leonro@nvidia.com>
Signed-off-by: Jason Gunthorpe <jgg@nvidia.com>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 drivers/infiniband/hw/mlx5/qp.c |    3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

--- a/drivers/infiniband/hw/mlx5/qp.c
+++ b/drivers/infiniband/hw/mlx5/qp.c
@@ -2811,8 +2811,7 @@ static int process_vendor_flags(struct m
 	process_vendor_flag(dev, &flags, MLX5_QP_FLAG_TYPE_DCI, true, qp);
 	process_vendor_flag(dev, &flags, MLX5_QP_FLAG_TYPE_DCT, true, qp);
 	process_vendor_flag(dev, &flags, MLX5_QP_FLAG_DCI_STREAM,
-			    MLX5_CAP_GEN(mdev, log_max_dci_stream_channels) &&
-			    MLX5_CAP_GEN(mdev, log_max_dci_errored_streams),
+			    MLX5_CAP_GEN(mdev, log_max_dci_stream_channels),
 			    qp);
 
 	process_vendor_flag(dev, &flags, MLX5_QP_FLAG_SIGNATURE, true, qp);
