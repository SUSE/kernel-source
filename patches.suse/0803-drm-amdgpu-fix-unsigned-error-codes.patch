From 5ea37feb25196ae333cd7a76b3185c6192e99b37 Mon Sep 17 00:00:00 2001
From: Lang Yu <Lang.Yu@amd.com>
Date: Wed, 6 Sep 2023 19:15:45 +0800
Subject: drm/amdgpu: fix unsigned error codes
Git-commit: dbb805215177ce49f37c00c4f026a62eebec19dc
Patch-mainline: v6.7-rc1
References: jsc#PED-9898 jsc#PED-10191 jsc#PED-10197 jsc#PED-10226 jsc#PED-10237 jsc#PED-10340 jsc#PED-10852 jsc#PED-11022 jsc#PED-3527 jsc#PED-5475 jsc#PED-6068 jsc#PED-6070 jsc#PED-6116 jsc#PED-6120 jsc#PED-5065 jsc#PED-5477 jsc#PED-5511 jsc#PED-6041 jsc#PED-6069 jsc#PED-6071

Fixes: 5d5eac7e8303 ("drm/amdgpu: add selftest framework for UMSCH")
Signed-off-by: Lang Yu <Lang.Yu@amd.com>
Reviewed-by: Alex Deucher <alexander.deucher@amd.com>
Reported-by: Dan Carpenter <dan.carpenter@linaro.org>
Link: https://lore.kernel.org/all/ZPhddADtKmOuVyDq@lang-desktop
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Acked-by: Patrik Jakobsson <pjakobsson@suse.de>
---
 drivers/gpu/drm/amd/amdgpu/amdgpu_umsch_mm.c | 7 +++----
 1 file changed, 3 insertions(+), 4 deletions(-)

diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu_umsch_mm.c b/drivers/gpu/drm/amd/amdgpu/amdgpu_umsch_mm.c
index 7341808a3558..562ed4e937ba 100644
--- a/drivers/gpu/drm/amd/amdgpu/amdgpu_umsch_mm.c
+++ b/drivers/gpu/drm/amd/amdgpu/amdgpu_umsch_mm.c
@@ -334,11 +334,10 @@ static int setup_umsch_mm_test(struct amdgpu_device *adev,
 	if (r)
 		goto error_free_vm;
 
-	test->pasid = amdgpu_pasid_alloc(16);
-	if (test->pasid < 0) {
-		r = test->pasid;
+	r = amdgpu_pasid_alloc(16);
+	if (r < 0)
 		goto error_fini_vm;
-	}
+	test->pasid = r;
 
 	r = amdgpu_bo_create_kernel(adev, sizeof(struct umsch_mm_test_ctx_data),
 				    PAGE_SIZE, AMDGPU_GEM_DOMAIN_GTT,
-- 
2.46.0

