From a2c2a622d41168f9fea2aa3f76b9fbaa88531aac Mon Sep 17 00:00:00 2001
From: Zhen Lei <thunder.leizhen@huawei.com>
Date: Sat, 8 May 2021 11:33:13 +0800
Subject: [PATCH] ubifs: journal: Fix error return code in
 ubifs_jnl_write_inode()
Git-commit: a2c2a622d41168f9fea2aa3f76b9fbaa88531aac
Patch-mainline: v5.14-rc1
References: bsc#1189586

Fix to return a negative error code from the error handling case instead
of 0, as done elsewhere in this function.

Fixes: 9ca2d7326444 ("ubifs: Limit number of xattrs per inode")
Reported-by: Hulk Robot <hulkci@huawei.com>
Signed-off-by: Zhen Lei <thunder.leizhen@huawei.com>
Signed-off-by: Richard Weinberger <richard@nod.at>
Acked-by: Jan Kara <jack@suse.cz>

---
 fs/ubifs/journal.c |    1 +
 1 file changed, 1 insertion(+)

--- a/fs/ubifs/journal.c
+++ b/fs/ubifs/journal.c
@@ -882,6 +882,7 @@ int ubifs_jnl_write_inode(struct ubifs_i
 		struct ubifs_dent_node *xent, *pxent = NULL;
 
 		if (ui->xattr_cnt >= ubifs_xattr_max_cnt(c)) {
+			err = -EPERM;
 			ubifs_err(c, "Cannot delete inode, it has too much xattrs!");
 			goto out_release;
 		}
