From: Lee Duncan <lduncan@suse.com>
Date: Sun 20 Oct 2024 10:24:54 AM PDT
Subject: block: add back disk_update_readahead
Patch-mainline: never, SUSE-specific
References: bsc#1228325 jsc#PED-9783

This interface was removed by upstream commit:

> 73781b3b81e7 ('block: remove disk_update_readahead')

which has been back-ported to this code base,
but which is needed here, since some other
back-ported commits use this API.

So add it back in, for use outside of the block
subsystem.
---
 block/blk-settings.c   |    6 ++++++
 include/linux/blkdev.h |    1 +
 2 files changed, 7 insertions(+)

--- a/block/blk-settings.c
+++ b/block/blk-settings.c
@@ -555,6 +555,12 @@ void blk_queue_alignment_offset(struct r
 }
 EXPORT_SYMBOL(blk_queue_alignment_offset);
 
+void disk_update_readahead(struct gendisk *disk)
+{
+	blk_apply_bdi_limits(disk->bdi, &disk->queue->limits);
+}
+EXPORT_SYMBOL_GPL(disk_update_readahead);
+
 /**
  * blk_limits_io_min - set minimum request size for a device
  * @limits: the queue limits
--- a/include/linux/blkdev.h
+++ b/include/linux/blkdev.h
@@ -948,6 +948,7 @@ void blk_queue_zone_write_granularity(st
 				      unsigned int size);
 extern void blk_queue_alignment_offset(struct request_queue *q,
 				       unsigned int alignment);
+extern void disk_update_readahead(struct gendisk *disk);
 extern void blk_limits_io_min(struct queue_limits *limits, unsigned int min);
 extern void blk_queue_io_min(struct request_queue *q, unsigned int min);
 extern void blk_limits_io_opt(struct queue_limits *limits, unsigned int opt);
