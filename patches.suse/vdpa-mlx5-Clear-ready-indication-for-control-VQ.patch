From: Eli Cohen <elic@nvidia.com>
Date: Thu, 9 Sep 2021 09:36:52 +0300
Subject: vdpa/mlx5: Clear ready indication for control VQ
Patch-mainline: v5.15-rc4
Git-commit: ef12e4bf4276a07fd350179fa63d0d337ea0a867
References: jsc#PED-1549

When clearing VQs ready indication for the data VQs, do the same for the
control VQ.

Fixes: 5262912ef3cf ("vdpa/mlx5: Add support for control VQ and MAC setting")
Signed-off-by: Eli Cohen <elic@nvidia.com>
Link: https://lore.kernel.org/r/20210909063652.46880-1-elic@nvidia.com
Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
Acked-by: Jason Wang <jasowang@redhat.com>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 drivers/vdpa/mlx5/net/mlx5_vnet.c |    2 ++
 1 file changed, 2 insertions(+)

--- a/drivers/vdpa/mlx5/net/mlx5_vnet.c
+++ b/drivers/vdpa/mlx5/net/mlx5_vnet.c
@@ -2145,6 +2145,8 @@ static void clear_vqs_ready(struct mlx5_
 
 	for (i = 0; i < ndev->mvdev.max_vqs; i++)
 		ndev->vqs[i].ready = false;
+
+	ndev->mvdev.cvq.ready = false;
 }
 
 static void mlx5_vdpa_set_status(struct vdpa_device *vdev, u8 status)
