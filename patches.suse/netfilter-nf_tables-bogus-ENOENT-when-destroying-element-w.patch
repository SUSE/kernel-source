From: Pablo Neira Ayuso <pablo@netfilter.org>
Date: Mon, 13 Nov 2023 20:34:56 +0100
Subject: netfilter: nf_tables: bogus ENOENT when destroying element which does
 not exist
Git-commit: a7d5a955bfa854ac6b0c53aaf933394b4e6139e4
Patch-mainline: v6.7-rc2
References: git-fixes

destroy element command bogusly reports ENOENT in case a set element
does not exist. ENOENT errors are skipped, however, err is still set
and propagated to userspace.

 # nft destroy element ip raw BLACKLIST { 1.2.3.4 }
 Error: Could not process rule: No such file or directory
 destroy element ip raw BLACKLIST { 1.2.3.4 }
 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Fixes: f80a612dd77c ("netfilter: nf_tables: add support to destroy operation")
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
Acked-by: Fernando Fernandez Mancera <fmancera@suse.de>
---
 net/netfilter/nf_tables_api.c |    5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

--- a/net/netfilter/nf_tables_api.c
+++ b/net/netfilter/nf_tables_api.c
@@ -7200,10 +7200,11 @@ static int nf_tables_delsetelem(struct s
 
 		if (err < 0) {
 			NL_SET_BAD_ATTR(extack, attr);
-			break;
+			return err;
 		}
 	}
-	return err;
+
+	return 0;
 }
 
 void nft_set_gc_batch_release(struct rcu_head *rcu)
