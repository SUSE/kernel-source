From fd64242ab3cdc93d354dd7549a3a1bc36788df93 Mon Sep 17 00:00:00 2001
From: Michal Suchanek <msuchanek@suse.de>
Date: Wed, 6 Nov 2024 12:12:30 +0100
Subject: [PATCH] aes-gcm-p10: Use the correct bit to test for P10
To: linuxppc-dev@lists.ozlabs.org
Cc: Herbert Xu <herbert@gondor.apana.org.au>,"David S. Miller" <davem@davemloft.net>,Michael Ellerman <mpe@ellerman.id.au>,Nicholas Piggin <npiggin@gmail.com>,Christophe Leroy <christophe.leroy@csgroup.eu>,Naveen N Rao <naveen@kernel.org>,Madhavan Srinivasan <maddy@linux.ibm.com>,Danny Tsen <dtsen@linux.ibm.com>,linux-crypto@vger.kernel.org,linuxppc-dev@lists.ozlabs.org,linux-kernel@vger.kernel.org,

References: bsc#1232704
Patch-mainline: Submitted https://lore.kernel.org/linux-crypto/20241106121019.25629-1-msuchanek@suse.de/T/#u

A hwcap feature bit is passed to cpu_has_feature, resulting in testing
for CPU_FTR_MMCRA instead of the 3.1 platform revision.

Fixes: c954b252dee9 ("crypto: powerpc/p10-aes-gcm - Register modules as SIMD")
Reported-by: Nicolai Stange <nstange@suse.com>
Signed-off-by: Michal Suchanek <msuchanek@suse.de>
---
 arch/powerpc/crypto/aes-gcm-p10-glue.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/arch/powerpc/crypto/aes-gcm-p10-glue.c b/arch/powerpc/crypto/aes-gcm-p10-glue.c
index e52629334cf8..1f8b67775658 100644
--- a/arch/powerpc/crypto/aes-gcm-p10-glue.c
+++ b/arch/powerpc/crypto/aes-gcm-p10-glue.c
@@ -414,7 +414,7 @@ static int __init p10_init(void)
 {
 	int ret;
 
-	if (!cpu_has_feature(PPC_FEATURE2_ARCH_3_1))
+	if (!cpu_has_feature(CPU_FTR_ARCH_31))
 		return 0;
 
 	ret = simd_register_aeads_compat(gcm_aes_algs,
-- 
2.46.1

