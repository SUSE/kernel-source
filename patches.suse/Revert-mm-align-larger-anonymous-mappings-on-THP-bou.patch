From: Jiri Slaby <jslaby@suse.cz>
Date: Tue, 16 Jan 2024 12:40:48 +0100
Subject: Revert "mm: align larger anonymous mappings on THP boundaries"
Patch-mainline: never, workaround
References: bsc#1218841

This reverts commit efa7df3e3bb5da8e6abbe37727417f32a37fba47.

Signed-off-by: Jiri Slaby <jslaby@suse.cz>
---
 mm/mmap.c |    3 ---
 1 file changed, 3 deletions(-)

--- a/mm/mmap.c
+++ b/mm/mmap.c
@@ -1829,9 +1829,6 @@ get_unmapped_area(struct file *file, uns
 		 */
 		pgoff = 0;
 		get_area = shmem_get_unmapped_area;
-	} else if (IS_ENABLED(CONFIG_TRANSPARENT_HUGEPAGE)) {
-		/* Ensures that larger anonymous mappings are THP aligned. */
-		get_area = thp_get_unmapped_area;
 	}
 
 	addr = get_area(file, addr, len, pgoff, flags);
