From: Jiri Slaby <jslaby@suse.cz>
Date: Mon, 5 Sep 2022 10:17:00 +0200
Subject: Revert "btrfs: check if root is readonly while setting security
 xattr"
Patch-mainline: never, under discussion
References: bsc#1203114

This reverts commit 0f72e355c4a0737691610c9d3e6d1a23324a51a4, commit
b51111271b0352aa596c5ae8faf06939e91b3b68 upstream.

It generates a lot of:
dracut-pre-pivot[456]: /sbin/restorecon: Could not set context for /usr/lib/modules/5.19.6-1-default/kernel/drivers/usb/cdns3/cdns-usb-common.ko.zst:  Read-only file system

Signed-off-by: Jiri Slaby <jslaby@suse.cz>
---
 fs/btrfs/xattr.c |    3 ---
 1 file changed, 3 deletions(-)

--- a/fs/btrfs/xattr.c
+++ b/fs/btrfs/xattr.c
@@ -371,9 +371,6 @@ static int btrfs_xattr_handler_set(const
 				   const char *name, const void *buffer,
 				   size_t size, int flags)
 {
-	if (btrfs_root_readonly(BTRFS_I(inode)->root))
-		return -EROFS;
-
 	name = xattr_full_name(handler, name);
 	return btrfs_setxattr_trans(inode, name, buffer, size, flags);
 }
