From: Qiuxu Zhuo <qiuxu.zhuo@intel.com>
Date: Wed, 19 Nov 2025 12:11:40 -0800
Subject: EDAC/imh: Setup 'imh_test' debugfs testing node
Git-commit: 5f40ea7f41773d996d92db8bde600199200adc11
Patch-mainline: v6.19-rc1
References: jsc#PED-14377

Setup the following debugfs testing node to enable fake memory error
address decoding tests for the imh_edac driver.

  /sys/kernel/debug/edac/imh_test/addr

Tested-by: Yi Lai <yi1.lai@intel.com>
Signed-off-by: Qiuxu Zhuo <qiuxu.zhuo@intel.com>
Signed-off-by: Tony Luck <tony.luck@intel.com>
Link: https://patch.msgid.link/20251119134132.2389472-8-qiuxu.zhuo@intel.com

Acked-by: Nikolay Borisov <nik.borisov@suse.com>
---
 drivers/edac/imh_base.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/drivers/edac/imh_base.c b/drivers/edac/imh_base.c
index 2b0db6321da0..4348b3883b45 100644
--- a/drivers/edac/imh_base.c
+++ b/drivers/edac/imh_base.c
@@ -574,6 +574,7 @@ static int __init imh_init(void)
 
 	opstate_init();
 	mce_register_decode_chain(&imh_mce_dec);
+	skx_setup_debug("imh_test");
 
 	imh_printk(KERN_INFO, "%s\n", IMH_REVISION);
 
@@ -587,6 +588,7 @@ static void __exit imh_exit(void)
 {
 	edac_dbg(2, "\n");
 
+	skx_teardown_debug();
 	mce_unregister_decode_chain(&imh_mce_dec);
 	skx_adxl_put();
 	skx_remove();

