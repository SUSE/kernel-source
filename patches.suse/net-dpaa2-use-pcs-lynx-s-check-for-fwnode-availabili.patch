From: "Russell King (Oracle)" <rmk+kernel@armlinux.org.uk>
Date: Wed, 7 Jun 2023 12:58:59 +0100
Subject: net: dpaa2: use pcs-lynx's check for fwnode availability
Patch-mainline: v6.5-rc1
Git-commit: 8c1d0b339d675366ad02fe8c571cdeed0dd28435
References: bsc#1232798

Use pcs-lynx's check rather than our own when determining if the device
is available.

Signed-off-by: Russell King (Oracle) <rmk+kernel@armlinux.org.uk>
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 drivers/net/ethernet/freescale/dpaa2/dpaa2-mac.c |   11 +++++------
 1 file changed, 5 insertions(+), 6 deletions(-)

--- a/drivers/net/ethernet/freescale/dpaa2/dpaa2-mac.c
+++ b/drivers/net/ethernet/freescale/dpaa2/dpaa2-mac.c
@@ -262,12 +262,6 @@ static int dpaa2_pcs_create(struct dpaa2
 		return 0;
 	}
 
-	if (!fwnode_device_is_available(node)) {
-		netdev_err(mac->net_dev, "pcs-handle node not available\n");
-		fwnode_handle_put(node);
-		return -ENODEV;
-	}
-
 	pcs = lynx_pcs_create_fwnode(node);
 	fwnode_handle_put(node);
 
@@ -276,6 +270,11 @@ static int dpaa2_pcs_create(struct dpaa2
 		return -EPROBE_DEFER;
 	}
 
+	if (pcs == ERR_PTR(-ENODEV)) {
+		netdev_err(mac->net_dev, "pcs-handle node not available\n");
+		return PTR_ERR(pcs);
+	}
+
 	if (IS_ERR(pcs)) {
 		netdev_err(mac->net_dev,
 			   "lynx_pcs_create_fwnode() failed: %pe\n", pcs);
