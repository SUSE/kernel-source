From e2375e4341bc0d42ca44ef32ced365f8099bab5d Mon Sep 17 00:00:00 2001
From: Bingbu Cao <bingbu.cao@intel.com>
Date: Thu, 18 May 2023 12:05:22 +0200
Subject: [PATCH] media: ipu-bridge: use IPU_MAX_PORTS for bridge instead of
 CIO2_NUM_PORTS
Git-commit: e2375e4341bc0d42ca44ef32ced365f8099bab5d
References: jsc#PED-10837
Patch-mainline: v6.6-rc1

Before bridge driver use CIO2_NUM_PORTS as the maximum supported CSI2 port
number. Current bridge driver is moved out of ipu3, so define a new macro
in ipu bridge for all IPUs instead of including CIO2 definition.
This patch also removes the ipu3-cio2.h inclusion in ipu-bridge.h.

Signed-off-by: Bingbu Cao <bingbu.cao@intel.com>
Reviewed-by: Daniel Scally <dan.scally@ideasonboard.com>
Signed-off-by: Sakari Ailus <sakari.ailus@linux.intel.com>
Signed-off-by: Mauro Carvalho Chehab <mchehab@kernel.org>
Signed-off-by: Oliver Neukum <oneukum@suse.com>

---
 drivers/media/pci/intel/ipu-bridge.c | 2 +-
 drivers/media/pci/intel/ipu-bridge.h | 5 ++---
 2 files changed, 3 insertions(+), 4 deletions(-)

diff --git a/drivers/media/pci/intel/ipu-bridge.c b/drivers/media/pci/intel/ipu-bridge.c
index f7134e308696..62daa8c1f6b1 100644
--- a/drivers/media/pci/intel/ipu-bridge.c
+++ b/drivers/media/pci/intel/ipu-bridge.c
@@ -301,7 +301,7 @@ static int ipu_bridge_connect_sensor(const struct ipu_sensor_config *cfg,
 		if (!adev->status.enabled)
 			continue;
 
-		if (bridge->n_sensors >= CIO2_NUM_PORTS) {
+		if (bridge->n_sensors >= IPU_MAX_PORTS) {
 			acpi_dev_put(adev);
 			dev_err(&ipu->dev, "Exceeded available IPU ports\n");
 			return -EINVAL;
diff --git a/drivers/media/pci/intel/ipu-bridge.h b/drivers/media/pci/intel/ipu-bridge.h
index d35b5f30ac3f..8cb733c03e2f 100644
--- a/drivers/media/pci/intel/ipu-bridge.h
+++ b/drivers/media/pci/intel/ipu-bridge.h
@@ -6,12 +6,11 @@
 #include <linux/property.h>
 #include <linux/types.h>
 
-#include "ipu3/ipu3-cio2.h"
-
 struct i2c_client;
 
 #define IPU_HID				"INT343E"
 #define IPU_MAX_LANES				4
+#define IPU_MAX_PORTS				4
 #define MAX_NUM_LINK_FREQS			3
 
 /* Values are educated guesses as we don't have a spec */
@@ -140,7 +139,7 @@ struct ipu_bridge {
 	struct software_node ipu_hid_node;
 	u32 data_lanes[4];
 	unsigned int n_sensors;
-	struct ipu_sensor sensors[CIO2_NUM_PORTS];
+	struct ipu_sensor sensors[IPU_MAX_PORTS];
 };
 
 #if IS_ENABLED(CONFIG_IPU_BRIDGE)
-- 
2.47.0

