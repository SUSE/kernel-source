From: Heiko Carstens <hca@linux.ibm.com>
Date: Tue, 1 Jul 2025 18:12:06 +0200
Subject: s390/early: Copy last breaking event address to pt_regs
Git-commit: 7cf636c99b257c1b4b12066ab34fd5f06e8d892f
Patch-mainline: v6.17-rc1
References: git-fixes bsc#1249061

In case of an early crash the early program check handler also prints the
last breaking event address which is contained within the pt_regs
structure. However it is not initialized, and therefore a more or less
random value is printed in case of a crash.

Copy the last breaking event address from lowcore to pt_regs in case of an
early program check to address this. This also makes it easier to analyze
early crashes.

Reviewed-by: Alexander Gordeev <agordeev@linux.ibm.com>
Signed-off-by: Heiko Carstens <hca@linux.ibm.com>
Signed-off-by: Alexander Gordeev <agordeev@linux.ibm.com>
Acked-by: Miroslav Franc <mfranc@suse.cz>
---
 arch/s390/kernel/early.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/arch/s390/kernel/early.c b/arch/s390/kernel/early.c
index 3cf050f7c605..9adfbdd377dc 100644
--- a/arch/s390/kernel/early.c
+++ b/arch/s390/kernel/early.c
@@ -157,6 +157,7 @@ void __init __do_early_pgm_check(struct pt_regs *regs)
 
 	regs->int_code = lc->pgm_int_code;
 	regs->int_parm_long = lc->trans_exc_code;
+	regs->last_break = lc->pgm_last_break;
 	ip = __rewind_psw(regs->psw, regs->int_code >> 16);
 
 	/* Monitor Event? Might be a warning */

