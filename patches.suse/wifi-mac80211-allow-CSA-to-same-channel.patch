From 55167a3eed53ce8b40d5bf2a3e0be4e15d2eba57 Mon Sep 17 00:00:00 2001
From: Johannes Berg <johannes.berg@intel.com>
Date: Mon, 29 Jan 2024 20:35:45 +0100
Subject: [PATCH] wifi: mac80211: allow CSA to same channel
Git-commit: 55167a3eed53ce8b40d5bf2a3e0be4e15d2eba57
Patch-mainline: v6.9-rc1
References: jsc#PED-10412

This could be used e.g. for temporarily sending quiet
(mode=1 in CSA/ECSA), or updating bandwidth. This is
also useful for testing, since it's something that an
AP may do and the client needs to be prepared. Simply
allow it.

Link: https://msgid.link/20240129203544.ef7258d5790d.Idafe22e41621757458d4960659b9621853f7104d@changeid
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Acked-by: Takashi Iwai <tiwai@suse.de>

---
 net/mac80211/cfg.c | 4 ----
 1 file changed, 4 deletions(-)

diff --git a/net/mac80211/cfg.c b/net/mac80211/cfg.c
index 2ddaf0037952..17b445491881 100644
--- a/net/mac80211/cfg.c
+++ b/net/mac80211/cfg.c
@@ -3876,10 +3876,6 @@ __ieee80211_channel_switch(struct wiphy *wiphy, struct net_device *dev,
 	if (sdata->wdev.cac_started)
 		return -EBUSY;
 
-	if (cfg80211_chandef_identical(&chanreq.oper,
-				       &sdata->vif.bss_conf.chanreq.oper))
-		return -EINVAL;
-
 	if (chanreq.oper.punctured && !sdata->vif.bss_conf.eht_support)
 		return -EINVAL;
 
-- 
2.43.0

