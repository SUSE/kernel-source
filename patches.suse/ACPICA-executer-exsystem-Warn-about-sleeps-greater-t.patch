From: Paul Menzel <pmenzel@molgen.mpg.de>
Date: Mon, 11 Apr 2022 20:59:51 +0200
Subject: ACPICA: executer/exsystem: Warn about sleeps greater than 10 ms
Patch-mainline: v5.19-rc1
Git-commit: 6eaf08770ee8562ea497c8b3f1c0079832953e20
References: jsc#PED-1408

ACPICA commit 2a0d1d475e7ea1c815bee1e0692d81db9a7c909c

Quick boottime is important, so warn about sleeps greater than 10 ms.

Distribution Linux kernels reach initrd in 350 ms, so excessive delays
should be called out. 10 ms is chosen randomly, but three of such delays
would already make up ten percent of the boottime.

Link: https://github.com/acpica/acpica/commit/2a0d1d47
Signed-off-by: Bob Moore <robert.moore@intel.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
Reported-by: kernel test robot <lkp@intel.com>
Acked-by: Lee, Chun-Yi <jlee@suse.com>
---
 drivers/acpi/acpica/exsystem.c |   10 ++++++++++
 1 file changed, 10 insertions(+)

--- a/drivers/acpi/acpica/exsystem.c
+++ b/drivers/acpi/acpica/exsystem.c
@@ -170,6 +170,16 @@ acpi_status acpi_ex_system_do_sleep(u64
 	acpi_ex_exit_interpreter();
 
 	/*
+	 * Warn users about excessive sleep times, so ASL code can be improved to
+	 * use polling or similar techniques.
+	 */
+	if (how_long_ms > 10) {
+		ACPI_WARNING((AE_INFO,
+			      "Firmware issue: Excessive sleep time (%llu ms > 10 ms) in ACPI Control Method",
+			      how_long_us));
+	}
+
+	/*
 	 * For compatibility with other ACPI implementations and to prevent
 	 * accidental deep sleeps, limit the sleep time to something reasonable.
 	 */
