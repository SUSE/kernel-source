From 5258dfd4a6adb5f45f046b0dd2e73c680f880d9d Mon Sep 17 00:00:00 2001
From: Dave Airlie <airlied@redhat.com>
Date: Fri, 27 Oct 2023 07:53:50 +1000
Subject: [PATCH] usb: typec: altmodes/displayport: fixup drm internal api
 change vs new user.
Git-commit: 5258dfd4a6adb5f45f046b0dd2e73c680f880d9d
References: jsc#PED-6028
Patch-mainline: v6.7-rc1

Usb: typec: altmodes/displayport: Signal hpd low when exiting mode
and
Drm: Add HPD state to drm_connector_oob_hotplug_event()

sideswiped each other.

Signal disconnected always.

Signed-off-by: Dave Airlie <airlied@redhat.com>
Signed-off-by: Oliver Neukum <oneukum@suse.com>

---
 drivers/usb/typec/altmodes/displayport.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/drivers/usb/typec/altmodes/displayport.c b/drivers/usb/typec/altmodes/displayport.c
index ddfb5b6ace4f..aea9d2fd0e76 100644
--- a/drivers/usb/typec/altmodes/displayport.c
+++ b/drivers/usb/typec/altmodes/displayport.c
@@ -306,7 +306,8 @@ static int dp_altmode_vdm(struct typec_altmode *alt,
 			dp->data.status = 0;
 			dp->data.conf = 0;
 			if (dp->hpd) {
-				drm_connector_oob_hotplug_event(dp->connector_fwnode);
+				drm_connector_oob_hotplug_event(dp->connector_fwnode,
+								connector_status_disconnected);
 				dp->hpd = false;
 				sysfs_notify(&dp->alt->dev.kobj, "displayport", "hpd");
 			}
-- 
2.43.0

