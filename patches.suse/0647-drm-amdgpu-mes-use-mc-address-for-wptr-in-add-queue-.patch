From 014235e2ca1fddda981ab698277e38059f888f0e Mon Sep 17 00:00:00 2001
From: Frank Min <Frank.Min@amd.com>
Date: Tue, 14 May 2024 15:47:13 +0800
Subject: drm/amdgpu/mes: use mc address for wptr in add queue packet
Git-commit: b80160a53a4aad05987ead30125cdca3991bac09
Patch-mainline: v6.11-rc1
References: jsc#PED-9898 jsc#PED-10191 jsc#PED-10197 jsc#PED-10226 jsc#PED-10237 jsc#PED-10340 jsc#PED-10852 jsc#PED-11022

use mc address for wptr in add queue packet

Signed-off-by: Frank Min <Frank.Min@amd.com>
Reviewed-by: Jack Xiao <Jack.Xiao@amd.com>
Acked-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Acked-by: Patrik Jakobsson <pjakobsson@suse.de>
---
 drivers/gpu/drm/amd/amdgpu/mes_v12_0.c | 6 +-----
 1 file changed, 1 insertion(+), 5 deletions(-)

diff --git a/drivers/gpu/drm/amd/amdgpu/mes_v12_0.c b/drivers/gpu/drm/amd/amdgpu/mes_v12_0.c
index 26d4046f82f4..45b70a4c4ada 100644
--- a/drivers/gpu/drm/amd/amdgpu/mes_v12_0.c
+++ b/drivers/gpu/drm/amd/amdgpu/mes_v12_0.c
@@ -267,11 +267,7 @@ static int mes_v12_0_add_hw_queue(struct amdgpu_mes *mes,
 	mes_add_queue_pkt.doorbell_offset = input->doorbell_offset;
 	mes_add_queue_pkt.mqd_addr = input->mqd_addr;
 
-	if (((adev->mes.sched_version & AMDGPU_MES_API_VERSION_MASK) >>
-			AMDGPU_MES_API_VERSION_SHIFT) >= 2)
-		mes_add_queue_pkt.wptr_addr = input->wptr_mc_addr;
-	else
-		mes_add_queue_pkt.wptr_addr = input->wptr_addr;
+	mes_add_queue_pkt.wptr_addr = input->wptr_mc_addr;
 
 	mes_add_queue_pkt.queue_type =
 		convert_to_mes_queue_type(input->queue_type);
-- 
2.46.1

