From: Lv Ruyi <lv.ruyi@zte.com.cn>
Date: Thu, 28 Oct 2021 10:41:38 +0000
Patch-mainline: v5.16-rc1
Subject: Drivers: hv : vmbus: Adding NULL pointer check
Git-commit: 01ccca3cb50dcff7eea01448af985a49859b8a1d
References: git-fixes

This patch fixes the following Coccinelle warning:
drivers/hv/ring_buffer.c:223: alloc with no test

Reported-by: Zeal Robot <zealci@zte.com.cn>
Signed-off-by: Lv Ruyi <lv.ruyi@zte.com.cn>
Link: https://lore.kernel.org/r/20211028104138.14576-1-lv.ruyi@zte.com.cn
Signed-off-by: Wei Liu <wei.liu@kernel.org>
Acked-by: Olaf Hering <ohering@suse.de>
---
 drivers/hv/ring_buffer.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/drivers/hv/ring_buffer.c b/drivers/hv/ring_buffer.c
--- a/drivers/hv/ring_buffer.c
+++ b/drivers/hv/ring_buffer.c
@@ -223,6 +223,8 @@ int hv_ringbuffer_init(struct hv_ring_buffer_info *ring_info,
 		pages_wraparound = kcalloc(page_cnt * 2 - 1,
 					   sizeof(struct page *),
 					   GFP_KERNEL);
+		if (!pages_wraparound)
+			return -ENOMEM;
 
 		pages_wraparound[0] = pages;
 		for (i = 0; i < 2 * (page_cnt - 1); i++)
