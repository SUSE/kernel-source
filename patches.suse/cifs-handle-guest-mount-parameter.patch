From: Steve French <stfrench@microsoft.com>
Date: Wed, 16 Dec 2020 16:26:35 -0600
Subject: [PATCH] cifs: handle "guest" mount parameter
Git-commit: 31f6551ad75608d9c71fd4d3548c33f1abc52093
Patch-mainline: v5.11-rc1
References: bsc#1192606

With the new mount API it can not handle empty strings for
mount parms ("guest" is mapped in userspace mount helper to
"user=") so we have to special case it as we do for the
password mount parm.

Signed-off-by: Steve French <stfrench@microsoft.com>
Reviewed-by: Ronnie Sahlberg <lsahlber@redhat.com>
Acked-by: Enzo Matsumiya <ematsumiya@suse.de>
---
 fs/cifs/fs_context.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/fs/cifs/fs_context.c b/fs/cifs/fs_context.c
index 29b99e68ec80..734b30db580f 100644
--- a/fs/cifs/fs_context.c
+++ b/fs/cifs/fs_context.c
@@ -733,6 +733,9 @@ static int smb3_fs_context_parse_param(struct fs_context *fc,
 		if (!strcmp("pass", param->key) || !strcmp("password", param->key)) {
 			skip_parsing = true;
 			opt = Opt_pass;
+		} else if (!strcmp("user", param->key) || !strcmp("username", param->key)) {
+			skip_parsing = true;
+			opt = Opt_user;
 		}
 	}
 
@@ -1250,6 +1253,7 @@ static int smb3_fs_context_parse_param(struct fs_context *fc,
 		ctx->rdma = true;
 		break;
 	}
+	/* case Opt_ignore: - is ignored as expected ... */
 
 	return 0;
 
-- 
2.33.1

