From: Eli Cohen <elic@nvidia.com>
Date: Mon, 6 Feb 2023 14:20:16 +0200
Subject: vdpa/mlx5: Initialize CVQ iotlb spinlock
Patch-mainline: v6.3-rc1
Git-commit: c04e2145b8c9e1429ad2134291a830d2ba39657a
References: jsc#PED-1549

Initialize itolb spinlock.

Fixes: 5262912ef3cf ("vdpa/mlx5: Add support for control VQ and MAC setting")
Signed-off-by: Eli Cohen <elic@nvidia.com>
Message-Id: <20230206122016.1149373-1-elic@nvidia.com>
Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 drivers/vdpa/mlx5/core/resources.c |    1 +
 1 file changed, 1 insertion(+)

--- a/drivers/vdpa/mlx5/core/resources.c
+++ b/drivers/vdpa/mlx5/core/resources.c
@@ -233,6 +233,7 @@ static int init_ctrl_vq(struct mlx5_vdpa
 	if (!mvdev->cvq.iotlb)
 		return -ENOMEM;
 
+	spin_lock_init(&mvdev->cvq.iommu_lock);
 	vringh_set_iotlb(&mvdev->cvq.vring, mvdev->cvq.iotlb, &mvdev->cvq.iommu_lock);
 
 	return 0;
