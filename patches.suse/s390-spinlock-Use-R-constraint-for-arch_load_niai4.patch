From 84ac96587b2a7a27d2aba250009c45dffb8ab4b6 Mon Sep 17 00:00:00 2001
From: Heiko Carstens <hca@linux.ibm.com>
Date: Tue, 26 Nov 2024 14:28:26 +0100
Subject: [PATCH] s390/spinlock: Use R constraint for arch_load_niai4()
Git-commit: 84ac96587b2a7a27d2aba250009c45dffb8ab4b6
Patch-mainline: v6.13-rc1
References: bsc#1257818

The load instruction used within arch_load_niai4() has a short displacement
and index register. Therefore use the R constraint to reflect this.
The used Q constraint does consider an index register.

Signed-off-by: Heiko Carstens <hca@linux.ibm.com>
Signed-off-by: Jiri Wiesner <jwiesner@suse.de>
---
 arch/s390/lib/spinlock.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/arch/s390/lib/spinlock.c b/arch/s390/lib/spinlock.c
index 255c0a8202e7..c27c0f2a8018 100644
--- a/arch/s390/lib/spinlock.c
+++ b/arch/s390/lib/spinlock.c
@@ -77,7 +77,7 @@ static inline int arch_load_niai4(int *lock)
 	asm_inline volatile(
 		ALTERNATIVE("nop", ".insn rre,0xb2fa0000,4,0", ALT_FACILITY(49)) /* NIAI 4 */
 		"	l	%[owner],%[lock]\n"
-		: [owner] "=d" (owner) : [lock] "Q" (*lock) : "memory");
+		: [owner] "=d" (owner) : [lock] "R" (*lock) : "memory");
 	return owner;
 }
 
-- 
2.51.0

