From 6212804f2d78e86f15dba5b46a4065cbf1403cde Mon Sep 17 00:00:00 2001
From: Masahiro Yamada <masahiroy@kernel.org>
Date: Wed, 9 Sep 2020 05:55:57 +0900
Subject: [PATCH] kbuild: do not create built-in objects for external module
 builds

References: jsc#SLE-24559 bsc#1202756
Patch-mainline: v5.10-rc1
Git-commit: 6212804f2d78e86f15dba5b46a4065cbf1403cde

'make M=/path/to/your/external/module' creates a pointless built-in.a
in the top of the external module directory because KBUILD_BUILTIN is
set to 1.

Clear KBUILD_BUILTIN when we are building external modules so that
'make M=...' and 'make M=... modules' work equivalently.

Signed-off-by: Masahiro Yamada <masahiroy@kernel.org>
Acked-by: Michal Suchanek <msuchanek@suse.de>
---
 Makefile | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

--- a/Makefile
+++ b/Makefile
@@ -1637,7 +1637,8 @@ else # KBUILD_EXTMOD
 #                      Install the modules built in the module directory
 #                      Assumes install directory is already created
 
-# We are always building modules
+# We are always building only modules.
+KBUILD_BUILTIN :=
 KBUILD_MODULES := 1
 
 PHONY += $(objtree)/Module.symvers
