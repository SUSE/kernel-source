From: Irvin Cote <irvincoteg@gmail.com>
Date: Thu, 18 May 2023 19:10:54 -0300
Subject: nvme-core: use nvme_ns_head_multipath instead of ns->head->disk
Patch-mainline: v6.5-rc1
Git-commit: 35e797b0246b49d116326ff23c2dbfd6507168a5
References: jsc#PED-6252 jsc#PED-5728 jsc#PED-5062 jsc#PED-3535

Change the way we check for a multipath nshead so as
to consistently use the same check to assert the same condition.

Signed-off-by: Irvin Cote <irvincoteg@gmail.com>
Reviewed-by: Christoph Hellwig <hch@lst.de>
Signed-off-by: Keith Busch <kbusch@kernel.org>
Acked-by: Daniel Wagner <dwagner@suse.de>
---
 drivers/nvme/host/core.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/drivers/nvme/host/core.c
+++ b/drivers/nvme/host/core.c
@@ -3708,7 +3708,7 @@ static void nvme_alloc_ns(struct nvme_ct
 	 * instance as shared namespaces will show up as multiple block
 	 * devices.
 	 */
-	if (ns->head->disk) {
+	if (nvme_ns_head_multipath(ns->head)) {
 		sprintf(disk->disk_name, "nvme%dc%dn%d", ctrl->subsys->instance,
 			ctrl->instance, ns->head->instance);
 		disk->flags |= GENHD_FL_HIDDEN;
