From: Harshit Mogalapalli <harshit.m.mogalapalli@oracle.com>
Date: Mon, 20 Jan 2025 16:50:02 -0800
Subject: net: mvneta: fix locking in mvneta_cpu_online()
Patch-mainline: v6.14-rc1
Git-commit: 59e00e8ca24220acea2d2d9f540fccf64e0f41ea
References: git-fixes

When port is stopped, unlock before returning

Fixes: 413f0271f396 ("net: protect NAPI enablement with netdev_lock()")
Signed-off-by: Harshit Mogalapalli <harshit.m.mogalapalli@oracle.com>
Reviewed-by: Simon Horman <horms@kernel.org>
Link: https://patch.msgid.link/20250121005002.3938236-1-harshit.m.mogalapalli@oracle.com
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 drivers/net/ethernet/marvell/mvneta.c |    1 +
 1 file changed, 1 insertion(+)

--- a/drivers/net/ethernet/marvell/mvneta.c
+++ b/drivers/net/ethernet/marvell/mvneta.c
@@ -4393,6 +4393,7 @@ static int mvneta_cpu_online(unsigned in
 	 */
 	if (pp->is_stopped) {
 		spin_unlock(&pp->lock);
+		netdev_unlock(port->napi.dev);
 		return 0;
 	}
 	netif_tx_stop_all_queues(pp->dev);
