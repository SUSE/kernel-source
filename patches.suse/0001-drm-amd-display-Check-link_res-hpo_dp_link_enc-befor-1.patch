From 5d4d58d338d590e6ede16f19e53f653968403bfd Mon Sep 17 00:00:00 2001
From: Alex Hung <alex.hung@amd.com>
Date: Thu, 27 Jun 2024 16:45:39 -0600
Subject: drm/amd/display: Check link_res->hpo_dp_link_enc before using it
Git-commit: d925c04d974c657d10471c0c2dba3bc9c7d994ee
Patch-mainline: v6.12-rc1
References: bsc#1231944

[WHAT & HOW]
Functions dp_enable_link_phy and dp_disable_link_phy can pass link_res
without initializing hpo_dp_link_enc and it is necessary to check for
null before dereferencing.

This fixes 1 FORWARD_NULL issue reported by Coverity.

Fixes: 0beca868cde8 ("drm/amd/display: Check link_res->hpo_dp_link_enc before using it")
Reviewed-by: Rodrigo Siqueira <rodrigo.siqueira@amd.com>
Signed-off-by: Alex Hung <alex.hung@amd.com>
Signed-off-by: Aurabindo Pillai <aurabindo.pillai@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Acked-by: Thomas Zimmermann <tzimmermann@suse.com>
---
 drivers/gpu/drm/amd/display/dc/link/link_hwss_hpo_dp.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/drivers/gpu/drm/amd/display/dc/link/link_hwss_hpo_dp.c b/drivers/gpu/drm/amd/display/dc/link/link_hwss_hpo_dp.c
index 1ff5bb175d0a3..068c35502036f 100644
--- a/drivers/gpu/drm/amd/display/dc/link/link_hwss_hpo_dp.c
+++ b/drivers/gpu/drm/amd/display/dc/link/link_hwss_hpo_dp.c
@@ -171,6 +171,11 @@ static void enable_hpo_dp_fpga_link_output(struct dc_link *link,
 			link_settings->link_rate == LINK_RATE_UHBR13_5 ? 412875 :
 			link_settings->link_rate == LINK_RATE_UHBR20 ? 625000 : 0;
 
+	if (!link_res->hpo_dp_link_enc) {
+		DC_LOG_ERROR("%s: invalid hpo_dp_link_enc\n", __func__);
+		return;
+	}
+
 	dm_set_phyd32clk(dc->ctx, phyd32clk_freq_khz);
 	dc->res_pool->dccg->funcs->set_physymclk(
 			dc->res_pool->dccg,
-- 
2.46.0

