From: Steve French <stfrench@microsoft.com>
Date: Fri, 12 Jun 2020 14:49:47 -0500
Subject: [PATCH] smb3: Add debug message for new file creation with idsfromsid
 mount option
Git-commit: a7a519a4926214ba4161bc30109f4a8d69defb8d
Patch-mainline: v5.8-rc1
References: bsc#1192606

Pavel noticed that a debug message (disabled by default) in creating the security
descriptor context could be useful for new file creation owner fields
(as we already have for the mode) when using mount parm idsfromsid.

[38120.392272] CIFS: FYI: owner S-1-5-88-1-0, group S-1-5-88-2-0
[38125.792637] CIFS: FYI: owner S-1-5-88-1-1000, group S-1-5-88-2-1000

Also cleans up a typo in a comment

Signed-off-by: Steve French <stfrench@microsoft.com>
Reviewed-by: Pavel Shilovsky <pshilov@microsoft.com>
Acked-by: Enzo Matsumiya <ematsumiya@suse.de>
---
 fs/cifs/inode.c   | 4 ++--
 fs/cifs/smb2pdu.c | 2 ++
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/fs/cifs/inode.c b/fs/cifs/inode.c
index 15ac63ff8ffc..583f5e4008c2 100644
--- a/fs/cifs/inode.c
+++ b/fs/cifs/inode.c
@@ -1148,7 +1148,7 @@ smb311_posix_get_inode_info(struct inode **inode,
 
 
 	/*
-	 * 4. Tweak fattr based on mount options
+	 * 3. Tweak fattr based on mount options
 	 */
 
 	/* check for Minshall+French symlinks */
@@ -1160,7 +1160,7 @@ smb311_posix_get_inode_info(struct inode **inode,
 	}
 
 	/*
-	 * 5. Update inode with final fattr data
+	 * 4. Update inode with final fattr data
 	 */
 
 	if (!*inode) {
diff --git a/fs/cifs/smb2pdu.c b/fs/cifs/smb2pdu.c
index c6b9e617343a..2f4cdd290c46 100644
--- a/fs/cifs/smb2pdu.c
+++ b/fs/cifs/smb2pdu.c
@@ -2337,6 +2337,8 @@ static void setup_owner_group_sids(char *buf)
 	sids->group.SubAuthorities[0] = cpu_to_le32(88);
 	sids->group.SubAuthorities[1] = cpu_to_le32(2);
 	sids->group.SubAuthorities[2] = cpu_to_le32(current_fsgid().val);
+
+	cifs_dbg(FYI, "owner S-1-5-88-1-%d, group S-1-5-88-2-%d\n", current_fsuid().val, current_fsgid().val);
 }
 
 /* See MS-SMB2 2.2.13.2.2 and MS-DTYP 2.4.6 */
-- 
2.33.1

