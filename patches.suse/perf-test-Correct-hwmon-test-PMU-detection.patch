From: Ian Rogers <irogers@google.com>
Date: Sun, 17 Nov 2024 21:26:38 -0800
Subject: perf test: Correct hwmon test PMU detection
Git-commit: fc26637d70d3f1ba9df8cd0f7c22b8b331c564e7
Patch-mainline: v6.13-rc1
References: perf-sle16-v6.13-userspace-update

Use name to avoid potential other hwmon PMUs.

Signed-off-by: Ian Rogers <irogers@google.com>
Link: https://lore.kernel.org/r/20241118052638.754981-1-irogers@google.com
Signed-off-by: Namhyung Kim <namhyung@kernel.org>
Signed-off-by: Tony Jones <tonyj@suse.de>
---
 tools/perf/tests/hwmon_pmu.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/tools/perf/tests/hwmon_pmu.c b/tools/perf/tests/hwmon_pmu.c
index 9f44093f18df..1e5f93aaaf5f 100644
--- a/tools/perf/tests/hwmon_pmu.c
+++ b/tools/perf/tests/hwmon_pmu.c
@@ -173,7 +173,8 @@ static int do_test(size_t i, bool with_pmu, bool with_alias)
 	}
 
 	evlist__for_each_entry(evlist, evsel) {
-		if (!perf_pmu__is_hwmon(evsel->pmu))
+		if (!evsel->pmu || !evsel->pmu->name ||
+		    strcmp(evsel->pmu->name, "hwmon_a_test_hwmon_pmu"))
 			continue;
 
 		if (evsel->core.attr.config != (u64)test_events[i].config) {

