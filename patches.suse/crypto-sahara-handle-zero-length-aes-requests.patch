From d1d6351e37aac14b32a291731d0855996c459d11 Mon Sep 17 00:00:00 2001
From: Ovidiu Panait <ovidiu.panait@windriver.com>
Date: Sun, 24 Dec 2023 10:21:31 +0200
Subject: [PATCH] crypto: sahara - handle zero-length aes requests
Git-commit: d1d6351e37aac14b32a291731d0855996c459d11
Patch-mainline: v6.8-rc1
References: git-fixes

In case of a zero-length input, exit gracefully from sahara_aes_crypt().

Fixes: 5de8875281e1 ("crypto: sahara - Add driver for SAHARA2 accelerator.")
Signed-off-by: Ovidiu Panait <ovidiu.panait@windriver.com>
Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
Acked-by: Takashi Iwai <tiwai@suse.de>

---
 drivers/crypto/sahara.c |    2 ++
 1 file changed, 2 insertions(+)

--- a/drivers/crypto/sahara.c
+++ b/drivers/crypto/sahara.c
@@ -656,6 +656,8 @@ static int sahara_aes_crypt(struct skcip
 	struct sahara_aes_reqctx *rctx = skcipher_request_ctx(req);
 	struct sahara_dev *dev = dev_ptr;
 	int err = 0;
+	if (!req->cryptlen)
+		return 0;
 
 	dev_dbg(dev->device, "nbytes: %d, enc: %d, cbc: %d\n",
 		req->cryptlen, !!(mode & FLAGS_ENCRYPT), !!(mode & FLAGS_CBC));
