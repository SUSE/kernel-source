From: Nilesh Javali <njavali@marvell.com>
Date: Wed, 6 Sep 2023 15:39:21 +0530
Subject: qla2xxx: add debug log for deprecated hw detected
References: bsc#1216032
Patch-mainline: Never, Marvel stopped to support these cards

Few PCI IDs are deprecated, ISP2532/ISP2031/ISP8031.
If the PCI IDs are identified in the system while driver load,
then warn user about the details of deprecated PCI IDs.

Signed-off-by: Nilesh Javali <njavali@marvell.com>
Acked-by: Daniel Wagner <dwagner@suse.de>
---
 drivers/scsi/qla2xxx/qla_os.c | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/drivers/scsi/qla2xxx/qla_os.c b/drivers/scsi/qla2xxx/qla_os.c
index 341151a967cf..2478a281d4e2 100644
--- a/drivers/scsi/qla2xxx/qla_os.c
+++ b/drivers/scsi/qla2xxx/qla_os.c
@@ -2915,6 +2915,14 @@ qla2x00_probe_one(struct pci_dev *pdev, const struct pci_device_id *id)
 	struct rsp_que *rsp = NULL;
 	int i;
 
+	if (pdev->device == PCI_DEVICE_ID_QLOGIC_ISP2532 ||
+	    pdev->device == PCI_DEVICE_ID_QLOGIC_ISP2031 ||
+	    pdev->device == PCI_DEVICE_ID_QLOGIC_ISP8031) {
+		pr_warn("Warning: Deprecated hardware is detected: %s:%04x:%04x @ %s will not be maintained in a future major OS release\n",
+			dev_driver_string(&pdev->dev), pdev->device,
+			pdev->vendor, pci_name(pdev));
+	}
+
 	bars = pci_select_bars(pdev, IORESOURCE_MEM | IORESOURCE_IO);
 	sht = &qla2xxx_driver_template;
 	if (pdev->device == PCI_DEVICE_ID_QLOGIC_ISP2422 ||
-- 
2.31.1

