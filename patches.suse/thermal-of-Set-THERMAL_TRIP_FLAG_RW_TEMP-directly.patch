From: "Rafael J. Wysocki" <rafael.j.wysocki@intel.com>
Date: Thu, 22 Feb 2024 18:38:21 +0100
Subject: thermal: of: Set THERMAL_TRIP_FLAG_RW_TEMP directly
Patch-mainline: v6.9-rc1
Git-commit: 83c2d444ed9da7dd3536abb7596de309b8a9991f
References: jsc#PED-11164

It is now possible to flag trip points with THERMAL_TRIP_FLAG_RW_TEMP
to allow their temperature to be set from user space via sysfs instead
of using a nonzero writable trips mask during thermal zone registration,
so make the OF thermal code do that.

No intentional functional impact.

Note that this change is requisite for dropping the mask argument from
thermal_zone_device_register_with_trips() going forward.

Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
Reviewed-by: Daniel Lezcano <daniel.lezcano@linaro.org>
Acked-by: Chun-Yi Lee <jlee@suse.com>
---
 drivers/thermal/thermal_of.c |    8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

--- a/drivers/thermal/thermal_of.c
+++ b/drivers/thermal/thermal_of.c
@@ -118,6 +118,8 @@ static int thermal_of_populate_trip(stru
 		return ret;
 	}
 
+	trip->flags = THERMAL_TRIP_FLAG_RW_TEMP;
+
 	return 0;
 }
 
@@ -473,7 +475,7 @@ static struct thermal_zone_device *therm
 	struct device_node *np;
 	const char *action;
 	int delay, pdelay;
-	int ntrips, mask;
+	int ntrips;
 	int ret;
 
 	np = of_thermal_zone_find(sensor, id);
@@ -500,15 +502,13 @@ static struct thermal_zone_device *therm
 	of_ops.bind = thermal_of_bind;
 	of_ops.unbind = thermal_of_unbind;
 
-	mask = GENMASK_ULL((ntrips) - 1, 0);
-
 	ret = of_property_read_string(np, "critical-action", &action);
 	if (!ret)
 		if (!of_ops.critical && !strcasecmp(action, "reboot"))
 			of_ops.critical = thermal_zone_device_critical_reboot;
 
 	tz = thermal_zone_device_register_with_trips(np->name, trips, ntrips,
-						     mask, data, &of_ops, &tzp,
+						     0, data, &of_ops, &tzp,
 						     pdelay, delay);
 	if (IS_ERR(tz)) {
 		ret = PTR_ERR(tz);
