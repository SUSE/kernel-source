From: Jiri Slaby <jslaby@suse.cz>
Date: Tue, 14 Oct 2025 10:37:55 +0200
Subject: Revert "net: bonding: add broadcast_neighbor netlink option"
References: bsc#1250894
Patch-mainline: never, temporary revert

This reverts commit 3d98ee52659c3f1d3913ae5b97f7743c5247752c.

Signed-off-by: Jiri Slaby <jslaby@suse.cz>
---
 drivers/net/bonding/bond_netlink.c |   16 ----------------
 include/uapi/linux/if_link.h       |    1 -
 2 files changed, 17 deletions(-)

--- a/drivers/net/bonding/bond_netlink.c
+++ b/drivers/net/bonding/bond_netlink.c
@@ -124,7 +124,6 @@ static const struct nla_policy bond_poli
 	[IFLA_BOND_MISSED_MAX]		= { .type = NLA_U8 },
 	[IFLA_BOND_NS_IP6_TARGET]	= { .type = NLA_NESTED },
 	[IFLA_BOND_COUPLED_CONTROL]	= { .type = NLA_U8 },
-	[IFLA_BOND_BROADCAST_NEIGH]	= { .type = NLA_U8 },
 };
 
 static const struct nla_policy bond_slave_policy[IFLA_BOND_SLAVE_MAX + 1] = {
@@ -562,16 +561,6 @@ static int bond_changelink(struct net_de
 			return err;
 	}
 
-	if (data[IFLA_BOND_BROADCAST_NEIGH]) {
-		int broadcast_neigh = nla_get_u8(data[IFLA_BOND_BROADCAST_NEIGH]);
-
-		bond_opt_initval(&newval, broadcast_neigh);
-		err = __bond_opt_set(bond, BOND_OPT_BROADCAST_NEIGH, &newval,
-				     data[IFLA_BOND_BROADCAST_NEIGH], extack);
-		if (err)
-			return err;
-	}
-
 	return 0;
 }
 
@@ -641,7 +630,6 @@ static size_t bond_get_size(const struct
 		nla_total_size(sizeof(struct nlattr)) +
 		nla_total_size(sizeof(struct in6_addr)) * BOND_MAX_NS_TARGETS +
 		nla_total_size(sizeof(u8)) +	/* IFLA_BOND_COUPLED_CONTROL */
-		nla_total_size(sizeof(u8)) +	/* IFLA_BOND_BROADCAST_NEIGH */
 		0;
 }
 
@@ -805,10 +793,6 @@ static int bond_fill_info(struct sk_buff
 		       bond->params.coupled_control))
 		goto nla_put_failure;
 
-	if (nla_put_u8(skb, IFLA_BOND_BROADCAST_NEIGH,
-		       bond->params.broadcast_neighbor))
-		goto nla_put_failure;
-
 	if (BOND_MODE(bond) == BOND_MODE_8023AD) {
 		struct ad_info info;
 
--- a/include/uapi/linux/if_link.h
+++ b/include/uapi/linux/if_link.h
@@ -1535,7 +1535,6 @@ enum {
 	IFLA_BOND_MISSED_MAX,
 	IFLA_BOND_NS_IP6_TARGET,
 	IFLA_BOND_COUPLED_CONTROL,
-	IFLA_BOND_BROADCAST_NEIGH,
 	__IFLA_BOND_MAX,
 };
 
