From: Heiner Kallweit <hkallweit1@gmail.com>
Date: Thu, 5 Aug 2021 21:08:22 +0200
Subject: ethtool: return error from ethnl_ops_begin if dev is NULL
Patch-mainline: v5.15-rc1
Git-commit: 596690e9f4fc8f062a3f52b42071086721fd76fe
References: CVE-2021-47517 bsc#1225428

Julian reported that after d43c65b05b84 Coverity complains about a
missing check whether dev is NULL in ethnl_ops_complete().
There doesn't seem to be any valid case where dev could be NULL when
calling ethnl_ops_begin(), therefore return an error if dev is NULL.

Fixes: d43c65b05b84 ("ethtool: runtime-resume netdev parent in ethnl_ops_begin")
Reported-by: Julian Wiedmann <jwi@linux.ibm.com>
Signed-off-by: Heiner Kallweit <hkallweit1@gmail.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: Michal Kubecek <mkubecek@suse.cz>

---
 net/ethtool/netlink.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

--- a/net/ethtool/netlink.c
+++ b/net/ethtool/netlink.c
@@ -35,7 +35,7 @@ int ethnl_ops_begin(struct net_device *dev)
 	int ret;
 
 	if (!dev)
-		return 0;
+		return -ENODEV;
 
 	if (dev->dev.parent)
 		pm_runtime_get_sync(dev->dev.parent);
@@ -61,7 +61,7 @@ int ethnl_ops_begin(struct net_device *dev)
 
 void ethnl_ops_complete(struct net_device *dev)
 {
-	if (dev && dev->ethtool_ops->complete)
+	if (dev->ethtool_ops->complete)
 		dev->ethtool_ops->complete(dev);
 
 	if (dev->dev.parent)
