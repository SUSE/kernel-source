From: "Russell King (Oracle)" <rmk+kernel@armlinux.org.uk>
Date: Wed, 7 Jun 2023 12:59:04 +0100
Subject: net: fman_memac: use pcs-lynx's check for fwnode availability
Patch-mainline: v6.5-rc1
Git-commit: 32fc30353f7c4d5370acf6ef8fb3be9363dce3c2
References: bsc#1232798

Use pcs-lynx's check rather than our own when determining if the device
is available. This fixes a bug where the reference gained by
of_parse_phandle() is not dropped if the device is not available.

Signed-off-by: Russell King (Oracle) <rmk+kernel@armlinux.org.uk>
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Acked-by: Thomas Bogendoerfer <tbogendoerfer@suse.de>
---
 drivers/net/ethernet/freescale/fman/fman_memac.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/drivers/net/ethernet/freescale/fman/fman_memac.c
+++ b/drivers/net/ethernet/freescale/fman/fman_memac.c
@@ -1042,7 +1042,7 @@ static struct phylink_pcs *memac_pcs_cre
 	struct phylink_pcs *pcs;
 
 	node = of_parse_phandle(mac_node, "pcsphy-handle", index);
-	if (!node || !of_device_is_available(node))
+	if (!node)
 		return ERR_PTR(-ENODEV);
 
 	pcs = lynx_pcs_create_fwnode(of_fwnode_handle(node));
