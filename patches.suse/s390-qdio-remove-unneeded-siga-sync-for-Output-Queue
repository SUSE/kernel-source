From: Julian Wiedmann <jwi@linux.ibm.com>
Date: Mon, 12 Jul 2021 08:29:32 +0200
Subject: s390/qdio: remove unneeded siga-sync for Output Queue
Git-commit: 0ae8f2af262a371d9c49c67a0f5e48982c57cdf4
Patch-mainline: v5.15-rc1
References: jsc#PED-588 bsc#1203836 LTC#198623

get_outbound_buffer_frontier() is only reached via qdio_inspect_queue(),
and there we already call qdio_siga_sync_q() unconditionally.

Signed-off-by: Julian Wiedmann <jwi@linux.ibm.com>
Reviewed-by: Benjamin Block <bblock@linux.ibm.com>
Signed-off-by: Heiko Carstens <hca@linux.ibm.com>
Acked-by: Petr Tesarik <ptesarik@suse.com>
---
 drivers/s390/cio/qdio_main.c |    7 -------
 1 file changed, 7 deletions(-)

--- a/drivers/s390/cio/qdio_main.c
+++ b/drivers/s390/cio/qdio_main.c
@@ -516,13 +516,6 @@ static int get_outbound_buffer_frontier(
 
 	q->timestamp = get_tod_clock_fast();
 
-	if (need_siga_sync(q))
-		if (((queue_type(q) != QDIO_IQDIO_QFMT) &&
-		    !pci_out_supported(q->irq_ptr)) ||
-		    (queue_type(q) == QDIO_IQDIO_QFMT &&
-		    multicast_outbound(q)))
-			qdio_siga_sync_q(q);
-
 	count = atomic_read(&q->nr_buf_used);
 	if (!count)
 		return 0;
